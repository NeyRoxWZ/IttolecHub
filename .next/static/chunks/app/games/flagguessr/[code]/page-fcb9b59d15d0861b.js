(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[458],{5732:function(e,t,a){Promise.resolve().then(a.bind(a,7892))},7892:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var s=a(7437),r=a(2265),l=a(4033),n=a(1543),c=a(9313),d=a(4203),o=a(4518),u=a(8957),i=a(8619),m=a(6690),x=a(6027),p=a(1215);function h(){var e,t;let a=(0,l.useParams)(),h=(0,l.useSearchParams)(),f=a.code,y=Math.max(1,parseInt(h.get("rounds")||"5",10)),g=Math.max(5,parseInt(h.get("time")||"15",10)),[j,N]=(0,r.useState)(null),[b,v]=(0,r.useState)(""),[k,S]=(0,r.useState)([]),[w,_]=(0,r.useState)(!1),[C,Z]=(0,r.useState)(!1),[E,I]=(0,r.useState)(0),[P,M]=(0,r.useState)(null),[z,L]=(0,r.useState)(g),[O,D]=(0,r.useState)([]),[F,R]=(0,r.useState)(!1),{broadcast:T,messages:V}=(0,o.r)(f,"flagguessr"),A="true"===sessionStorage.getItem("isHost"),G=sessionStorage.getItem("playerName")||"Anonyme",H=(0,r.useCallback)(async()=>{if(A){if(E>=y){R(!0),T({type:"game_end",data:{players:O}});return}try{let e=await fetch("/api/games/country"),t=await e.json();if(t.error)throw Error(t.error);T({type:"round_start",data:{country:t,roundNumber:E+1}}),N(t),I(e=>e+1),Z(!1),M(null),S([]),v(""),L(g)}catch(e){console.error(e)}}},[A,E,y,T,O,g]);return((0,r.useEffect)(()=>{let e=V[V.length-1];if(e){if("round_start"===e.type){var t;N(e.data.country),I(null!==(t=e.data.roundNumber)&&void 0!==t?t:E+1),Z(!1),M(null),S([]),v(""),L(g),_(!0)}else"player_guess"===e.type?S(t=>t.includes(e.data.player)?t:[...t,e.data.player]):"round_end"===e.type?(M(e.data.winner),e.data.players&&D(e.data.players),Z(!0)):"game_end"===e.type&&(e.data.players&&D(e.data.players),R(!0))}},[V]),(0,r.useEffect)(()=>{let e;return w&&!C&&z>0&&(e=setInterval(()=>L(e=>e<=1?0:e-1),1e3)),w&&!C&&z<=0&&(Z(!0),A&&!P&&T({type:"round_end",data:{winner:null,players:[...O]}})),()=>clearInterval(e)},[w,C,z,A,P,O,T]),(0,r.useEffect)(()=>{G&&0===O.length&&D([{name:G,score:0}])},[G]),F)?(0,s.jsx)("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 p-4 sm:p-6 game-layout text-slate-800 dark:text-slate-100",children:(0,s.jsx)(x.Z,{players:O,roomCode:f,onReplay:()=>{R(!1),D([]),I(0),_(!1)}})}):(0,s.jsx)("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 p-4 sm:p-6 game-layout text-slate-800 dark:text-slate-100",children:(0,s.jsxs)("div",{className:"max-w-2xl mx-auto space-y-4",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-center",children:"FlagGuessr"}),(0,s.jsxs)("p",{className:"text-sm text-slate-600 dark:text-slate-400 text-center",children:["Manche ",E,"/",y," â€¢ Score : ",null!==(t=null===(e=O.find(e=>e.name===G))||void 0===e?void 0:e.score)&&void 0!==t?t:0]}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(p.Z,{roomCode:f,gameType:"flagguessr"})}),!w&&A&&(0,s.jsxs)(n.Z,{className:"p-6 text-center",children:[(0,s.jsx)("p",{className:"mb-4 text-slate-700 dark:text-slate-300",children:"Pr\xeat \xe0 jouer ?"}),(0,s.jsx)(c.z,{onClick:H,className:"rounded-xl",children:"Commencer"})]}),!w&&!A&&(0,s.jsx)(n.Z,{className:"p-6 text-center",children:(0,s.jsx)("p",{className:"text-slate-600 dark:text-slate-400",children:"En attente de l'h\xf4te..."})}),w&&j&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Z,{timeLeft:z,totalSeconds:g}),(0,s.jsxs)(n.Z,{className:"p-6 text-center",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4 text-slate-800 dark:text-slate-100",children:"Quel est ce pays ?"}),(0,s.jsx)("img",{src:j.flagUrl,alt:"Drapeau",className:"w-64 h-40 object-contain mx-auto rounded-lg shadow"})]}),!C&&(0,s.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!b.trim()||!j||C)return;let t=Object.values(j.name).some(e=>e.toLowerCase()===b.toLowerCase().trim());if(T({type:"player_guess",data:{player:G,guess:b.trim()}}),S(e=>e.includes(G)?e:[...e,G]),t&&!P){M(G);let e=[...O],t=e.findIndex(e=>e.name===G);t>=0?e[t].score+=10:e.push({name:G,score:10}),D(e),T({type:"round_end",data:{winner:G,players:e}})}v("")},className:"flex gap-2",children:[(0,s.jsx)(d.I,{type:"text",placeholder:"Nom du pays...",value:b,onChange:e=>v(e.target.value),className:"rounded-xl flex-1"}),(0,s.jsx)(c.z,{type:"submit",className:"rounded-xl",disabled:k.includes(G),children:"Valider"})]}),(0,s.jsx)(m.Z,{answeredPlayers:k}),C&&(0,s.jsxs)(n.Z,{className:"p-6 text-center bg-green-100 dark:bg-green-900/40",children:[(0,s.jsx)(u.Z,{className:"h-10 w-10 text-amber-500 mx-auto mb-2"}),(0,s.jsx)("p",{className:"font-semibold text-slate-800 dark:text-slate-100",children:P?"".concat(P," a trouv\xe9 !"):"Temps \xe9coul\xe9"}),(0,s.jsxs)("p",{className:"text-slate-700 dark:text-slate-300 mt-1",children:["R\xe9ponse : ",(0,s.jsx)("strong",{children:j.name.fr})]}),A&&(0,s.jsx)(c.z,{onClick:H,className:"mt-4 rounded-xl",children:E>=y?"Voir les scores":"Manche suivante"})]})]})]})})}}},function(e){e.O(0,[61,293,902,971,938,744],function(){return e(e.s=5732)}),_N_E=e.O()}]);