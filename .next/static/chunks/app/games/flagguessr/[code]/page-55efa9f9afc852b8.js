(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[458],{5732:function(e,l,t){Promise.resolve().then(t.bind(t,2233))},2233:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return h}});var a=t(7437),s=t(2265),n=t(9313),r=t(4203),i=t(5192),o=t(1291),d=t(8748),c=t(2442),u=t(3008),m=t(2104),x=t(6691),g=t.n(x);function f(e){var l,t,x,f,h,v,p,b;let{roomCode:j,settings:w}=e,[N,y]=(0,s.useState)(""),[_,C]=(0,s.useState)(15),[k,E]=(0,s.useState)(5),[S,T]=(0,s.useState)(15),[M,R]=(0,s.useState)(null),[q,D]=(0,s.useState)("all"),{roomStatus:I,players:z,gameState:A,isHost:L,playerId:O,updateSettings:F,startGame:P,submitAnswer:Z,nextRound:G,updateRoundData:J,setGameStatus:B,updatePlayerScore:H}=(0,o.d)(null!=j?j:"","flagguessr"),{broadcast:K,messages:Q}=(0,i.r)(null!=j?j:"","flagguessr"),U=sessionStorage.getItem("playerName")||"Anonyme",V="in_game"===I,W=(null==A?void 0:A.status)==="round_results"||(null==A?void 0:A.status)==="game_over",X=(null==A?void 0:null===(l=A.round_data)||void 0===l?void 0:l.country)||null,Y=(null==A?void 0:A.current_round)||0,$=(0,s.useMemo)(()=>z.reduce((e,l)=>({...e,[l.name]:l.score}),{}),[z]);(0,s.useEffect)(()=>{(null==A?void 0:A.settings)&&(A.settings.rounds&&E(Number(A.settings.rounds)),A.settings.time&&T(Number(A.settings.time)),A.settings.region&&A.settings.region!==q&&D(A.settings.region))},[null==A?void 0:A.settings]),(0,s.useEffect)(()=>{if(L){let e={rounds:k,time:S,region:q};JSON.stringify(e)!==JSON.stringify(null==A?void 0:A.settings)&&F(e)}},[k,S,q,L]),(0,s.useEffect)(()=>{var e;if(null==A?void 0:null===(e=A.round_data)||void 0===e?void 0:e.endTime){let e=Math.ceil((A.round_data.endTime-Date.now())/1e3);C(e>0?e:0)}},[null==A?void 0:null===(t=A.round_data)||void 0===t?void 0:t.endTime,V,W]),(0,s.useEffect)(()=>{let e;return V&&!W&&_>0&&(e=setInterval(()=>{C(e=>e<=1?(L&&!W&&er(),0):e-1)},1e3)),()=>clearInterval(e)},[V,W,_,L]);let ee=(0,s.useMemo)(()=>{let e=Math.floor(_/60),l=_%60;return"".concat(e.toString().padStart(2,"0"),":").concat(l.toString().padStart(2,"0"))},[_]),el=async e=>{try{let l=await fetch("all"===e?"https://restcountries.com/v3.1/all?fields=name,flags,region,translations":"https://restcountries.com/v3.1/region/".concat(e,"?fields=name,flags,region,translations"));if(!l.ok)return[];return await l.json()}catch(e){return console.error("Error fetching countries",e),[]}},et=async()=>{if(L&&j)try{let e=await el(q);if(0===e.length)return;for(let l=e.length-1;l>0;l--){let t=Math.floor(Math.random()*(l+1));[e[l],e[t]]=[e[t],e[l]]}let l=e.slice(0,k),t=l[0],a=l.slice(1),s=Date.now()+1e3*S;await P({country:t,queue:a,endTime:s}),y("")}catch(e){console.error("Erreur lancement:",e)}},ea=async()=>{if(L&&(null==A?void 0:A.round_data))try{let e=A.round_data.queue||[];if(0===e.length){let e=await el(q),l=e[Math.floor(Math.random()*e.length)],t=Date.now()+1e3*S;await G({country:l,queue:[],endTime:t});return}let l=e[0],t=e.slice(1),a=Date.now()+1e3*S;await G({country:l,queue:t,endTime:a}),y("")}catch(e){console.error("Error next round",e)}},es=e=>e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]/g,""),en=()=>{N.trim()&&!W&&(Z(N.trim()),y(""))},er=async()=>{var e,l,t,a,s;if(!L||!X||!A)return;let n=[X.name.common,X.name.official,null===(l=X.translations)||void 0===l?void 0:null===(e=l.fra)||void 0===e?void 0:e.common,null===(a=X.translations)||void 0===a?void 0:null===(t=a.fra)||void 0===t?void 0:t.official].filter(Boolean).map(e=>es(e||"")),r=A.answers||{},i=[];for(let e of z){let l=null===(s=r[e.id])||void 0===s?void 0:s.answer,t=!1;if(l){let e=es(l);t=n.includes(e)}i.push({player:e.name,answer:l||"-",isCorrect:t}),t&&await H(e.id,e.score+10)}await J({...A.round_data,results:i}),await B("round_results")};return(0,s.useEffect)(()=>{let e=Q[Q.length-1];e&&"typing"===e.type&&(e.data.player!==U&&e.data.isTyping?R(e.data.player):e.data.player===U||e.data.isTyping||R(l=>l===e.data.player?null:l))},[Q,U]),(0,s.useEffect)(()=>{if(!M)return;let e=setTimeout(()=>R(null),3e3);return()=>clearTimeout(e)},[M]),(0,a.jsx)(d.Z,{players:$,roundCount:Y,maxRounds:k,timer:ee,gameCode:null!=j?j:"",gameTitle:"FlagGuessr",isHost:L,gameStarted:V,onStartGame:et,timeLeft:_,typingPlayer:M,children:(0,a.jsx)("div",{className:"flex flex-col items-center justify-center w-full max-w-4xl mx-auto gap-8",children:V?(0,a.jsxs)("div",{className:"w-full flex flex-col items-center gap-6",children:[X&&(0,a.jsx)("div",{className:"relative w-full max-w-md aspect-video bg-black/20 rounded-xl overflow-hidden shadow-2xl border border-white/10",children:(0,a.jsx)(g(),{src:X.flags.svg,alt:"Flag",fill:!0,className:"object-contain p-4",priority:!0})}),W?(0,a.jsxs)("div",{className:"w-full max-w-lg animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,a.jsxs)("div",{className:"bg-white/10 rounded-xl p-6 backdrop-blur-md border border-white/10 text-center mb-6",children:[(0,a.jsx)("h3",{className:"text-xl font-bold mb-2 text-yellow-400",children:"R\xe9ponse correcte"}),(0,a.jsx)("p",{className:"text-3xl font-bold mb-1",children:(null==X?void 0:null===(f=X.translations)||void 0===f?void 0:null===(x=f.fra)||void 0===x?void 0:x.common)||(null==X?void 0:null===(h=X.name)||void 0===h?void 0:h.common)}),(0,a.jsx)("p",{className:"text-sm text-gray-400",children:null==X?void 0:null===(v=X.name)||void 0===v?void 0:v.official})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h4",{className:"text-lg font-semibold mb-2",children:"R\xe9sultats du round"}),null==A?void 0:null===(b=A.round_data)||void 0===b?void 0:null===(p=b.results)||void 0===p?void 0:p.map((e,l)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg ".concat(e.isCorrect?"bg-green-500/20 border border-green-500/30":"bg-red-500/20 border border-red-500/30"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[e.isCorrect?(0,a.jsx)(u.Z,{className:"text-green-400 w-5 h-5"}):(0,a.jsx)(m.Z,{className:"text-red-400 w-5 h-5"}),(0,a.jsx)("span",{className:"font-medium",children:e.player})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("span",{className:"text-sm ".concat(e.isCorrect?"text-green-300":"text-red-300"),children:e.answer||"Aucune r\xe9ponse"}),e.isCorrect&&(0,a.jsx)("span",{className:"text-yellow-400 font-bold",children:"+10"})]})]},l))]}),L&&(0,a.jsx)("div",{className:"mt-8 flex justify-center",children:(0,a.jsx)(n.z,{onClick:ea,className:"bg-blue-600 hover:bg-blue-500 text-lg px-8 py-6 rounded-full shadow-lg shadow-blue-900/20 transition-all hover:scale-105",children:A.current_round>=k?"Terminer la partie":"Round suivant"})})]}):(0,a.jsxs)("div",{className:"w-full max-w-md flex gap-2",children:[(0,a.jsx)(r.I,{value:N,onChange:e=>{y(e.target.value),K({type:"typing",data:{player:U,isTyping:e.target.value.length>0}})},onKeyDown:e=>{"Enter"===e.key&&en()},placeholder:"Quel est ce pays ?",className:"flex-1 bg-white/10 border-white/20 text-lg h-12",autoFocus:!0}),(0,a.jsx)(n.z,{onClick:en,className:"h-12 px-6 bg-green-600 hover:bg-green-500",children:(0,a.jsx)(c.Z,{className:"w-6 h-6"})})]})]}):(0,a.jsxs)("div",{className:"text-center space-y-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"En attente du lancement..."}),L?(0,a.jsxs)("div",{className:"p-4 bg-white/10 rounded-lg backdrop-blur-sm w-full max-w-lg mx-auto",children:[(0,a.jsx)("p",{className:"mb-4 font-semibold",children:"Param\xe8tres de la partie :"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-left mb-6",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("label",{className:"text-sm text-gray-300",children:"Rounds"}),(0,a.jsx)(r.I,{type:"number",min:1,max:20,value:k,onChange:e=>E(Number(e.target.value)),className:"bg-black/20 border-white/10"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("label",{className:"text-sm text-gray-300",children:"Temps (sec)"}),(0,a.jsx)(r.I,{type:"number",min:5,max:60,value:S,onChange:e=>T(Number(e.target.value)),className:"bg-black/20 border-white/10"})]}),(0,a.jsxs)("div",{className:"col-span-2 flex flex-col gap-2",children:[(0,a.jsx)("label",{className:"text-sm text-gray-300",children:"R\xe9gion"}),(0,a.jsxs)("select",{value:q,onChange:e=>D(e.target.value),className:"w-full p-2 rounded bg-black/20 border border-white/10 text-white",children:[(0,a.jsx)("option",{value:"all",children:"Monde entier"}),(0,a.jsx)("option",{value:"europe",children:"Europe"}),(0,a.jsx)("option",{value:"africa",children:"Afrique"}),(0,a.jsx)("option",{value:"americas",children:"Am\xe9riques"}),(0,a.jsx)("option",{value:"asia",children:"Asie"}),(0,a.jsx)("option",{value:"oceania",children:"Oc\xe9anie"})]})]})]}),(0,a.jsx)(n.z,{onClick:et,className:"w-full bg-blue-600 hover:bg-blue-500",children:"Lancer la partie"})]}):(0,a.jsxs)("div",{className:"p-4 bg-white/10 rounded-lg backdrop-blur-sm w-full max-w-lg mx-auto",children:[(0,a.jsx)("p",{className:"mb-2",children:"Param\xe8tres (Lecture seule) :"}),(0,a.jsxs)("ul",{className:"text-left text-sm space-y-1 text-gray-300",children:[(0,a.jsxs)("li",{children:["Rounds: ",k]}),(0,a.jsxs)("li",{children:["Temps: ",S,"s"]}),(0,a.jsxs)("li",{children:["R\xe9gion: ","all"===q?"Monde":q]})]}),(0,a.jsx)("p",{className:"mt-4 text-gray-400 animate-pulse",children:"L'h\xf4te configure la partie..."})]})]})})})}function h(e){let{params:l,searchParams:t}=e;return(0,a.jsx)(f,{roomCode:l.code,settings:t})}}},function(e){e.O(0,[61,226,691,240,971,938,744],function(){return e(e.s=5732)}),_N_E=e.O()}]);