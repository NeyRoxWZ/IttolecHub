(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[618],{6141:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(2898).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},4206:function(e,t,s){Promise.resolve().then(s.bind(s,6921))},6921:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return p}});var l=s(7437),a=s(2265),n=s(9313),r=s(4518),i=s(8748),o=s(2898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let c=(0,o.Z)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);var d=s(7972);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let u=(0,o.Z)("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);var x=s(6141);function m(e){let{roomCode:t,settings:s}=e,[o,m]=(0,a.useState)({}),[p,f]=(0,a.useState)("roles"),[h,g]=(0,a.useState)(null),[b,v]=(0,a.useState)(null),[j,N]=(0,a.useState)(null),[y,w]=(0,a.useState)(null),[I,S]=(0,a.useState)(0),[k,M]=(0,a.useState)(180),[E,T]=(0,a.useState)({}),[C,R]=(0,a.useState)(null),{broadcast:A,presence:O,messages:q}=(0,r.r)(null!=t?t:"","infiltre"),z="true"===sessionStorage.getItem("isHost"),F=sessionStorage.getItem("playerName")||"Anonyme";(0,a.useEffect)(()=>{var e;let t=parseInt(null!==(e=null==s?void 0:s.time)&&void 0!==e?e:"",10);!Number.isNaN(t)&&t>=60?(M(t),S(t)):(M(180),S(180))},[s]);let _=(0,a.useMemo)(()=>O.map(e=>e.playerName).filter(Boolean).sort(),[O]),L=o[F],Z=(0,a.useMemo)(()=>{let e=Math.floor(I/60),t=I%60;return"".concat(e.toString().padStart(2,"0"),":").concat(t.toString().padStart(2,"0"))},[I]),J=async()=>{if(t&&z&&!(_.length<4))try{var e,s;let t=await fetch("/api/games/infiltre"),l=await t.json();if(!t.ok||!l.word){console.error("Erreur Infiltr\xe9 API:",l.error);return}let a=[..._].sort(()=>Math.random()-.5),n=a[0],r=a[1],i={};a.forEach(e=>{e===n?i[e]="MASTER":e===r?i[e]="INFILTR\xc9":i[e]="CITOYEN"}),m(i),g(l.word),v(null!==(e=l.category)&&void 0!==e?e:null),f("question"),N(null),T({}),R(null),S(k),w(null),A({type:"game_init",data:{roles:i,word:l.word,category:null!==(s=l.category)&&void 0!==s?s:null,duration:k}})}catch(e){console.error("Erreur d\xe9marrage Infiltr\xe9:",e)}},Y=e=>{"MASTER"===L&&(w(e),A({type:"answer",data:{answer:e}}))},B=e=>{z&&(N(e),f("vote1"),T({}),R(null),A({type:"word_found",data:{finder:e}}))},V=e=>{t&&F&&(T(t=>({...t,[F]:null!=e?e:""})),A({type:"vote",data:{phase:p,voter:F,target:null!=e?e:null}}))};if((0,a.useEffect)(()=>{let e=q[q.length-1];if(e){if("game_init"===e.type){var t,s;m(e.data.roles),g(e.data.word),v(null!==(t=e.data.category)&&void 0!==t?t:null),f("question"),N(null),T({}),R(null),S(null!==(s=e.data.duration)&&void 0!==s?s:k),w(null)}else"answer"===e.type?w(e.data.answer):"word_found"===e.type?(N(e.data.finder),f("vote1"),T({}),R(null)):"vote"===e.type?T(t=>{var s;return{...t,[e.data.voter]:null!==(s=e.data.target)&&void 0!==s?s:""}}):"vote_result"===e.type?R(e.data.suspect):"game_end"===e.type&&f("end")}},[q,k]),(0,a.useEffect)(()=>{let e;return"question"===p&&I>0&&(e=setInterval(()=>{S(e=>e<=1?(z&&(f("end"),A({type:"game_end",data:{winner:"AUCUN",reason:"time"}})),0):e-1)},1e3)),()=>{e&&clearInterval(e)}},[p,I,z]),!t)return(0,l.jsx)("main",{className:"min-h-screen bg-slate-950 text-slate-50 flex items-center justify-center p-4",children:(0,l.jsx)("p",{className:"text-slate-400 text-center",children:"Code de room introuvable. Reviens \xe0 l'accueil pour cr\xe9er une partie."})});let D=_.length>0?(0,l.jsx)("div",{className:"flex items-center gap-2 overflow-x-auto pb-1",children:_.map(e=>(0,l.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 rounded-full bg-slate-900 border border-slate-800 text-sm shrink-0",children:[(0,l.jsx)("div",{className:"h-7 w-7 rounded-full bg-indigo-600 flex items-center justify-center text-xs font-semibold",children:e.charAt(0).toUpperCase()}),(0,l.jsx)("span",{className:"font-medium text-slate-50 max-w-[120px] truncate",children:e})]},e))}):null,U=(0,l.jsxs)("div",{className:"flex flex-col gap-3 bg-slate-900 p-4 rounded-2xl w-full border border-slate-800",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("span",{className:"text-slate-400 font-medium text-sm",children:["L'Infiltr\xe9 • Room ",t]}),(0,l.jsx)("span",{className:"text-xs text-slate-500 capitalize",children:p})]}),"question"===p&&(0,l.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,l.jsx)("span",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Temps restant"}),(0,l.jsx)("span",{className:"text-2xl font-bold text-indigo-400 tabular-nums",children:Z}),(0,l.jsx)("div",{className:"w-full bg-slate-800 rounded-full h-1.5 overflow-hidden mt-1",children:(0,l.jsx)("div",{className:"h-full bg-indigo-600 transition-all duration-1000",style:{width:"".concat(Math.max(0,I/k*100),"%")}})})]})]}),P=(0,l.jsxs)("div",{className:"bg-slate-900 rounded-3xl p-6 border border-slate-800 flex flex-col items-center text-center w-full shadow-xl",children:[(0,l.jsx)("p",{className:"text-xs text-slate-400 mb-2 uppercase tracking-wide",children:"Ton r\xf4le"}),(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,l.jsx)("div",{className:"h-10 w-10 rounded-full bg-indigo-600 flex items-center justify-center",children:"MASTER"===L?(0,l.jsx)(c,{className:"h-5 w-5 text-slate-50"}):(0,l.jsx)(d.Z,{className:"h-5 w-5 text-slate-50"})}),(0,l.jsxs)("div",{className:"text-left",children:[(0,l.jsx)("p",{className:"text-sm text-slate-400",children:"Tu es"}),(0,l.jsx)("p",{className:"text-lg font-semibold",children:"MASTER"===L?"Ma\xeetre du jeu":"INFILTR\xc9"===L?"Infiltr\xe9":"Citoyen"})]})]}),"MASTER"===L||"INFILTR\xc9"===L?(0,l.jsxs)("div",{className:"w-full rounded-2xl bg-slate-800 px-4 py-3 mb-4",children:[(0,l.jsx)("p",{className:"text-xs text-slate-400 mb-1 uppercase tracking-wide",children:"Mot secret"}),(0,l.jsx)("p",{className:"text-xl font-semibold text-slate-50",children:null!=h?h:"---"}),b&&(0,l.jsx)("p",{className:"text-xs text-slate-400 mt-1",children:b})]}):(0,l.jsxs)("div",{className:"w-full rounded-2xl bg-slate-800 px-4 py-3 mb-4",children:[(0,l.jsx)("p",{className:"text-xs text-slate-400 mb-2 uppercase tracking-wide",children:"Mot secret inconnu"}),(0,l.jsxs)("div",{className:"flex items-center gap-2 text-slate-400 text-sm",children:[(0,l.jsx)(u,{className:"h-4 w-4"}),(0,l.jsx)("span",{children:"Pose des questions intelligentes au Ma\xeetre du jeu pour d\xe9couvrir le mot."})]})]}),"question"===p&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{className:"text-xs text-slate-500 mb-3",children:"Les joueurs posent des questions oralement. Le Ma\xeetre r\xe9pond via l'interface ci‑dessous."}),(0,l.jsxs)("div",{className:"w-full flex flex-col items-center gap-3",children:["MASTER"===L?(0,l.jsxs)("div",{className:"flex flex-col gap-2 w-full",children:[(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,l.jsx)(n.z,{className:"rounded-2xl bg-emerald-500 hover:bg-emerald-400 text-slate-950 text-sm py-2",onClick:()=>Y("yes"),children:"Oui"}),(0,l.jsx)(n.z,{className:"rounded-2xl bg-rose-500 hover:bg-rose-400 text-slate-950 text-sm py-2",onClick:()=>Y("no"),children:"Non"}),(0,l.jsx)(n.z,{className:"rounded-2xl bg-slate-700 hover:bg-slate-600 text-slate-50 text-sm py-2",onClick:()=>Y("maybe"),children:"Je ne sais pas"})]}),(0,l.jsxs)("div",{className:"text-xs text-slate-500 flex items-center gap-1",children:[(0,l.jsx)(x.Z,{className:"h-3 w-3"}),(0,l.jsx)("span",{children:"Quand le mot est trouv\xe9, clique sur le joueur concern\xe9 en dessous pour passer au vote."})]})]}):(0,l.jsx)("div",{className:"text-xs text-slate-500",children:"Attends les r\xe9ponses du Ma\xeetre du jeu et discute avec les autres joueurs."}),y&&(0,l.jsxs)("div",{className:"mt-2 px-3 py-1.5 rounded-full bg-slate-800 text-xs text-slate-200 flex items-center gap-2",children:[(0,l.jsx)("span",{className:"font-medium text-slate-400",children:"Derni\xe8re r\xe9ponse :"}),(0,l.jsx)("span",{className:"uppercase tracking-wide",children:"yes"===y?"OUI":"no"===y?"NON":"JE NE SAIS PAS"})]})]})]}),"vote1"===p&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{className:"text-sm text-slate-200 mb-2 font-medium",children:"Vote 1 : le trouveur est‑il l'Infiltr\xe9 ?"}),(0,l.jsx)("p",{className:"text-xs text-slate-500 mb-3",children:"Si la majorit\xe9 l'accuse et qu'il est Infiltr\xe9, les citoyens gagnent. Sinon, l'Infiltr\xe9 gagne."}),j&&(0,l.jsxs)("div",{className:"mb-3 px-4 py-2 rounded-2xl bg-slate-800 text-sm text-slate-200",children:["Trouveur d\xe9clar\xe9 : ",(0,l.jsx)("span",{className:"font-semibold",children:j})]})]}),"vote2"===p&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{className:"text-sm text-slate-200 mb-2 font-medium",children:"Vote 2 : d\xe9signez l'Infiltr\xe9"}),(0,l.jsx)("p",{className:"text-xs text-slate-500 mb-3",children:"Si la majorit\xe9 trouve le bon Infiltr\xe9, les citoyens gagnent. Sinon, l'Infiltr\xe9 gagne."})]}),"end"===p&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{className:"text-sm text-slate-200 mb-2 font-medium",children:"Fin de la manche"}),(0,l.jsx)("p",{className:"text-xs text-slate-500 mb-3",children:"Lancez une nouvelle partie ou changez de jeu depuis le lobby."})]})]}),X=(0,l.jsxs)("div",{className:"flex flex-col gap-3",children:["roles"===p&&(0,l.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,l.jsx)("p",{className:"text-xs text-slate-500 text-center",children:"En attente du Ma\xeetre de la room pour distribuer les r\xf4les."}),z&&(0,l.jsx)(n.z,{onClick:J,className:"w-full rounded-2xl bg-indigo-600 hover:bg-indigo-500 text-slate-50 py-3 text-base",disabled:_.length<4,children:"Distribuer les r\xf4les & d\xe9marrer"})]}),("vote1"===p||"vote2"===p)&&(0,l.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,l.jsx)("div",{className:"flex flex-wrap gap-2 justify-center",children:_.map(e=>(0,l.jsx)("button",{type:"button",onClick:()=>V(E[F]===e?null:e),className:"px-3 py-1.5 rounded-full text-xs border ".concat(E[F]===e?"bg-indigo-600 border-indigo-500 text-slate-50":"bg-slate-900 border-slate-700 text-slate-200"),children:e},e))}),(0,l.jsx)("p",{className:"text-[11px] text-slate-500 text-center",children:"Tu votes en cliquant sur un joueur. Tu peux cliquer \xe0 nouveau pour annuler ton vote."}),z&&(0,l.jsx)(n.z,{onClick:()=>{var e,t;if(!z)return;let s=Object.entries(E).filter(e=>{let[,t]=e;return t});if(0===s.length)return;let l={};s.forEach(e=>{let[,t]=e;l[t]=(l[t]||0)+1});let a=Object.entries(l).sort((e,t)=>t[1]-e[1]);if(0===a.length)return;let[n,r]=a[0];if(R(n),A({type:"vote_result",data:{phase:p,suspect:n,votes:r,totalVoters:s.length}}),"vote1"===p){if(!j)return;if(n===j){let t=(null===(e=Object.entries(o).find(e=>{let[,t]=e;return"INFILTR\xc9"===t}))||void 0===e?void 0:e[0])===j;f("end"),A({type:"game_end",data:{winner:t?"CITOYENS":"INFILTR\xc9"}})}else f("vote2")}else if("vote2"===p){let e=(null===(t=Object.entries(o).find(e=>{let[,t]=e;return"INFILTR\xc9"===t}))||void 0===t?void 0:t[0])===n;f("end"),A({type:"game_end",data:{winner:e?"CITOYENS":"INFILTR\xc9"}})}},className:"w-full rounded-2xl bg-indigo-600 hover:bg-indigo-500 text-slate-50 py-2.5 text-sm",children:"Clore le vote et appliquer le r\xe9sultat"}),C&&(0,l.jsxs)("div",{className:"text-xs text-center text-slate-300",children:["Suspect principal :"," ",(0,l.jsx)("span",{className:"font-semibold",children:C})]})]}),"question"===p&&"MASTER"===L&&(0,l.jsx)("div",{className:"flex flex-wrap gap-2 justify-center",children:_.map(e=>(0,l.jsxs)("button",{type:"button",onClick:()=>B(e),className:"px-3 py-1.5 rounded-full text-xs border bg-slate-900 border-slate-700 text-slate-200",children:[e," a trouv\xe9 le mot"]},e))})]});return(0,l.jsx)(i.Z,{header:U,main:P,footer:X,playersBar:D})}function p(e){let{params:t,searchParams:s}=e;return(0,l.jsx)(m,{roomCode:t.code,settings:s})}},9313:function(e,t,s){"use strict";s.d(t,{z:function(){return n}});var l=s(7437),a=s(1657);let n=(0,s(2265).forwardRef)((e,t)=>{let{children:s,className:n,variant:r="primary",size:i="md",...o}=e;return(0,l.jsx)("button",{ref:t,className:(0,a.cn)("inline-flex items-center justify-center font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",{primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500 dark:bg-blue-600 dark:text-white dark:hover:bg-blue-700",secondary:"bg-slate-200 text-slate-900 hover:bg-slate-300 focus:ring-slate-500 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600",outline:"border border-slate-300 text-slate-700 hover:bg-slate-50 focus:ring-slate-500 dark:border-slate-600 dark:text-slate-200 dark:hover:bg-slate-800 dark:bg-transparent"}[r],{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[i],n),...o,children:s})});n.displayName="Button"},8748:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});var l=s(7437);function a(e){let{header:t,main:s,footer:a,playersBar:n}=e;return(0,l.jsx)("main",{className:"min-h-screen bg-slate-950 text-slate-50 flex flex-col items-center p-4 sm:p-6 md:p-8",children:(0,l.jsxs)("div",{className:"w-full max-w-xl mx-auto flex flex-col gap-6",children:[t,s,(0,l.jsxs)("div",{className:"flex flex-col gap-4",children:[a,n]})]})})}},4518:function(e,t,s){"use strict";s.d(t,{r:function(){return n}});var l=s(2265);let a=(0,s(3226).eI)("https://vyatvqwsoqalbnbcmhqm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5YXR2cXdzb3FhbGJuYmNtaHFtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3ODkzMDcsImV4cCI6MjA4NzM2NTMwN30.KoTP3iOZmvbzB8RjHlmWIyvdMVpfqoia3-MQxbdL1sY");function n(e,t){let[s,n]=(0,l.useState)([]),[r,i]=(0,l.useState)([]);return(0,l.useEffect)(()=>{let s=a.channel("room:".concat(e));return s.on("presence",{event:"sync"},()=>{n(Object.values(s.presenceState()).flat())}).on("presence",{event:"join"},e=>{let{key:t,newPresences:s}=e;console.log("Nouveau joueur:",s)}).on("presence",{event:"leave"},e=>{let{key:t,leftPresences:s}=e;console.log("Joueur parti:",s)}).on("broadcast",{event:t},e=>{let{payload:t}=e;i(e=>[...e,t])}).subscribe(async e=>{"SUBSCRIBED"===e&&await s.track({playerName:sessionStorage.getItem("playerName")||"Anonyme",gameType:t,joinedAt:new Date().toISOString()})}),()=>{s.unsubscribe()}},[e,t]),{broadcast:s=>{a.channel("room:".concat(e)).send({type:"broadcast",event:t,payload:s})},presence:s,messages:r}}},1657:function(e,t,s){"use strict";s.d(t,{cn:function(){return n}});var l=s(7042),a=s(4769);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,a.m6)((0,l.W)(t))}}},function(e){e.O(0,[61,293,971,938,744],function(){return e(e.s=4206)}),_N_E=e.O()}]);