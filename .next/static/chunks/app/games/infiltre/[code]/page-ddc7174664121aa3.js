(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[618],{2894:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(2898).Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},8291:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(2898).Z)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},2442:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(2898).Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},6141:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(2898).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},7216:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(2898).Z)("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]])},9036:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(2898).Z)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]])},4206:function(e,t,s){Promise.resolve().then(s.bind(s,2421))},2421:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return v}});var l=s(7437),a=s(2265),n=s(9313),r=s(62),i=s(8748),d=s(9036),o=s(6141),c=s(7216),u=s(2898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let x=(0,u.Z)("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),m=(0,u.Z)("Gavel",[["path",{d:"m14 13-7.5 7.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L11 10",key:"c9cbz0"}],["path",{d:"m16 16 6-6",key:"vzrcl6"}],["path",{d:"m8 8 6-6",key:"18bi4p"}],["path",{d:"m9 7 8 8",key:"5jnvq1"}],["path",{d:"m21 11-8-8",key:"z4y7zo"}]]);var h=s(2894),f=s(2442),b=s(8291),p=s(1424);function g(e){var t,s,u;let{roomCode:g}=e,{gameState:v,isHost:j,players:N,playerId:w,startGame:y,updateRoundData:k,nextRound:I,submitAnswer:T}=(0,r.d)(g,"infiltre"),[E,M]=(0,a.useState)(0),[z,C]=(0,a.useState)(null),R=(null==v?void 0:v.round_data)||{},A=R.queue||[],Z=R.phase||"roles",q=R.roles||{},L=w?q[w]:void 0,S=(null==v?void 0:v.answers)||{},O=w&&S[w]?S[w].answer:null,{word:D,category:F,lastAnswer:_,winner:Y,voteResult:U}=R,P=(0,a.useMemo)(()=>N.reduce((e,t)=>({...e,[t.name]:t.score}),{}),[N]);(0,a.useEffect)(()=>{var e;if(null==v?void 0:null===(e=v.round_data)||void 0===e?void 0:e.countdown){let e=Math.ceil((v.round_data.countdown-Date.now())/1e3);if(e>0){C(e);let t=setInterval(()=>{C(e=>e&&e>1?e-1:0)},1e3);return()=>clearInterval(t)}C(null)}else C(null)},[null==v?void 0:null===(t=v.round_data)||void 0===t?void 0:t.countdown]),(0,a.useEffect)(()=>{if("question"===Z&&R.endTime){let e=Math.ceil((R.endTime-Date.now())/1e3);M(e>0?e:0);let t=setInterval(()=>{M(e=>e<=1?0:e-1)},1e3);return()=>clearInterval(t)}},[Z,R.endTime]);let V=async()=>{if(!j)return;let e=Date.now()+3e3;await k({...R,countdown:e}),setTimeout(async()=>{try{let e=await fetch("/api/games/infiltre?count=20"),t=await e.json();if(!Array.isArray(t)){p.Am.error("Erreur chargement mots");return}let s=t[0],l=t.slice(1),a=[...N].sort(()=>Math.random()-.5),n=a[0],r=a[1],i={};N.forEach(e=>{n&&e.id===n.id?i[e.id]="MASTER":r&&e.id===r.id?i[e.id]="INFILTR\xc9":i[e.id]="CITOYEN"}),await k({...R,countdown:null}),await y({queue:l,word:s.word,category:s.category,roles:i,phase:"question",lastAnswer:null,voteResult:null,winner:null,endTime:Date.now()+18e4})}catch(e){console.error(e),p.Am.error("Impossible de d\xe9marrer")}},3e3)},G=async()=>{if(!j)return;if(0===A.length){V();return}let e=A[0],t=A.slice(1),s=[...N].sort(()=>Math.random()-.5),l=s[0],a=s[1],n={};N.forEach(e=>{e.id===(null==l?void 0:l.id)?n[e.id]="MASTER":e.id===(null==a?void 0:a.id)?n[e.id]="INFILTR\xc9":n[e.id]="CITOYEN"}),await I({queue:t,word:e.word,category:e.category,roles:n,phase:"question",lastAnswer:null,voteResult:null,winner:null,endTime:Date.now()+18e4})},J=e=>{"MASTER"===L&&k({...R,lastAnswer:e})},H=async e=>{w&&e&&await T(e)},Q=async()=>{if(!j)return;let e={};Object.values(S).forEach(t=>{let s=t.answer;s&&(e[s]=(e[s]||0)+1)});let t=0,s=null;Object.entries(e).forEach(e=>{let[l,a]=e;a>t&&(t=a,s=l)});let l=Object.keys(q).find(e=>"INFILTR\xc9"===q[e]),a=s===l;k({...R,phase:"end",voteResult:s,winner:a?"CITOYENS":"INFILTR\xc9"})},B=(0,a.useMemo)(()=>{let e=Math.floor(E/60),t=E%60;return"".concat(e.toString().padStart(2,"0"),":").concat(t.toString().padStart(2,"0"))},[E]);return(0,l.jsx)(i.Z,{gameTitle:"L'Infiltr\xe9",roundCount:0,maxRounds:0,timer:B,players:P,timeLeft:E,gameStarted:"roles"!==Z,children:(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center w-full max-w-4xl mx-auto gap-8 animate-in fade-in duration-700",children:[z&&(0,l.jsx)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm animate-in fade-in duration-300",children:(0,l.jsx)("div",{className:"text-9xl font-black text-white animate-pulse",children:z})}),"roles"===Z?(0,l.jsxs)("div",{className:"flex flex-col items-center gap-6 text-center",children:[(0,l.jsx)("div",{className:"w-24 h-24 bg-indigo-500/20 rounded-full flex items-center justify-center animate-pulse",children:(0,l.jsx)(d.Z,{className:"w-12 h-12 text-indigo-400"})}),(0,l.jsx)("h2",{className:"text-3xl font-bold text-white",children:"Pr\xe9parez-vous \xe0 enqu\xeater"}),(0,l.jsx)("p",{className:"text-slate-400 max-w-md",children:"Un joueur est l'Infiltr\xe9. Il ne conna\xeet pas le mot secret. Les Citoyens doivent le d\xe9masquer sans trop en r\xe9v\xe9ler !"}),j?(0,l.jsx)(n.z,{onClick:V,size:"lg",className:"mt-4 bg-indigo-600 hover:bg-indigo-500 text-lg px-8 py-6 rounded-xl shadow-lg shadow-indigo-500/20",disabled:N.length<3,children:N.length<3?"En attente de joueurs (min 3)":"Distribuer les r\xf4les"}):(0,l.jsxs)("div",{className:"flex items-center gap-2 text-indigo-400 bg-indigo-950/30 px-4 py-2 rounded-full border border-indigo-500/30 animate-pulse",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-indigo-400 rounded-full"}),"En attente de l'h\xf4te..."]})]}):(0,l.jsxs)("div",{className:"w-full flex flex-col gap-6",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center bg-slate-900/50 p-4 rounded-xl border border-white/5",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("div",{className:"w-3 h-3 rounded-full animate-pulse ".concat("question"===Z?"bg-emerald-500":"bg-amber-500")}),(0,l.jsx)("span",{className:"text-sm font-bold uppercase tracking-widest text-slate-300",children:"question"===Z?"Phase de questions":"vote"===Z?"Phase de vote":"R\xe9sultats"})]}),"question"===Z&&(0,l.jsxs)("div",{className:"flex items-center gap-2 text-slate-400 font-mono",children:[(0,l.jsx)(o.Z,{className:"w-4 h-4"}),B]})]}),(0,l.jsxs)("div",{className:"w-full bg-slate-800/50 rounded-2xl p-6 border border-white/10 flex flex-col items-center text-center relative overflow-hidden group",children:[(0,l.jsx)("div",{className:"absolute inset-0 opacity-10 ".concat("MASTER"===L?"bg-blue-600":"INFILTR\xc9"===L?"bg-red-600":"bg-emerald-600")}),(0,l.jsx)("p",{className:"text-xs text-slate-400 uppercase tracking-widest mb-2 z-10",children:"Votre r\xf4le"}),(0,l.jsx)("h3",{className:"text-3xl font-black mb-4 z-10 ".concat("MASTER"===L?"text-blue-400":"INFILTR\xc9"===L?"text-red-400":"text-emerald-400"),children:"MASTER"===L?"MA\xceTRE DU JEU":"INFILTR\xc9"===L?"INFILTR\xc9":"CITOYEN"}),(0,l.jsx)("div",{className:"bg-black/40 p-4 rounded-xl w-full max-w-sm backdrop-blur-sm border border-white/5 z-10",children:"INFILTR\xc9"===L?(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsx)(c.Z,{className:"w-8 h-8 text-slate-500 mx-auto mb-2"}),(0,l.jsx)("p",{className:"font-bold text-lg text-white",children:"Mot Secret Inconnu"}),(0,l.jsx)("p",{className:"text-sm text-slate-400",children:"Essayez de deviner le mot gr\xe2ce aux questions des autres !"})]}):(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsx)("div",{className:"text-xs text-slate-500 uppercase tracking-widest",children:"Le mot secret est"}),(0,l.jsx)("p",{className:"font-black text-2xl text-white tracking-tight",children:D}),F&&(0,l.jsx)("p",{className:"text-xs text-blue-400 bg-blue-500/10 px-2 py-1 rounded-full self-center",children:F})]})})]}),"question"===Z&&(0,l.jsxs)("div",{className:"flex flex-col items-center gap-6 animate-in slide-in-from-bottom-4 duration-500",children:[(0,l.jsxs)("div",{className:"w-full max-w-2xl bg-slate-900/50 rounded-2xl p-6 border border-white/5 text-center",children:[(0,l.jsx)(x,{className:"w-10 h-10 text-indigo-400 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-lg text-slate-300 mb-6",children:"Les joueurs posent des questions au Ma\xeetre du Jeu qui ne peut r\xe9pondre que par Oui, Non ou ???"}),_&&(0,l.jsxs)("div",{className:"mb-8 animate-in zoom-in duration-300",children:[(0,l.jsx)("p",{className:"text-xs text-slate-500 uppercase tracking-widest mb-2",children:"Derni\xe8re r\xe9ponse du Ma\xeetre"}),(0,l.jsx)("div",{className:"inline-flex items-center justify-center px-8 py-4 rounded-xl text-2xl font-black border ".concat("yes"===_?"bg-emerald-500/20 text-emerald-400 border-emerald-500/50":"no"===_?"bg-rose-500/20 text-rose-400 border-rose-500/50":"bg-slate-500/20 text-slate-300 border-slate-500/50"),children:"yes"===_?"OUI":"no"===_?"NON":"???"})]}),"MASTER"===L?(0,l.jsxs)("div",{className:"flex gap-2 justify-center w-full",children:[(0,l.jsx)(n.z,{onClick:()=>J("yes"),className:"flex-1 h-14 bg-emerald-600 hover:bg-emerald-500 text-lg font-bold",children:"OUI"}),(0,l.jsx)(n.z,{onClick:()=>J("no"),className:"flex-1 h-14 bg-rose-600 hover:bg-rose-500 text-lg font-bold",children:"NON"}),(0,l.jsx)(n.z,{onClick:()=>J("maybe"),className:"flex-1 h-14 bg-slate-600 hover:bg-slate-500 text-lg font-bold",children:"???"})]}):(0,l.jsx)("p",{className:"text-sm text-slate-500 animate-pulse",children:"En attente d'une r\xe9ponse..."})]}),j&&(0,l.jsxs)(n.z,{onClick:()=>{j&&k({...R,phase:"vote"})},variant:"primary",className:"w-full max-w-sm rounded-xl py-6 bg-red-600 hover:bg-red-700",children:[(0,l.jsx)(m,{className:"w-5 h-5 mr-2"}),"Lancer le vote maintenant"]})]}),"vote"===Z&&(0,l.jsxs)("div",{className:"flex flex-col items-center gap-6 animate-in slide-in-from-bottom-4 duration-500",children:[(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)(h.Z,{className:"w-12 h-12 text-amber-500 mx-auto mb-4 animate-bounce"}),(0,l.jsx)("h3",{className:"text-2xl font-bold text-white mb-2",children:"Qui est l'Infiltr\xe9 ?"}),(0,l.jsx)("p",{className:"text-slate-400",children:"Votez pour la personne que vous soup\xe7onnez."})]}),(0,l.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 w-full",children:N.map(e=>(0,l.jsxs)("button",{onClick:()=>H(e.id),disabled:null!==O,className:"relative p-4 rounded-xl border-2 transition-all ".concat(O===e.id?"bg-indigo-600/20 border-indigo-500 ring-2 ring-indigo-500/50":"bg-slate-800 border-white/5 hover:border-white/20 hover:bg-slate-700"),children:[(0,l.jsx)("div",{className:"font-bold text-lg text-white",children:e.name}),S[e.id]&&j&&(0,l.jsx)("div",{className:"text-xs text-slate-500 mt-1",children:"A vot\xe9"}),O===e.id&&(0,l.jsx)("div",{className:"absolute top-2 right-2 bg-indigo-500 rounded-full p-1",children:(0,l.jsx)(f.Z,{className:"w-3 h-3 text-white"})})]},e.id))}),j&&(0,l.jsx)(n.z,{onClick:Q,className:"w-full max-w-sm mt-4 bg-indigo-600 hover:bg-indigo-500 py-6 rounded-xl",children:"Cl\xf4turer le vote"})]}),"end"===Z&&(0,l.jsx)("div",{className:"w-full max-w-2xl mx-auto animate-in zoom-in-95 duration-500",children:(0,l.jsxs)("div",{className:"bg-slate-900/80 backdrop-blur-xl rounded-3xl p-8 border border-white/10 text-center shadow-2xl overflow-hidden relative",children:[(0,l.jsx)("div",{className:"absolute inset-0 opacity-20 ".concat("CITOYENS"===Y?"bg-emerald-500":"bg-rose-500")}),(0,l.jsx)("h2",{className:"text-4xl font-black text-white mb-2 relative z-10",children:"CITOYENS"===Y?"\uD83C\uDF89 Les Citoyens gagnent !":"\uD83D\uDD75ï¸ L'Infiltr\xe9 gagne !"}),(0,l.jsxs)("div",{className:"mt-8 space-y-4 relative z-10 text-left bg-black/20 p-6 rounded-2xl",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center border-b border-white/10 pb-4",children:[(0,l.jsx)("span",{className:"text-slate-400",children:"Le mot \xe9tait"}),(0,l.jsx)("span",{className:"font-bold text-xl text-white",children:D})]}),(0,l.jsxs)("div",{className:"flex justify-between items-center border-b border-white/10 pb-4",children:[(0,l.jsx)("span",{className:"text-slate-400",children:"L'Infiltr\xe9 \xe9tait"}),(0,l.jsx)("span",{className:"font-bold text-xl text-rose-400",children:(null===(s=N.find(e=>"INFILTR\xc9"===q[e.id]))||void 0===s?void 0:s.name)||"Inconnu"})]}),(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)("span",{className:"text-slate-400",children:"Suspect vot\xe9"}),(0,l.jsx)("span",{className:"font-bold text-xl text-slate-200",children:(null===(u=N.find(e=>e.id===U))||void 0===u?void 0:u.name)||"Aucun"})]})]}),j&&(0,l.jsxs)(n.z,{onClick:G,className:"mt-8 w-full py-6 text-lg font-bold bg-white text-black hover:bg-slate-200 rounded-xl",children:["Manche suivante ",(0,l.jsx)(b.Z,{className:"w-5 h-5 ml-2"})]})]})})]})]})})}function v(e){let{params:t,searchParams:s}=e;return(0,l.jsx)(g,{roomCode:t.code})}}},function(e){e.O(0,[484,226,424,387,971,938,744],function(){return e(e.s=4206)}),_N_E=e.O()}]);