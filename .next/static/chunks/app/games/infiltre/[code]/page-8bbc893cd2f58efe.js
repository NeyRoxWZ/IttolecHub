(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[618],{6141:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(2898).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},9036:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(2898).Z)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]])},7972:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(2898).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},4206:function(e,t,s){Promise.resolve().then(s.bind(s,2697))},2697:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return m}});var l=s(7437),a=s(2265),n=s(9313),r=s(1291),i=s(8748),d=s(9036),c=s(7972),o=s(7216),x=s(1424);function u(e){var t,s,u;let{roomCode:m}=e,{gameState:h,isHost:f,players:p,playerId:g,startGame:N,updateRoundData:j,nextRound:b,submitAnswer:v}=(0,r.d)(m,"infiltre"),[w,y]=(0,a.useState)(0),I=(null==h?void 0:h.round_data)||{},k=I.phase||"roles",E=I.roles||{},M=I.word,T=I.category,R=I.lastAnswer,A=I.voteResult,C=I.winner,S=I.queue||[],L=((null==h?void 0:null===(t=h.settings)||void 0===t?void 0:t.time)?parseInt(h.settings.time,10):180)||180,q=g?E[g]:void 0,F=(null==h?void 0:h.answers)||{},O=g&&F[g]?F[g].answer:null;(0,a.useEffect)(()=>{"question"===k&&y(L)},[k,L]),(0,a.useEffect)(()=>{let e;return"question"===k&&w>0&&(e=setInterval(()=>{y(e=>e<=1?0:e-1)},1e3)),()=>clearInterval(e)},[k,w]),(0,a.useEffect)(()=>{f&&"question"===k&&0===w&&j({...I,phase:"vote"})},[f,k,w,I,j]);let Z=async()=>{if(f)try{let e=await fetch("/api/games/infiltre?count=20"),t=await e.json();if(!Array.isArray(t)){x.Am.error("Erreur chargement mots");return}let s=t[0],l=t.slice(1),a=[...p].sort(()=>Math.random()-.5);a.length;let n=a[0],r=a[1],i={};p.forEach(e=>{e.id===(null==n?void 0:n.id)?i[e.id]="MASTER":e.id===(null==r?void 0:r.id)?i[e.id]="INFILTR\xc9":i[e.id]="CITOYEN"}),await N({queue:l,word:s.word,category:s.category,roles:i,phase:"question",lastAnswer:null,voteResult:null,winner:null})}catch(e){console.error(e),x.Am.error("Impossible de d\xe9marrer")}},z=async()=>{if(!f)return;if(0===S.length){Z();return}let e=S[0],t=S.slice(1),s=[...p].sort(()=>Math.random()-.5),l=s[0],a=s[1],n={};p.forEach(e=>{e.id===(null==l?void 0:l.id)?n[e.id]="MASTER":e.id===(null==a?void 0:a.id)?n[e.id]="INFILTR\xc9":n[e.id]="CITOYEN"}),await b({queue:t,word:e.word,category:e.category,roles:n,phase:"question",lastAnswer:null,voteResult:null,winner:null})},D=e=>{"MASTER"===q&&j({...I,lastAnswer:e})},_=async e=>{g&&e&&await v(e)},Y=async()=>{if(!f)return;let e={};Object.values(F).forEach(t=>{let s=t.answer;s&&(e[s]=(e[s]||0)+1)});let t=0,s=null;Object.entries(e).forEach(e=>{let[l,a]=e;a>t&&(t=a,s=l)});let l=Object.keys(E).find(e=>"INFILTR\xc9"===E[e]),a=s===l;j({...I,phase:"end",voteResult:s,winner:a?"CITOYENS":"INFILTR\xc9"})},P=(0,a.useMemo)(()=>{let e=Math.floor(w/60),t=w%60;return"".concat(e.toString().padStart(2,"0"),":").concat(t.toString().padStart(2,"0"))},[w]),U=(0,l.jsx)("div",{className:"flex items-center gap-2 overflow-x-auto pb-1",children:p.map(e=>(0,l.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 rounded-full border text-sm shrink-0 ".concat("vote"===k&&O===e.id?"bg-indigo-600 border-indigo-500 text-slate-50":"bg-slate-900 border-slate-800 text-slate-50"),children:[(0,l.jsx)("div",{className:"h-7 w-7 rounded-full bg-indigo-600 flex items-center justify-center text-xs font-semibold",children:e.name.charAt(0).toUpperCase()}),(0,l.jsx)("span",{className:"font-medium max-w-[120px] truncate",children:e.name}),"end"===k&&"INFILTR\xc9"===E[e.id]&&(0,l.jsx)("span",{className:"text-[10px] bg-red-500 text-white px-1 rounded",children:"INF"}),"end"===k&&"MASTER"===E[e.id]&&(0,l.jsx)("span",{className:"text-[10px] bg-blue-500 text-white px-1 rounded",children:"GM"})]},e.id))}),G=(0,l.jsxs)("div",{className:"flex flex-col gap-3 bg-slate-900 p-4 rounded-2xl w-full border border-slate-800",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("span",{className:"text-slate-400 font-medium text-sm",children:["L'Infiltr\xe9 • Room ",m]}),(0,l.jsx)("span",{className:"text-xs text-slate-500 capitalize",children:k})]}),"question"===k&&(0,l.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,l.jsx)("span",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Temps restant"}),(0,l.jsx)("span",{className:"text-2xl font-bold text-indigo-400 tabular-nums",children:P}),(0,l.jsx)("div",{className:"w-full bg-slate-800 rounded-full h-1.5 overflow-hidden mt-1",children:(0,l.jsx)("div",{className:"h-full bg-indigo-600 transition-all duration-1000",style:{width:"".concat(Math.max(0,w/L*100),"%")}})})]})]}),V=(0,l.jsx)("div",{className:"bg-slate-900 rounded-3xl p-6 border border-slate-800 flex flex-col items-center text-center w-full shadow-xl",children:"roles"===k?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center py-10",children:[(0,l.jsx)(d.Z,{className:"h-16 w-16 text-slate-700 mb-4"}),(0,l.jsx)("h2",{className:"text-xl font-bold text-slate-200 mb-2",children:"En attente"}),(0,l.jsx)("p",{className:"text-slate-400 text-sm max-w-xs",children:"Le Ma\xeetre du jeu va lancer la partie et distribuer les r\xf4les."})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{className:"text-xs text-slate-400 mb-2 uppercase tracking-wide",children:"Ton r\xf4le"}),(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,l.jsx)("div",{className:"h-10 w-10 rounded-full bg-indigo-600 flex items-center justify-center",children:"MASTER"===q?(0,l.jsx)(d.Z,{className:"h-5 w-5 text-slate-50"}):(0,l.jsx)(c.Z,{className:"h-5 w-5 text-slate-50"})}),(0,l.jsxs)("div",{className:"text-left",children:[(0,l.jsx)("p",{className:"text-sm text-slate-400",children:"Tu es"}),(0,l.jsx)("p",{className:"text-lg font-semibold",children:"MASTER"===q?"Ma\xeetre du jeu":"INFILTR\xc9"===q?"Infiltr\xe9":"Citoyen"})]})]}),"MASTER"===q||"INFILTR\xc9"===q?(0,l.jsxs)("div",{className:"w-full rounded-2xl bg-slate-800 px-4 py-3 mb-4",children:[(0,l.jsx)("p",{className:"text-xs text-slate-400 mb-1 uppercase tracking-wide",children:"Mot secret"}),(0,l.jsx)("p",{className:"text-xl font-semibold text-slate-50",children:null!=M?M:"---"}),T&&(0,l.jsx)("p",{className:"text-xs text-slate-400 mt-1",children:T})]}):(0,l.jsxs)("div",{className:"w-full rounded-2xl bg-slate-800 px-4 py-3 mb-4",children:[(0,l.jsx)("p",{className:"text-xs text-slate-400 mb-2 uppercase tracking-wide",children:"Mot secret inconnu"}),(0,l.jsxs)("div",{className:"flex items-center gap-2 text-slate-400 text-sm justify-center",children:[(0,l.jsx)(o.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{children:"Pose des questions au Ma\xeetre !"})]})]}),"question"===k&&(0,l.jsxs)("div",{className:"w-full flex flex-col items-center gap-3",children:["MASTER"===q?(0,l.jsx)("div",{className:"flex flex-col gap-2 w-full",children:(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,l.jsx)(n.z,{className:"rounded-2xl bg-emerald-500 hover:bg-emerald-400 text-slate-950 text-sm py-2",onClick:()=>D("yes"),children:"Oui"}),(0,l.jsx)(n.z,{className:"rounded-2xl bg-rose-500 hover:bg-rose-400 text-slate-950 text-sm py-2",onClick:()=>D("no"),children:"Non"}),(0,l.jsx)(n.z,{className:"rounded-2xl bg-slate-700 hover:bg-slate-600 text-slate-50 text-sm py-2",onClick:()=>D("maybe"),children:"???"})]})}):(0,l.jsx)("div",{className:"text-xs text-slate-500",children:"Attends les r\xe9ponses du Ma\xeetre du jeu."}),R&&(0,l.jsxs)("div",{className:"mt-2 px-3 py-1.5 rounded-full bg-slate-800 text-xs text-slate-200 flex items-center gap-2",children:[(0,l.jsx)("span",{className:"font-medium text-slate-400",children:"Derni\xe8re r\xe9ponse :"}),(0,l.jsx)("span",{className:"uppercase tracking-wide font-bold text-white",children:"yes"===R?"OUI":"no"===R?"NON":"JE NE SAIS PAS"})]})]}),"vote"===k&&(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsx)("p",{className:"text-sm text-slate-200 mb-2 font-medium",children:"Votez pour d\xe9masquer l'Infiltr\xe9 !"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2 justify-center mt-4",children:p.map(e=>(0,l.jsx)("button",{type:"button",onClick:()=>_(e.id),className:"px-4 py-2 rounded-full text-sm border transition-all ".concat(O===e.id?"bg-indigo-600 border-indigo-500 text-white scale-105 shadow-lg shadow-indigo-500/20":"bg-slate-800 border-slate-700 text-slate-300 hover:bg-slate-700"),children:e.name},e.id))}),(0,l.jsx)("p",{className:"text-xs text-slate-500 mt-4",children:"Le Ma\xeetre du jeu cl\xf4turera le vote."})]}),"end"===k&&(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsx)("p",{className:"text-2xl font-bold text-white mb-2",children:"CITOYENS"===C?"\uD83C\uDF89 Les Citoyens gagnent !":"\uD83D\uDD75️ L'Infiltr\xe9 gagne !"}),(0,l.jsxs)("div",{className:"bg-slate-800 rounded-xl p-4 mt-4 text-left space-y-2",children:[(0,l.jsxs)("p",{className:"text-sm text-slate-400",children:["L'Infiltr\xe9 \xe9tait : ",(0,l.jsx)("span",{className:"text-white font-bold",children:(null===(s=p.find(e=>"INFILTR\xc9"===E[e.id]))||void 0===s?void 0:s.name)||"Inconnu"})]}),(0,l.jsxs)("p",{className:"text-sm text-slate-400",children:["Le suspect vot\xe9 : ",(0,l.jsx)("span",{className:"text-white font-bold",children:(null===(u=p.find(e=>e.id===A))||void 0===u?void 0:u.name)||"Aucun"})]}),(0,l.jsxs)("p",{className:"text-sm text-slate-400",children:["Le mot \xe9tait : ",(0,l.jsx)("span",{className:"text-white font-bold",children:M})]})]})]})]})}),B=(0,l.jsxs)("div",{className:"flex flex-col gap-3",children:[f&&(0,l.jsxs)(l.Fragment,{children:["roles"===k&&(0,l.jsx)(n.z,{onClick:Z,className:"w-full rounded-2xl bg-indigo-600 hover:bg-indigo-500 text-slate-50 py-3 text-base",disabled:p.length<3,children:"Distribuer les r\xf4les & d\xe9marrer"}),"question"===k&&(0,l.jsx)(n.z,{onClick:()=>{f&&j({...I,phase:"vote"})},className:"w-full rounded-2xl bg-rose-600 hover:bg-rose-500 text-slate-50 py-3 text-base",children:"Lancer le vote (Fin du temps)"}),"vote"===k&&(0,l.jsx)(n.z,{onClick:Y,className:"w-full rounded-2xl bg-indigo-600 hover:bg-indigo-500 text-slate-50 py-3 text-base",children:"Cl\xf4turer le vote"}),"end"===k&&(0,l.jsx)(n.z,{onClick:z,className:"w-full rounded-2xl bg-emerald-600 hover:bg-emerald-500 text-slate-50 py-3 text-base",children:"Manche suivante"})]}),!f&&"roles"===k&&(0,l.jsx)("p",{className:"text-xs text-slate-500 text-center",children:"En attente de l'h\xf4te..."})]});return(0,l.jsx)(i.Z,{header:G,main:V,footer:B,playersBar:U})}function m(e){let{params:t,searchParams:s}=e;return(0,l.jsx)(u,{roomCode:t.code})}}},function(e){e.O(0,[61,840,407,906,971,938,744],function(){return e(e.s=4206)}),_N_E=e.O()}]);