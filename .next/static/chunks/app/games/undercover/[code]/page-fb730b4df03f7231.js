(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[697],{2894:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},6141:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},7480:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]])},6264:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},5883:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]])},1182:function(e,t,s){Promise.resolve().then(s.bind(s,4132))},4132:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return y}});var a=s(7437),r=s(2265),l=s(9313),n=s(4203),i=s(62),d=s(8748),c=s(2898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let o=(0,c.Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),u=(0,c.Z)("Skull",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["path",{d:"M8 20v2h8v-2",key:"ded4og"}],["path",{d:"m12.5 17-.5-1-.5 1h1z",key:"3me087"}],["path",{d:"M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20",key:"xq9p5u"}]]);var x=s(2894),m=s(6264);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let h=(0,c.Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),p=(0,c.Z)("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);var f=s(7480),v=s(5883),g=s(1424),b=s(4033);function w(e){var t,s;let{roomCode:c}=e,w=(0,b.useRouter)(),{gameState:y,isHost:j,players:N,playerId:k,startGame:I,updateRoundData:E,nextRound:C,submitAnswer:M,setGameStatus:R}=(0,i.d)(c,"undercover"),[_,T]=(0,r.useState)(""),[W,V]=(0,r.useState)(""),[D,Z]=(0,r.useState)(0),z=(null==y?void 0:y.settings)||{},S=Number(z.rounds||1),L="true"===z.mrWhiteEnabled||!0===z.mrWhiteEnabled,O=Number(z.discussionTime||60),H=Number(z.voteTime||30),A=(null==y?void 0:y.round_data)||{},U=A.phase||"setup",P=A.roles||{},q=k?P[k]:null,F=A.civilWord,Q=A.undercoverWord,K=A.currentSpeaker,B=A.clues||[],G=A.alivePlayers||[],J=A.eliminated,X=A.winner,Y=(null==y?void 0:y.current_round)||0,$=(0,r.useMemo)(()=>N.reduce((e,t)=>({...e,[t.name]:t.score}),{}),[N]),ee="clues"===U&&K===k;k&&G.includes(k),(0,r.useEffect)(()=>{if(A.endTime){let e=Math.ceil((A.endTime-Date.now())/1e3);Z(e>0?e:0)}},[A.endTime]),(0,r.useEffect)(()=>{if(D>0){let e=setInterval(()=>Z(e=>Math.max(0,e-1)),1e3);return()=>clearInterval(e)}},[D]),(0,r.useEffect)(()=>{j&&(async()=>{"roles"===U&&0===D&&await E({...A,phase:"clues",currentSpeaker:G[0],endTime:null}),"discussion"===U&&0===D&&await E({...A,phase:"vote",endTime:Date.now()+1e3*H}),"vote"===U&&0===D&&await ea()})()},[j,U,D,A,G,H]);let et=async()=>{if(j){if(N.length<3){g.Am.error("Il faut au moins 3 joueurs !");return}try{let e=await fetch("/api/games/undercover?count=".concat(S)),t=await e.json();if(!t||0===t.length)return;let s=Array.isArray(t)?t[0]:t,a=Array.isArray(t)?t.slice(1):[],{newRoles:r,alive:l}=es(N,L);await I({civilWord:s.civilWord,undercoverWord:s.undercoverWord,roles:r,alivePlayers:l,phase:"roles",clues:[],queue:a,endTime:Date.now()+5e3})}catch(e){console.error(e),g.Am.error("Erreur au d\xe9marrage")}}},es=(e,t)=>{let s=[...e].sort(()=>Math.random()-.5),a={},r=[],l=[...s],n=l.pop();if(n&&(a[n.id]="UNDERCOVER"),t&&l.length>0){let e=l.pop();e&&(a[e.id]="MR_WHITE")}return l.forEach(e=>a[e.id]="CIVIL"),s.forEach(e=>r.push(e.id)),{newRoles:a,alive:r}},ea=async()=>{let e=(null==y?void 0:y.answers)||{},t={};Object.values(e).forEach(e=>{"vote"===e.type&&e.targetId&&(t[e.targetId]=(t[e.targetId]||0)+1)});let s=0,a=null,r=!1;if(Object.entries(t).forEach(e=>{let[t,l]=e;l>s?(s=l,a=t,r=!1):l===s&&(r=!0)}),r||!a){(0,g.Am)("\xc9galit\xe9 ! Personne n'est \xe9limin\xe9."),await E({...A,phase:"clues",currentSpeaker:G[0]});return}if("MR_WHITE"===P[a]){await E({...A,eliminated:a,phase:"mrwhite_guess",endTime:Date.now()+3e4});return}er(a)},er=async e=>{let t=G.filter(t=>t!==e),s=t.map(e=>P[e]),a=s.includes("UNDERCOVER"),r=s.includes("MR_WHITE"),l=s.filter(e=>"CIVIL"===e).length;a||r?(a?1:0)+(r?1:0)>=l?await el("IMPOSTORS",t):await E({...A,eliminated:e,alivePlayers:t,phase:"clues",currentSpeaker:t[0],endTime:null}):await el("CIVILS",t)},el=async(e,t)=>{await E({...A,winner:e,phase:"results",alivePlayers:t})},en=async()=>{if(!j)return;let e=A.queue||[];if(0===e.length){await R("game_over");return}let t=e[0],s=e.slice(1),{newRoles:a,alive:r}=es(N,z.mrWhiteEnabled);await C({civilWord:t.civilWord,undercoverWord:t.undercoverWord,roles:a,alivePlayers:r,phase:"roles",clues:[],queue:s,endTime:Date.now()+5e3})},ei=async()=>{_.trim()&&(await M({type:"clue",text:_,timestamp:Date.now()}),T(""))},ed=async e=>{await M({type:"vote",targetId:e}),g.Am.success("Vote enregistr\xe9")},ec=async()=>{W.trim()&&await M({type:"guess",text:W})};(0,r.useEffect)(()=>{j&&(null==y?void 0:y.answers)&&(async()=>{let e=y.answers;if("clues"===U&&K){let t=e[K];if(t&&"clue"===t.type&&!B.find(e=>e.playerId===K&&e.text===t.text)){let e=[...B,{playerId:K,text:t.text,timestamp:t.timestamp}],s=(G.indexOf(K)+1)%G.length,a=G[s];0===s?await E({...A,clues:e,currentSpeaker:null,phase:"discussion",endTime:Date.now()+1e3*O}):await E({...A,clues:e,currentSpeaker:a})}}if("mrwhite_guess"===U&&J){let t=e[J];t&&"guess"===t.type&&(t.text.trim().toLowerCase()===(F||"").toLowerCase()?await el("MR_WHITE",G):await er(J))}})()},[j,null==y?void 0:y.answers,U,K,B,G,O,J,F]),(0,r.useEffect)(()=>{var e;j&&(null==y?void 0:null===(e=y.round_data)||void 0===e?void 0:e.phase)==="setup"&&N.length>=3&&et()},[j,null==y?void 0:null===(t=y.round_data)||void 0===t?void 0:t.phase,N.length]);let eo=e=>{switch(e){case"CIVIL":return"text-blue-400";case"UNDERCOVER":return"text-red-500";case"MR_WHITE":return"text-white";default:return"text-gray-400"}};return(0,a.jsx)(d.Z,{players:$,roundCount:Y,maxRounds:S,timer:D>0?"".concat(Math.floor(D/60),":").concat((D%60).toString().padStart(2,"0")):"--:--",gameTitle:"Undercover",gameStarted:"setup"!==U,timeLeft:D,children:(0,a.jsxs)("div",{className:"flex flex-col items-center w-full max-w-4xl mx-auto min-h-[400px]",children:["setup"===U&&(0,a.jsx)("div",{className:"flex flex-col items-center gap-4",children:N.length<3?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o,{className:"w-12 h-12 text-gray-500 animate-pulse"}),(0,a.jsxs)("p",{className:"text-xl font-medium text-gray-400",children:["En attente de joueurs (",N.length,"/3)..."]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.Z,{className:"w-12 h-12 animate-spin text-red-500"}),(0,a.jsx)("p",{className:"text-xl font-medium animate-pulse text-red-200",children:"D\xe9marrage de la mission..."})]})}),"roles"===U&&q&&(0,a.jsxs)("div",{className:"flex flex-col items-center animate-in zoom-in duration-500",children:[(0,a.jsxs)("div",{className:"bg-slate-900/80 p-8 rounded-2xl border border-white/10 text-center max-w-md w-full shadow-[0_0_50px_rgba(239,68,68,0.2)]",children:[(0,a.jsx)("h3",{className:"text-2xl font-bold text-gray-400 mb-6",children:"Votre r\xf4le est"}),(0,a.jsx)("div",{className:"mb-8 flex justify-center",children:(0,a.jsx)("div",{className:"p-6 rounded-full bg-white/5 border-2 ".concat("CIVIL"===q?"border-blue-500":"border-red-500"),children:(e=>{switch(e){case"CIVIL":default:return(0,a.jsx)(o,{className:"w-6 h-6"});case"UNDERCOVER":return(0,a.jsx)(u,{className:"w-6 h-6"});case"MR_WHITE":return(0,a.jsx)(x.Z,{className:"w-6 h-6"})}})(q)})}),(0,a.jsx)("h2",{className:"text-4xl font-black mb-4 ".concat(eo(q)),children:"CIVIL"===q?"CIVIL":"UNDERCOVER"===q?"UNDERCOVER":"MR. WHITE"}),(0,a.jsxs)("div",{className:"bg-white/5 p-4 rounded-xl",children:[(0,a.jsx)("p",{className:"text-sm text-gray-400 mb-1",children:"Votre mot secret :"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-white tracking-widest uppercase",children:"MR_WHITE"===q?"???":"UNDERCOVER"===q?Q:F})]})]}),(0,a.jsxs)("p",{className:"mt-8 text-red-400 animate-pulse",children:["D\xe9but de la partie dans ",D,"s..."]})]}),("clues"===U||"discussion"===U)&&(0,a.jsxs)("div",{className:"w-full max-w-3xl space-y-6",children:[(0,a.jsxs)("div",{className:"bg-slate-900/50 rounded-2xl p-6 border border-white/10 min-h-[300px] max-h-[500px] overflow-y-auto custom-scrollbar",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-gray-400 mb-4 sticky top-0 bg-slate-900/90 py-2 z-10 border-b border-white/5",children:"Indices"}),(0,a.jsxs)("div",{className:"space-y-3",children:[B.map((e,t)=>{var s;let r=(null===(s=N.find(t=>t.id===e.playerId))||void 0===s?void 0:s.name)||"Inconnu";return(0,a.jsxs)("div",{className:"flex items-start gap-3 animate-in fade-in slide-in-from-bottom-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-white/10 flex items-center justify-center text-xs font-bold",children:r.charAt(0)}),(0,a.jsxs)("div",{className:"bg-white/5 px-4 py-2 rounded-r-xl rounded-bl-xl text-white",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500 block mb-0.5",children:r}),'"',e.text,'"']})]},t)}),0===B.length&&(0,a.jsx)("div",{className:"text-center text-gray-600 italic py-10",children:"Aucun indice pour le moment..."})]})]}),"clues"===U&&(0,a.jsx)("div",{className:"bg-slate-900/80 p-4 rounded-xl border border-red-500/30",children:ee?(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n.I,{placeholder:"Donnez votre indice (1 mot)...",value:_,onChange:e=>T(e.target.value),onKeyDown:e=>"Enter"===e.key&&ei(),className:"bg-slate-800 border-white/10",autoFocus:!0}),(0,a.jsx)(l.z,{onClick:ei,className:"bg-red-600 hover:bg-red-500",children:(0,a.jsx)(h,{className:"w-4 h-4"})})]}):(0,a.jsxs)("div",{className:"text-center text-gray-400 flex items-center justify-center gap-2",children:[(0,a.jsx)(m.Z,{className:"w-4 h-4 animate-spin"}),"En attente de ",(null===(s=N.find(e=>e.id===K))||void 0===s?void 0:s.name)||"..."]})}),"discussion"===U&&(0,a.jsx)("div",{className:"text-center bg-red-500/10 p-4 rounded-xl border border-red-500/30 text-red-200 animate-pulse",children:"\uD83D\uDDE3ï¸ Discussion libre ! D\xe9battez pour trouver l'intrus."})]}),"vote"===U&&(0,a.jsxs)("div",{className:"w-full max-w-2xl text-center",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-red-500 mb-8",children:"Votez pour \xe9liminer !"}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:G.filter(e=>e!==k).map(e=>{var t;let s=(null===(t=N.find(t=>t.id===e))||void 0===t?void 0:t.name)||"Inconnu";return(0,a.jsxs)("button",{onClick:()=>ed(e),className:"bg-white/5 hover:bg-red-600/20 border border-white/10 hover:border-red-500 p-6 rounded-xl transition-all group",children:[(0,a.jsx)(u,{className:"w-8 h-8 mx-auto mb-2 text-gray-500 group-hover:text-red-500 transition-colors"}),(0,a.jsx)("span",{className:"font-bold text-lg text-white group-hover:text-red-200",children:s})]},e)})})]}),"mrwhite_guess"===U&&(0,a.jsxs)("div",{className:"w-full max-w-md text-center bg-white/10 p-8 rounded-2xl backdrop-blur-md",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-white mb-4",children:"Mr. White a \xe9t\xe9 d\xe9masqu\xe9 !"}),(0,a.jsx)("p",{className:"text-gray-300 mb-6",children:"Il a une chance de gagner s'il trouve le mot des Civils."}),"MR_WHITE"===q&&J===k?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(n.I,{placeholder:"Quel est le mot des Civils ?",value:W,onChange:e=>V(e.target.value)}),(0,a.jsx)(l.z,{onClick:ec,className:"w-full bg-white text-black hover:bg-gray-200",children:"Tenter ma chance"})]}):(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 text-gray-400",children:[(0,a.jsx)(m.Z,{className:"w-4 h-4 animate-spin"}),"Mr. White r\xe9fl\xe9chit..."]})]}),("results"===U||"game_over"===U)&&(0,a.jsxs)("div",{className:"text-center space-y-8 animate-in zoom-in duration-500",children:[(0,a.jsx)("div",{className:"relative inline-block",children:(0,a.jsx)(p,{className:"w-24 h-24 mx-auto mb-4 ".concat("CIVILS"===X?"text-blue-500":"text-red-500")})}),(0,a.jsx)("h2",{className:"text-5xl font-black text-white uppercase tracking-tighter",children:"CIVILS"===X?"Victoire des Civils":"MR_WHITE"===X?"Victoire de Mr. White":"Victoire des Imposteurs"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 max-w-2xl mx-auto text-left",children:[(0,a.jsxs)("div",{className:"bg-blue-500/10 p-4 rounded-xl border border-blue-500/30",children:[(0,a.jsx)("span",{className:"text-xs text-blue-300 uppercase font-bold",children:"Mot Civil"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-white",children:F})]}),(0,a.jsxs)("div",{className:"bg-red-500/10 p-4 rounded-xl border border-red-500/30",children:[(0,a.jsx)("span",{className:"text-xs text-red-300 uppercase font-bold",children:"Mot Undercover"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-white",children:Q})]})]}),(0,a.jsxs)("div",{className:"bg-white/5 rounded-xl p-6 max-w-2xl mx-auto",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-gray-400 mb-4 text-left",children:"R\xf4les d\xe9voil\xe9s"}),(0,a.jsx)("div",{className:"grid gap-2",children:N.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg bg-white/5",children:[(0,a.jsx)("span",{className:"font-bold text-white",children:e.name}),(0,a.jsx)("span",{className:"font-mono text-sm font-bold ".concat(eo(P[e.id])),children:P[e.id]})]},e.id))})]}),(0,a.jsxs)("div",{className:"flex gap-4 w-full max-w-2xl mx-auto",children:[(0,a.jsxs)(l.z,{variant:"outline",className:"flex-1 h-14",onClick:()=>w.push("/room/".concat(c)),children:[(0,a.jsx)(f.Z,{className:"w-5 h-5 mr-2"})," Retour au lobby"]}),j&&"game_over"!==U&&(0,a.jsx)(l.z,{size:"lg",onClick:en,className:"bg-white text-black hover:bg-gray-200 h-14 px-8 text-lg font-bold rounded-xl flex-1",children:"Manche suivante"}),(!j||"game_over"===U)&&(0,a.jsxs)(l.z,{className:"flex-1 h-14 bg-red-600 hover:bg-red-700 text-white",onClick:()=>w.push("/"),children:[(0,a.jsx)(v.Z,{className:"w-5 h-5 mr-2"})," Quitter"]})]})]})]})})}function y(e){let{params:t,searchParams:s}=e;return(0,a.jsx)(w,{roomCode:t.code})}},4203:function(e,t,s){"use strict";s.d(t,{I:function(){return l}});var a=s(7437),r=s(1657);let l=(0,s(2265).forwardRef)((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("input",{ref:t,className:(0,r.cn)("flex h-10 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm","placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent","disabled:cursor-not-allowed disabled:opacity-50","dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100 dark:placeholder:text-slate-400",s),...l})});l.displayName="Input"},4033:function(e,t,s){e.exports=s(5313)}},function(e){e.O(0,[484,226,424,387,971,938,744],function(){return e(e.s=1182)}),_N_E=e.O()}]);