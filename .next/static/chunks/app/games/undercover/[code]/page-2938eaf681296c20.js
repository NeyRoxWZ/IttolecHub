(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[697],{2894:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(2898).Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},6141:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(2898).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},6264:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(2898).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},1182:function(e,t,r){Promise.resolve().then(r.bind(r,4132))},4132:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return b}});var s=r(7437),a=r(2265),l=r(9313),i=r(4203),n=r(62),d=r(8748),c=r(2898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let o=(0,c.Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),u=(0,c.Z)("Skull",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["path",{d:"M8 20v2h8v-2",key:"ded4og"}],["path",{d:"m12.5 17-.5-1-.5 1h1z",key:"3me087"}],["path",{d:"M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20",key:"xq9p5u"}]]);var x=r(2894),m=r(6264);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let h=(0,c.Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),p=(0,c.Z)("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);var f=r(1424);function v(e){var t,r;let{roomCode:c}=e,{gameState:v,isHost:b,players:g,playerId:w,startGame:y,updateRoundData:j,nextRound:N,submitAnswer:k,setGameStatus:I}=(0,n.d)(c,"undercover"),[E,C]=(0,a.useState)(""),[M,R]=(0,a.useState)(""),[_,T]=(0,a.useState)(0),W=(null==v?void 0:v.settings)||{},D=Number(W.rounds||1),V="true"===W.mrWhiteEnabled||!0===W.mrWhiteEnabled,S=Number(W.discussionTime||60),Z=Number(W.voteTime||30),z=(null==v?void 0:v.round_data)||{},L=z.phase||"setup",O=z.roles||{},A=w?O[w]:null,H=z.civilWord,U=z.undercoverWord,P=z.currentSpeaker,q=z.clues||[],F=z.alivePlayers||[],K=z.eliminated,Q=z.winner,B=(null==v?void 0:v.current_round)||0,G=(0,a.useMemo)(()=>g.reduce((e,t)=>({...e,[t.name]:t.score}),{}),[g]),J="clues"===L&&P===w;w&&F.includes(w),(0,a.useEffect)(()=>{if(z.endTime){let e=Math.ceil((z.endTime-Date.now())/1e3);T(e>0?e:0)}},[z.endTime]),(0,a.useEffect)(()=>{if(_>0){let e=setInterval(()=>T(e=>Math.max(0,e-1)),1e3);return()=>clearInterval(e)}},[_]),(0,a.useEffect)(()=>{b&&(async()=>{"roles"===L&&0===_&&await j({...z,phase:"clues",currentSpeaker:F[0],endTime:null}),"discussion"===L&&0===_&&await j({...z,phase:"vote",endTime:Date.now()+1e3*Z}),"vote"===L&&0===_&&await $()})()},[b,L,_,z,F,Z]);let X=async()=>{if(b){if(g.length<3){f.Am.error("Il faut au moins 3 joueurs !");return}try{let e=await fetch("/api/games/undercover?count=".concat(D)),t=await e.json();if(!t||0===t.length)return;let r=Array.isArray(t)?t[0]:t,s=Array.isArray(t)?t.slice(1):[],{newRoles:a,alive:l}=Y(g,V);await y({civilWord:r.civilWord,undercoverWord:r.undercoverWord,roles:a,alivePlayers:l,phase:"roles",clues:[],queue:s,endTime:Date.now()+5e3})}catch(e){console.error(e),f.Am.error("Erreur au d\xe9marrage")}}},Y=(e,t)=>{let r=[...e].sort(()=>Math.random()-.5),s={},a=[],l=[...r],i=l.pop();if(i&&(s[i.id]="UNDERCOVER"),t&&l.length>0){let e=l.pop();e&&(s[e.id]="MR_WHITE")}return l.forEach(e=>s[e.id]="CIVIL"),r.forEach(e=>a.push(e.id)),{newRoles:s,alive:a}},$=async()=>{let e=(null==v?void 0:v.answers)||{},t={};Object.values(e).forEach(e=>{"vote"===e.type&&e.targetId&&(t[e.targetId]=(t[e.targetId]||0)+1)});let r=0,s=null,a=!1;if(Object.entries(t).forEach(e=>{let[t,l]=e;l>r?(r=l,s=t,a=!1):l===r&&(a=!0)}),a||!s){(0,f.Am)("\xc9galit\xe9 ! Personne n'est \xe9limin\xe9."),await j({...z,phase:"clues",currentSpeaker:F[0]});return}if("MR_WHITE"===O[s]){await j({...z,eliminated:s,phase:"mrwhite_guess",endTime:Date.now()+3e4});return}ee(s)},ee=async e=>{let t=F.filter(t=>t!==e),r=t.map(e=>O[e]),s=r.includes("UNDERCOVER"),a=r.includes("MR_WHITE"),l=r.filter(e=>"CIVIL"===e).length;s||a?(s?1:0)+(a?1:0)>=l?await et("IMPOSTORS",t):await j({...z,eliminated:e,alivePlayers:t,phase:"clues",currentSpeaker:t[0],endTime:null}):await et("CIVILS",t)},et=async(e,t)=>{await j({...z,winner:e,phase:"results",alivePlayers:t})},er=async()=>{if(!b)return;let e=z.queue||[];if(0===e.length){await I("game_over");return}let t=e[0],r=e.slice(1),{newRoles:s,alive:a}=Y(g,W.mrWhiteEnabled);await N({civilWord:t.civilWord,undercoverWord:t.undercoverWord,roles:s,alivePlayers:a,phase:"roles",clues:[],queue:r,endTime:Date.now()+5e3})},es=async()=>{E.trim()&&(await k({type:"clue",text:E,timestamp:Date.now()}),C(""))},ea=async e=>{await k({type:"vote",targetId:e}),f.Am.success("Vote enregistr\xe9")},el=async()=>{M.trim()&&await k({type:"guess",text:M})};(0,a.useEffect)(()=>{b&&(null==v?void 0:v.answers)&&(async()=>{let e=v.answers;if("clues"===L&&P){let t=e[P];if(t&&"clue"===t.type&&!q.find(e=>e.playerId===P&&e.text===t.text)){let e=[...q,{playerId:P,text:t.text,timestamp:t.timestamp}],r=(F.indexOf(P)+1)%F.length,s=F[r];0===r?await j({...z,clues:e,currentSpeaker:null,phase:"discussion",endTime:Date.now()+1e3*S}):await j({...z,clues:e,currentSpeaker:s})}}if("mrwhite_guess"===L&&K){let t=e[K];t&&"guess"===t.type&&(t.text.trim().toLowerCase()===(H||"").toLowerCase()?await et("MR_WHITE",F):await ee(K))}})()},[b,null==v?void 0:v.answers,L,P,q,F,S,K,H]),(0,a.useEffect)(()=>{var e;b&&(null==v?void 0:null===(e=v.round_data)||void 0===e?void 0:e.phase)==="setup"&&X()},[b,null==v?void 0:null===(t=v.round_data)||void 0===t?void 0:t.phase]);let ei=e=>{switch(e){case"CIVIL":return"text-blue-400";case"UNDERCOVER":return"text-red-500";case"MR_WHITE":return"text-white";default:return"text-gray-400"}};return(0,s.jsx)(d.Z,{players:G,roundCount:B,maxRounds:D,timer:_>0?"".concat(Math.floor(_/60),":").concat((_%60).toString().padStart(2,"0")):"--:--",gameTitle:"Undercover",gameStarted:"setup"!==L,timeLeft:_,children:(0,s.jsxs)("div",{className:"flex flex-col items-center w-full max-w-4xl mx-auto min-h-[400px]",children:["setup"===L&&(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsx)(m.Z,{className:"w-12 h-12 animate-spin text-red-500"}),(0,s.jsx)("p",{className:"text-xl font-medium animate-pulse text-red-200",children:"D\xe9marrage de la mission..."})]}),"roles"===L&&A&&(0,s.jsxs)("div",{className:"flex flex-col items-center animate-in zoom-in duration-500",children:[(0,s.jsxs)("div",{className:"bg-slate-900/80 p-8 rounded-2xl border border-white/10 text-center max-w-md w-full shadow-[0_0_50px_rgba(239,68,68,0.2)]",children:[(0,s.jsx)("h3",{className:"text-2xl font-bold text-gray-400 mb-6",children:"Votre r\xf4le est"}),(0,s.jsx)("div",{className:"mb-8 flex justify-center",children:(0,s.jsx)("div",{className:"p-6 rounded-full bg-white/5 border-2 ".concat("CIVIL"===A?"border-blue-500":"border-red-500"),children:(e=>{switch(e){case"CIVIL":default:return(0,s.jsx)(o,{className:"w-6 h-6"});case"UNDERCOVER":return(0,s.jsx)(u,{className:"w-6 h-6"});case"MR_WHITE":return(0,s.jsx)(x.Z,{className:"w-6 h-6"})}})(A)})}),(0,s.jsx)("h2",{className:"text-4xl font-black mb-4 ".concat(ei(A)),children:"CIVIL"===A?"CIVIL":"UNDERCOVER"===A?"UNDERCOVER":"MR. WHITE"}),(0,s.jsxs)("div",{className:"bg-white/5 p-4 rounded-xl",children:[(0,s.jsx)("p",{className:"text-sm text-gray-400 mb-1",children:"Votre mot secret :"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-white tracking-widest uppercase",children:"MR_WHITE"===A?"???":"UNDERCOVER"===A?U:H})]})]}),(0,s.jsxs)("p",{className:"mt-8 text-red-400 animate-pulse",children:["D\xe9but de la partie dans ",_,"s..."]})]}),("clues"===L||"discussion"===L)&&(0,s.jsxs)("div",{className:"w-full max-w-3xl space-y-6",children:[(0,s.jsxs)("div",{className:"bg-slate-900/50 rounded-2xl p-6 border border-white/10 min-h-[300px] max-h-[500px] overflow-y-auto custom-scrollbar",children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-gray-400 mb-4 sticky top-0 bg-slate-900/90 py-2 z-10 border-b border-white/5",children:"Indices"}),(0,s.jsxs)("div",{className:"space-y-3",children:[q.map((e,t)=>{var r;let a=(null===(r=g.find(t=>t.id===e.playerId))||void 0===r?void 0:r.name)||"Inconnu";return(0,s.jsxs)("div",{className:"flex items-start gap-3 animate-in fade-in slide-in-from-bottom-2",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-white/10 flex items-center justify-center text-xs font-bold",children:a.charAt(0)}),(0,s.jsxs)("div",{className:"bg-white/5 px-4 py-2 rounded-r-xl rounded-bl-xl text-white",children:[(0,s.jsx)("span",{className:"text-xs text-gray-500 block mb-0.5",children:a}),'"',e.text,'"']})]},t)}),0===q.length&&(0,s.jsx)("div",{className:"text-center text-gray-600 italic py-10",children:"Aucun indice pour le moment..."})]})]}),"clues"===L&&(0,s.jsx)("div",{className:"bg-slate-900/80 p-4 rounded-xl border border-red-500/30",children:J?(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(i.I,{placeholder:"Donnez votre indice (1 mot)...",value:E,onChange:e=>C(e.target.value),onKeyDown:e=>"Enter"===e.key&&es(),className:"bg-slate-800 border-white/10",autoFocus:!0}),(0,s.jsx)(l.z,{onClick:es,className:"bg-red-600 hover:bg-red-500",children:(0,s.jsx)(h,{className:"w-4 h-4"})})]}):(0,s.jsxs)("div",{className:"text-center text-gray-400 flex items-center justify-center gap-2",children:[(0,s.jsx)(m.Z,{className:"w-4 h-4 animate-spin"}),"En attente de ",(null===(r=g.find(e=>e.id===P))||void 0===r?void 0:r.name)||"..."]})}),"discussion"===L&&(0,s.jsx)("div",{className:"text-center bg-red-500/10 p-4 rounded-xl border border-red-500/30 text-red-200 animate-pulse",children:"\uD83D\uDDE3ï¸ Discussion libre ! D\xe9battez pour trouver l'intrus."})]}),"vote"===L&&(0,s.jsxs)("div",{className:"w-full max-w-2xl text-center",children:[(0,s.jsx)("h2",{className:"text-3xl font-bold text-red-500 mb-8",children:"Votez pour \xe9liminer !"}),(0,s.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:F.filter(e=>e!==w).map(e=>{var t;let r=(null===(t=g.find(t=>t.id===e))||void 0===t?void 0:t.name)||"Inconnu";return(0,s.jsxs)("button",{onClick:()=>ea(e),className:"bg-white/5 hover:bg-red-600/20 border border-white/10 hover:border-red-500 p-6 rounded-xl transition-all group",children:[(0,s.jsx)(u,{className:"w-8 h-8 mx-auto mb-2 text-gray-500 group-hover:text-red-500 transition-colors"}),(0,s.jsx)("span",{className:"font-bold text-lg text-white group-hover:text-red-200",children:r})]},e)})})]}),"mrwhite_guess"===L&&(0,s.jsxs)("div",{className:"w-full max-w-md text-center bg-white/10 p-8 rounded-2xl backdrop-blur-md",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-white mb-4",children:"Mr. White a \xe9t\xe9 d\xe9masqu\xe9 !"}),(0,s.jsx)("p",{className:"text-gray-300 mb-6",children:"Il a une chance de gagner s'il trouve le mot des Civils."}),"MR_WHITE"===A&&K===w?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(i.I,{placeholder:"Quel est le mot des Civils ?",value:M,onChange:e=>R(e.target.value)}),(0,s.jsx)(l.z,{onClick:el,className:"w-full bg-white text-black hover:bg-gray-200",children:"Tenter ma chance"})]}):(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2 text-gray-400",children:[(0,s.jsx)(m.Z,{className:"w-4 h-4 animate-spin"}),"Mr. White r\xe9fl\xe9chit..."]})]}),("results"===L||"game_over"===L)&&(0,s.jsxs)("div",{className:"text-center space-y-8 animate-in zoom-in duration-500",children:[(0,s.jsx)("div",{className:"relative inline-block",children:(0,s.jsx)(p,{className:"w-24 h-24 mx-auto mb-4 ".concat("CIVILS"===Q?"text-blue-500":"text-red-500")})}),(0,s.jsx)("h2",{className:"text-5xl font-black text-white uppercase tracking-tighter",children:"CIVILS"===Q?"Victoire des Civils":"MR_WHITE"===Q?"Victoire de Mr. White":"Victoire des Imposteurs"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 max-w-2xl mx-auto text-left",children:[(0,s.jsxs)("div",{className:"bg-blue-500/10 p-4 rounded-xl border border-blue-500/30",children:[(0,s.jsx)("span",{className:"text-xs text-blue-300 uppercase font-bold",children:"Mot Civil"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-white",children:H})]}),(0,s.jsxs)("div",{className:"bg-red-500/10 p-4 rounded-xl border border-red-500/30",children:[(0,s.jsx)("span",{className:"text-xs text-red-300 uppercase font-bold",children:"Mot Undercover"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-white",children:U})]})]}),(0,s.jsxs)("div",{className:"bg-white/5 rounded-xl p-6 max-w-2xl mx-auto",children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-gray-400 mb-4 text-left",children:"R\xf4les d\xe9voil\xe9s"}),(0,s.jsx)("div",{className:"grid gap-2",children:g.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg bg-white/5",children:[(0,s.jsx)("span",{className:"font-bold text-white",children:e.name}),(0,s.jsx)("span",{className:"font-mono text-sm font-bold ".concat(ei(O[e.id])),children:O[e.id]})]},e.id))})]}),b&&(0,s.jsx)(l.z,{size:"lg",onClick:er,className:"bg-white text-black hover:bg-gray-200 h-14 px-8 text-lg font-bold rounded-xl",children:"Manche suivante"})]})]})})}function b(e){let{params:t,searchParams:r}=e;return(0,s.jsx)(v,{roomCode:t.code})}},4203:function(e,t,r){"use strict";r.d(t,{I:function(){return l}});var s=r(7437),a=r(1657);let l=(0,r(2265).forwardRef)((e,t)=>{let{className:r,...l}=e;return(0,s.jsx)("input",{ref:t,className:(0,a.cn)("flex h-10 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm","placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent","disabled:cursor-not-allowed disabled:opacity-50","dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100 dark:placeholder:text-slate-400",r),...l})});l.displayName="Input"}},function(e){e.O(0,[484,226,424,387,971,938,744],function(){return e(e.s=1182)}),_N_E=e.O()}]);