(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[697],{1182:function(e,t,s){Promise.resolve().then(s.bind(s,6603))},6603:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return x}});var l=s(7437),a=s(2265),r=s(9313),n=s(4203),i=s(4518),o=s(8748),c=s(7972);function d(e){let{roomCode:t,settings:s}=e,[d,x]=(0,a.useState)({}),[m,p]=(0,a.useState)("roles"),[f,h]=(0,a.useState)(null),[g,b]=(0,a.useState)(null),[v,j]=(0,a.useState)([]),[N,y]=(0,a.useState)(null),[w,I]=(0,a.useState)({}),[E,k]=(0,a.useState)({}),[C,S]=(0,a.useState)(null),[R,_]=(0,a.useState)(""),[W,M]=(0,a.useState)(null),{broadcast:O,presence:V,messages:z}=(0,i.r)(null!=t?t:"","undercover"),T="true"===sessionStorage.getItem("isHost"),D=sessionStorage.getItem("playerName")||"Anonyme",L=(0,a.useMemo)(()=>V.map(e=>e.playerName).filter(Boolean).sort(),[V]),U=d[D],H=!C||!C||C!==D,F=async()=>{if(t&&T&&!(L.length<4))try{let e=await fetch("/api/games/undercover"),t=await e.json();if(!e.ok||!t.civilWord||!t.undercoverWord){console.error("Erreur API Undercover:",t.error);return}let s=[...L].sort(()=>Math.random()-.5),l=s[0],a=s[1],r={};s.forEach(e=>{e===l?r[e]="MR_WHITE":e===a?r[e]="UNDERCOVER":r[e]="CIVIL"}),x(r),h(t.civilWord),b(t.undercoverWord),j(s),y(s[0]),p("clues"),I({}),k({}),S(null),_(""),M(null),O({type:"game_init",data:{roles:r,civilWord:t.civilWord,undercoverWord:t.undercoverWord,players:s}})}catch(e){console.error("Erreur d\xe9marrage Undercover:",e)}},J=e=>{t&&D&&"vote"===m&&H&&(k(t=>({...t,[D]:null!=e?e:""})),O({type:"vote",data:{voter:D,target:null!=e?e:null}}))},Z=()=>{if("mrwhite_guess"!==m||!C)return;let e=R.trim().toLowerCase();if(!e||!f)return;let t=f.toLowerCase()===e;M(t?"MR_WHITE":"CIVILS"),p("end"),O({type:"game_end",data:{winner:t?"MR_WHITE":"CIVILS"}})};if((0,a.useEffect)(()=>{var e,t;let s=z[z.length-1];s&&("game_init"===s.type?(x(s.data.roles),h(s.data.civilWord),b(s.data.undercoverWord),j(s.data.players),y(null!==(e=s.data.players[0])&&void 0!==e?e:null),p("clues"),I({}),k({}),S(null),M(null)):"clue"===s.type?I(e=>({...e,[s.data.player]:s.data.clue})):"turn"===s.type?y(s.data.currentSpeaker):"phase"===s.type?p(s.data.phase):"vote"===s.type?k(e=>{var t;return{...e,[s.data.voter]:null!==(t=s.data.target)&&void 0!==t?t:""}}):"elimination"===s.type?S(s.data.eliminated):"game_end"===s.type&&(M(null!==(t=s.data.winner)&&void 0!==t?t:null),p("end")))},[z]),!t)return(0,l.jsx)("main",{className:"min-h-screen bg-slate-950 text-slate-50 flex items-center justify-center p-4",children:(0,l.jsx)("p",{className:"text-slate-400 text-center",children:"Code de room introuvable. Reviens \xe0 l'accueil pour cr\xe9er une partie."})});let q=v.length>0?(0,l.jsx)("div",{className:"flex items-center gap-2 overflow-x-auto pb-1",children:v.map(e=>(0,l.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 rounded-full border text-sm shrink-0 ".concat(C===e?"border-rose-500 bg-rose-500/10 text-rose-100":"bg-slate-900 border-slate-800 text-slate-50"),children:[(0,l.jsx)("div",{className:"h-7 w-7 rounded-full bg-indigo-600 flex items-center justify-center text-xs font-semibold",children:e.charAt(0).toUpperCase()}),(0,l.jsx)("span",{className:"font-medium max-w-[120px] truncate",children:e})]},e))}):null,A=(0,l.jsxs)("div",{className:"flex flex-col gap-3 bg-slate-900 p-4 rounded-2xl w-full border border-slate-800",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("span",{className:"text-slate-400 font-medium text-sm",children:["Undercover • Room ",t]}),(0,l.jsx)("span",{className:"text-xs text-slate-500 capitalize",children:m})]}),(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("div",{className:"h-9 w-9 rounded-full bg-indigo-600 flex items-center justify-center",children:(0,l.jsx)(c.Z,{className:"h-5 w-5 text-slate-50"})}),(0,l.jsxs)("div",{className:"text-left",children:[(0,l.jsx)("p",{className:"text-xs text-slate-400",children:"Tu es"}),(0,l.jsx)("p",{className:"text-lg font-semibold",children:"CIVIL"===U?"Civil":"UNDERCOVER"===U?"Undercover":"MR_WHITE"===U?"Mr. White":"Observateur"})]})]})]}),B=(0,l.jsxs)("div",{className:"bg-slate-900 rounded-3xl p-6 border border-slate-800 flex flex-col items-center text-center w-full shadow-xl",children:["roles"===m&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{className:"text-sm text-slate-200 mb-2 font-medium",children:"En attente de lancement"}),(0,l.jsx)("p",{className:"text-xs text-slate-500",children:"Le Ma\xeetre de la room distribue les r\xf4les et lance la partie."})]}),("clues"===m||"vote"===m||"mrwhite_guess"===m)&&(0,l.jsxs)(l.Fragment,{children:["CIVIL"===U&&(0,l.jsxs)("div",{className:"w-full rounded-2xl bg-slate-800 px-4 py-3 mb-4",children:[(0,l.jsx)("p",{className:"text-xs text-slate-400 mb-1 uppercase tracking-wide",children:"Ton mot"}),(0,l.jsx)("p",{className:"text-xl font-semibold text-slate-50",children:null!=f?f:"---"})]}),"UNDERCOVER"===U&&(0,l.jsxs)("div",{className:"w-full rounded-2xl bg-slate-800 px-4 py-3 mb-4",children:[(0,l.jsx)("p",{className:"text-xs text-slate-400 mb-1 uppercase tracking-wide",children:"Ton mot (Undercover)"}),(0,l.jsx)("p",{className:"text-xl font-semibold text-slate-50",children:null!=g?g:"---"})]}),"MR_WHITE"===U&&(0,l.jsxs)("div",{className:"w-full rounded-2xl bg-slate-800 px-4 py-3 mb-4",children:[(0,l.jsx)("p",{className:"text-xs text-slate-400 mb-1 uppercase tracking-wide",children:"Ton r\xf4le"}),(0,l.jsx)("p",{className:"text-sm text-slate-200",children:"Tu n'as pas de mot. Observe les indices pour deviner celui des civils."})]})]}),"clues"===m&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{className:"text-sm text-slate-200 mb-2 font-medium",children:"Phase des indices"}),(0,l.jsx)("p",{className:"text-xs text-slate-500 mb-4",children:"\xc0 tour de r\xf4le, chaque joueur donne un seul mot indice."}),N&&(0,l.jsxs)("div",{className:"mb-3 px-4 py-2 rounded-2xl bg-slate-800 text-sm text-slate-200",children:["C'est au tour de"," ",(0,l.jsx)("span",{className:"font-semibold",children:N}),"."]}),(0,l.jsx)("div",{className:"w-full space-y-2",children:v.map(e=>(0,l.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 rounded-2xl bg-slate-800",children:[(0,l.jsx)("span",{className:"text-sm text-slate-200",children:e}),(0,l.jsx)("span",{className:"text-xs text-slate-400",children:w[e]?w[e]:"—"})]},e))})]}),"vote"===m&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{className:"text-sm text-slate-200 mb-2 font-medium",children:"Phase de vote"}),(0,l.jsx)("p",{className:"text-xs text-slate-500 mb-4",children:"Votez pour \xe9liminer le joueur que vous pensez \xeatre suspect."}),(0,l.jsx)("div",{className:"w-full space-y-2",children:v.map(e=>{var t;return(0,l.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 rounded-2xl bg-slate-800",children:[(0,l.jsx)("span",{className:"text-sm text-slate-200",children:e}),(0,l.jsxs)("span",{className:"text-xs text-slate-400",children:["Indice : ",null!==(t=w[e])&&void 0!==t?t:"—"]})]},e)})})]}),"mrwhite_guess"===m&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{className:"text-sm text-slate-200 mb-2 font-medium",children:"Mr. White tente de deviner le mot"}),(0,l.jsx)("p",{className:"text-xs text-slate-500 mb-4",children:"S'il devine correctement le mot des civils, il gagne la partie."})]}),"end"===m&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{className:"text-sm text-slate-200 mb-2 font-medium",children:"Fin de la manche"}),W&&(0,l.jsxs)("p",{className:"text-xs text-slate-400 mb-2",children:["Gagnants : ",(0,l.jsx)("span",{className:"font-semibold",children:W})]}),(0,l.jsx)("p",{className:"text-xs text-slate-500",children:"Lancez une nouvelle partie ou changez de jeu depuis le lobby."})]})]}),P=(0,l.jsxs)("div",{className:"flex flex-col gap-3",children:["roles"===m&&(0,l.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,l.jsx)("p",{className:"text-xs text-slate-500 text-center",children:"En attente du Ma\xeetre de la room pour distribuer les r\xf4les."}),T&&(0,l.jsx)(r.z,{onClick:F,className:"w-full rounded-2xl bg-indigo-600 hover:bg-indigo-500 text-slate-50 py-3 text-base",disabled:L.length<4,children:"Distribuer les r\xf4les & d\xe9marrer"})]}),"clues"===m&&H&&N===D&&(0,l.jsx)(u,{onSubmit:e=>{if(!e.trim()||"clues"!==m||!N||D!==N)return;let t=e.trim();I(e=>({...e,[D]:t})),O({type:"clue",data:{player:D,clue:t}})},onNext:T?()=>{if(!T||0===v.length)return;let e=v.indexOf(null!=N?N:v[0]),t=-1===e||e===v.length-1?v[0]:v[e+1];y(t),O({type:"turn",data:{currentSpeaker:t}}),v.every(e=>w[e])&&(p("vote"),O({type:"phase",data:{phase:"vote"}}))}:void 0}),"vote"===m&&H&&(0,l.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,l.jsx)("div",{className:"flex flex-wrap gap-2 justify-center",children:v.map(e=>(0,l.jsx)("button",{type:"button",onClick:()=>J(E[D]===e?null:e),className:"px-3 py-1.5 rounded-full text-xs border ".concat(E[D]===e?"bg-indigo-600 border-indigo-500 text-slate-50":"bg-slate-900 border-slate-700 text-slate-200"),children:e},e))}),T&&(0,l.jsx)(r.z,{onClick:()=>{if(!T||"vote"!==m)return;let e=Object.entries(E).filter(e=>{let[,t]=e;return t});if(0===e.length)return;let t={};e.forEach(e=>{let[,s]=e;t[s]=(t[s]||0)+1});let s=Object.entries(t).sort((e,t)=>t[1]-e[1]);if(0===s.length)return;let[l]=s[0];if(S(l),O({type:"elimination",data:{eliminated:l}}),"MR_WHITE"===d[l])p("mrwhite_guess"),O({type:"phase",data:{phase:"mrwhite_guess"}});else{let e=v.filter(e=>e!==l);j(e);let t=e.filter(e=>"CIVIL"===d[e]),s=e.some(e=>"UNDERCOVER"===d[e]),a=e.some(e=>"MR_WHITE"===d[e]);if(s||a){if(t.length<=1)M("UNDERCOVER/MR_WHITE"),p("end"),O({type:"game_end",data:{winner:"UNDERCOVER/MR_WHITE"}});else{p("clues"),O({type:"phase",data:{phase:"clues"}});let t=e[0];y(t),O({type:"turn",data:{currentSpeaker:t}}),I({}),k({})}}else M("CIVILS"),p("end"),O({type:"game_end",data:{winner:"CIVILS"}})}},className:"w-full rounded-2xl bg-indigo-600 hover:bg-indigo-500 text-slate-50 py-2.5 text-sm",children:"Clore le vote et appliquer le r\xe9sultat"})]}),"mrwhite_guess"===m&&"MR_WHITE"===U&&(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsx)(n.I,{type:"text",value:R,onChange:e=>_(e.target.value),placeholder:"Devine le mot des civils",className:"p-4 bg-slate-800 border-slate-700 rounded-2xl w-full text-center text-lg text-slate-50 placeholder:text-slate-500 outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),Z())}}),(0,l.jsx)(r.z,{onClick:Z,className:"w-full rounded-2xl bg-indigo-600 hover:bg-indigo-500 text-slate-50 py-3 text-base",children:"Valider mon guess"})]})]});return(0,l.jsx)(o.Z,{header:A,main:B,footer:P,playersBar:q})}function u(e){let{onSubmit:t,onNext:s}=e,[i,o]=(0,a.useState)(""),c=()=>{i.trim()&&(t(i),s&&s(),o(""))};return(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsx)(n.I,{type:"text",value:i,onChange:e=>o(e.target.value),placeholder:"Ton mot indice...",className:"p-4 bg-slate-800 border-slate-700 rounded-2xl w-full text-center text-lg text-slate-50 placeholder:text-slate-500 outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),c())}}),(0,l.jsx)(r.z,{onClick:c,className:"w-full rounded-2xl bg-indigo-600 hover:bg-indigo-500 text-slate-50 py-3 text-base",children:"Envoyer mon indice"})]})}function x(e){let{params:t,searchParams:s}=e;return(0,l.jsx)(d,{roomCode:t.code,settings:s})}},9313:function(e,t,s){"use strict";s.d(t,{z:function(){return r}});var l=s(7437),a=s(1657);let r=(0,s(2265).forwardRef)((e,t)=>{let{children:s,className:r,variant:n="primary",size:i="md",...o}=e;return(0,l.jsx)("button",{ref:t,className:(0,a.cn)("inline-flex items-center justify-center font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",{primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500 dark:bg-blue-600 dark:text-white dark:hover:bg-blue-700",secondary:"bg-slate-200 text-slate-900 hover:bg-slate-300 focus:ring-slate-500 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600",outline:"border border-slate-300 text-slate-700 hover:bg-slate-50 focus:ring-slate-500 dark:border-slate-600 dark:text-slate-200 dark:hover:bg-slate-800 dark:bg-transparent"}[n],{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[i],r),...o,children:s})});r.displayName="Button"},4203:function(e,t,s){"use strict";s.d(t,{I:function(){return r}});var l=s(7437),a=s(1657);let r=(0,s(2265).forwardRef)((e,t)=>{let{className:s,...r}=e;return(0,l.jsx)("input",{ref:t,className:(0,a.cn)("flex h-10 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm","placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent","disabled:cursor-not-allowed disabled:opacity-50","dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100 dark:placeholder:text-slate-400",s),...r})});r.displayName="Input"},8748:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});var l=s(7437);function a(e){let{header:t,main:s,footer:a,playersBar:r}=e;return(0,l.jsx)("main",{className:"min-h-screen bg-slate-950 text-slate-50 flex flex-col items-center p-4 sm:p-6 md:p-8",children:(0,l.jsxs)("div",{className:"w-full max-w-xl mx-auto flex flex-col gap-6",children:[t,s,(0,l.jsxs)("div",{className:"flex flex-col gap-4",children:[a,r]})]})})}},4518:function(e,t,s){"use strict";s.d(t,{r:function(){return r}});var l=s(2265);let a=(0,s(3226).eI)("https://vyatvqwsoqalbnbcmhqm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5YXR2cXdzb3FhbGJuYmNtaHFtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3ODkzMDcsImV4cCI6MjA4NzM2NTMwN30.KoTP3iOZmvbzB8RjHlmWIyvdMVpfqoia3-MQxbdL1sY");function r(e,t){let[s,r]=(0,l.useState)([]),[n,i]=(0,l.useState)([]);return(0,l.useEffect)(()=>{let s=a.channel("room:".concat(e));return s.on("presence",{event:"sync"},()=>{r(Object.values(s.presenceState()).flat())}).on("presence",{event:"join"},e=>{let{key:t,newPresences:s}=e;console.log("Nouveau joueur:",s)}).on("presence",{event:"leave"},e=>{let{key:t,leftPresences:s}=e;console.log("Joueur parti:",s)}).on("broadcast",{event:t},e=>{let{payload:t}=e;i(e=>[...e,t])}).subscribe(async e=>{"SUBSCRIBED"===e&&await s.track({playerName:sessionStorage.getItem("playerName")||"Anonyme",gameType:t,joinedAt:new Date().toISOString()})}),()=>{s.unsubscribe()}},[e,t]),{broadcast:s=>{a.channel("room:".concat(e)).send({type:"broadcast",event:t,payload:s})},presence:s,messages:n}}},1657:function(e,t,s){"use strict";s.d(t,{cn:function(){return r}});var l=s(7042),a=s(4769);function r(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,a.m6)((0,l.W)(t))}}},function(e){e.O(0,[61,293,971,938,744],function(){return e(e.s=1182)}),_N_E=e.O()}]);