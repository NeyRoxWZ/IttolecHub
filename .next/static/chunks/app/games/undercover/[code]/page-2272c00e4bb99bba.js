(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[697],{7216:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]])},2882:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},7972:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},1182:function(e,t,s){Promise.resolve().then(s.bind(s,5181))},5181:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return b}});var a=s(7437),r=s(2265),l=s(9313),n=s(4203),i=s(62),o=s(8748),d=s(7972),c=s(7216),u=s(2898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let m=(0,u.Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var x=s(2882);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let h=(0,u.Z)("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]),f=(0,u.Z)("Skull",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["path",{d:"M8 20v2h8v-2",key:"ded4og"}],["path",{d:"m12.5 17-.5-1-.5 1h1z",key:"3me087"}],["path",{d:"M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20",key:"xq9p5u"}]]);var p=s(1424);function g(e){var t;let{roomCode:s,settings:u}=e,{gameState:g,isHost:b,players:v,playerId:y,updateSettings:w,startGame:j,updateRoundData:N,nextRound:_,submitAnswer:I,setGameStatus:k}=(0,i.d)(s,"undercover"),[E,S]=(0,r.useState)({rounds:1,mrWhiteEnabled:!0,discussionTime:60,voteTime:30,difficulty:"normal"});(0,r.useEffect)(()=>{if(u&&b){let e={...E};u.rounds&&(e.rounds=Number(u.rounds)),u.mrWhiteEnabled&&(e.mrWhiteEnabled="true"===u.mrWhiteEnabled),u.discussionTime&&(e.discussionTime=Number(u.discussionTime)),u.voteTime&&(e.voteTime=Number(u.voteTime)),S(e)}},[u,b]);let[O,C]=(0,r.useState)(""),[T,M]=(0,r.useState)(""),[R,q]=(0,r.useState)(0),W=(null==g?void 0:g.round_data)||{},z=W.phase||"setup",D=W.roles||{},A=y?D[y]:null,Z=W.civilWord,V=W.undercoverWord,P=W.currentSpeaker,L=W.clues||[],U=W.alivePlayers||[],H=W.eliminated,B=W.winner,J=(null==g?void 0:g.current_round)||0,F=(0,r.useMemo)(()=>v.reduce((e,t)=>({...e,[t.name]:t.score}),{}),[v]),G="clues"===z&&P===y;y&&U.includes(y),(0,r.useEffect)(()=>{(null==g?void 0:g.settings)&&S(e=>({...e,...g.settings}))},[null==g?void 0:g.settings]),(0,r.useEffect)(()=>{b&&JSON.stringify(E)!==JSON.stringify(null==g?void 0:g.settings)&&w(E)},[E,b,w,null==g?void 0:g.settings]),(0,r.useEffect)(()=>{if(W.endTime){let e=Math.ceil((W.endTime-Date.now())/1e3);q(e>0?e:0)}},[W.endTime]),(0,r.useEffect)(()=>{if(R>0){let e=setInterval(()=>q(e=>Math.max(0,e-1)),1e3);return()=>clearInterval(e)}},[R]),(0,r.useEffect)(()=>{b&&(async()=>{"roles"===z&&0===R&&await N({...W,phase:"clues",currentSpeaker:U[0],endTime:null}),"discussion"===z&&0===R&&await N({...W,phase:"vote",endTime:Date.now()+1e3*E.voteTime}),"vote"===z&&0===R&&await Q()})()},[b,z,R,W,U,E.voteTime]);let X=async()=>{if(b){if(v.length<3){p.Am.error("Il faut au moins 4 joueurs !");return}try{let e=await fetch("/api/games/undercover?count=".concat(E.rounds)),t=await e.json();if(!t||0===t.length)return;let s=Array.isArray(t)?t[0]:t,a=Array.isArray(t)?t.slice(1):[],{newRoles:r,alive:l}=Y(v,E.mrWhiteEnabled);await j({civilWord:s.civilWord,undercoverWord:s.undercoverWord,roles:r,alivePlayers:l,phase:"roles",clues:[],queue:a,endTime:Date.now()+5e3})}catch(e){console.error(e),p.Am.error("Erreur au d\xe9marrage")}}},Y=(e,t)=>{let s=[...e].sort(()=>Math.random()-.5),a={},r=[],l=[...s],n=l.pop();if(n&&(a[n.id]="UNDERCOVER"),t&&l.length>0){let e=l.pop();e&&(a[e.id]="MR_WHITE")}return l.forEach(e=>a[e.id]="CIVIL"),s.forEach(e=>r.push(e.id)),{newRoles:a,alive:r}},Q=async()=>{let e=(null==g?void 0:g.answers)||{},t={};Object.values(e).forEach(e=>{"vote"===e.type&&e.targetId&&(t[e.targetId]=(t[e.targetId]||0)+1)});let s=0,a=null,r=!1;if(Object.entries(t).forEach(e=>{let[t,l]=e;l>s?(s=l,a=t,r=!1):l===s&&(r=!0)}),r||!a){(0,p.Am)("\xc9galit\xe9 ! Personne n'est \xe9limin\xe9."),await N({...W,phase:"clues",currentSpeaker:U[0],clues:[]});return}if("MR_WHITE"===D[a]){await N({...W,eliminated:a,phase:"mrwhite_guess",endTime:Date.now()+3e4});return}K(a)},K=async e=>{let t=U.filter(t=>t!==e),s=t.map(e=>D[e]),a=s.includes("UNDERCOVER"),r=s.includes("MR_WHITE"),l=s.filter(e=>"CIVIL"===e).length;a||r?(a?1:0)+(r?1:0)>=l?await $("IMPOSTORS",t):await N({...W,eliminated:e,alivePlayers:t,phase:"clues",currentSpeaker:t[0],endTime:null}):await $("CIVILS",t)},$=async(e,t)=>{await N({...W,winner:e,phase:"results",alivePlayers:t})},ee=async()=>{if(!b)return;let e=W.queue||[];if(0===e.length){await k("game_over");return}let t=e[0],s=e.slice(1),{newRoles:a,alive:r}=Y(v,E.mrWhiteEnabled);await _({civilWord:t.civilWord,undercoverWord:t.undercoverWord,roles:a,alivePlayers:r,phase:"roles",clues:[],queue:s,endTime:Date.now()+5e3})},et=async()=>{O.trim()&&(await I({type:"clue",text:O,timestamp:Date.now()}),C(""))},es=async e=>{await I({type:"vote",targetId:e}),p.Am.success("Vote enregistr\xe9")},ea=async()=>{T.trim()&&await I({type:"guess",text:T})};return(0,r.useEffect)(()=>{b&&(null==g?void 0:g.answers)&&(async()=>{let e=g.answers;if("clues"===z&&P){let t=e[P];if(t&&"clue"===t.type&&!L.find(e=>e.playerId===P&&e.text===t.text)){let e=[...L,{playerId:P,text:t.text,timestamp:t.timestamp}],s=(U.indexOf(P)+1)%U.length,a=U[s];0===s?await N({...W,clues:e,currentSpeaker:null,phase:"discussion",endTime:Date.now()+1e3*E.discussionTime}):await N({...W,clues:e,currentSpeaker:a})}}if("mrwhite_guess"===z&&H){let t=e[H];t&&"guess"===t.type&&(t.text.trim().toLowerCase()===(Z||"").toLowerCase()?await $("MR_WHITE",U):await K(H))}})()},[b,null==g?void 0:g.answers,z,P,L,U,E.discussionTime,H,Z]),(0,a.jsx)(o.Z,{players:F,roundCount:J,maxRounds:E.rounds,timer:R>0?"".concat(Math.floor(R/60),":").concat((R%60).toString().padStart(2,"0")):"--:--",gameCode:s,gameTitle:"Undercover",isHost:b,gameStarted:"setup"!==z,onStartGame:X,timeLeft:R,children:(0,a.jsxs)("div",{className:"flex flex-col items-center w-full max-w-4xl mx-auto min-h-[400px]",children:["setup"===z&&(0,a.jsxs)("div",{className:"text-center space-y-6 bg-white/10 p-8 rounded-xl backdrop-blur-md",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold",children:"Configuration"}),b?(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 text-left",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-gray-300 mb-1",children:"Manches"}),(0,a.jsx)(n.I,{type:"number",min:1,max:5,value:E.rounds,onChange:e=>S({...E,rounds:parseInt(e.target.value)})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-gray-300 mb-1",children:"Mr. White"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(l.z,{variant:E.mrWhiteEnabled?"primary":"outline",onClick:()=>S({...E,mrWhiteEnabled:!0}),children:"Oui"}),(0,a.jsx)(l.z,{variant:E.mrWhiteEnabled?"outline":"primary",onClick:()=>S({...E,mrWhiteEnabled:!1}),children:"Non"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-gray-300 mb-1",children:"Discussion (sec)"}),(0,a.jsx)(n.I,{type:"number",min:30,max:180,value:E.discussionTime,onChange:e=>S({...E,discussionTime:parseInt(e.target.value)})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-gray-300 mb-1",children:"Vote (sec)"}),(0,a.jsx)(n.I,{type:"number",min:15,max:60,value:E.voteTime,onChange:e=>S({...E,voteTime:parseInt(e.target.value)})})]}),(0,a.jsx)("div",{className:"col-span-full",children:(0,a.jsx)(l.z,{size:"lg",className:"w-full",onClick:X,children:"Lancer la partie"})})]}):(0,a.jsx)("p",{children:"En attente de l'h\xf4te..."})]}),"roles"===z&&(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full animate-in fade-in zoom-in",children:[(0,a.jsx)("h2",{className:"text-2xl mb-4",children:"Ton r\xf4le est..."}),(0,a.jsxs)("div",{className:"bg-black/40 p-8 rounded-full w-48 h-48 flex items-center justify-center border-4 border-white/20",children:["CIVIL"===A&&(0,a.jsx)(d.Z,{className:"w-20 h-20 text-blue-400"}),"UNDERCOVER"===A&&(0,a.jsx)(c.Z,{className:"w-20 h-20 text-red-400"}),"MR_WHITE"===A&&(0,a.jsx)(m,{className:"w-20 h-20 text-yellow-400"})]}),(0,a.jsx)("h3",{className:"text-4xl font-black mt-6 text-white uppercase",children:null==A?void 0:A.replace("_"," ")}),"MR_WHITE"===A?(0,a.jsx)("p",{className:"mt-4 text-xl text-yellow-200",children:"Tu n'as pas de mot ! Essaye de deviner."}):(0,a.jsxs)("div",{className:"mt-6 text-center",children:[(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Ton mot secret :"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-white bg-white/10 px-6 py-2 rounded-lg mt-2",children:"CIVIL"===A?Z:V})]})]}),"clues"===z&&(0,a.jsxs)("div",{className:"w-full space-y-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-center",children:"Phase d'Indices"}),(0,a.jsxs)("div",{className:"bg-black/20 rounded-xl p-4 min-h-[200px] max-h-[400px] overflow-y-auto space-y-2",children:[L.map((e,t)=>{let s=v.find(t=>t.id===e.playerId);return(0,a.jsxs)("div",{className:"bg-white/5 p-3 rounded-lg flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"font-bold text-blue-300",children:[(null==s?void 0:s.name)||"Inconnu",":"]}),(0,a.jsxs)("div",{className:"text-lg",children:['"',e.text,'"']})]},t)}),0===L.length&&(0,a.jsx)("p",{className:"text-gray-500 text-center italic mt-10",children:"Aucun indice pour le moment..."})]}),(0,a.jsx)("div",{className:"fixed bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black to-transparent",children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:G?(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n.I,{value:O,onChange:e=>C(e.target.value),placeholder:"\xc9cris ton indice...",className:"text-lg",autoFocus:!0}),(0,a.jsx)(l.z,{size:"lg",onClick:et,children:"Envoyer"})]}):(0,a.jsx)("div",{className:"text-center p-4 bg-black/40 rounded-lg backdrop-blur text-gray-300",children:P?"C'est au tour de ".concat(null===(t=v.find(e=>e.id===P))||void 0===t?void 0:t.name,"..."):"Chargement..."})})})]}),"discussion"===z&&(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[(0,a.jsx)(x.Z,{className:"w-16 h-16 text-green-400 mb-4 animate-bounce"}),(0,a.jsx)("h2",{className:"text-3xl font-bold mb-2",children:"Discussion !"}),(0,a.jsx)("p",{className:"text-xl text-gray-300",children:"D\xe9battez et trouvez l'intrus."}),(0,a.jsxs)("div",{className:"mt-8 text-6xl font-black font-mono text-white/80",children:[R,"s"]}),(0,a.jsxs)("div",{className:"mt-8 w-full max-w-2xl bg-black/20 p-4 rounded-xl",children:[(0,a.jsx)("h3",{className:"text-sm text-gray-400 mb-2",children:"Rappel des indices :"}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 text-left",children:L.map((e,t)=>{let s=v.find(t=>t.id===e.playerId);return(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsxs)("span",{className:"font-bold text-blue-300",children:[null==s?void 0:s.name,":"]})," ",e.text]},t)})})]})]}),"vote"===z&&(0,a.jsxs)("div",{className:"w-full text-center",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold mb-6 text-red-400",children:"Votez pour \xe9liminer !"}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:U.map(e=>{let t=v.find(t=>t.id===e);return t&&e!==y?(0,a.jsxs)("button",{onClick:()=>es(e),className:"bg-white/10 hover:bg-red-500/20 border-2 border-white/10 hover:border-red-500 p-6 rounded-xl transition-all flex flex-col items-center gap-2 group",children:[(0,a.jsx)(d.Z,{className:"w-12 h-12 text-gray-400 group-hover:text-red-400"}),(0,a.jsx)("span",{className:"font-bold text-lg",children:null==t?void 0:t.name})]},e):null})})]}),"mrwhite_guess"===z&&(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full",children:[(0,a.jsx)(m,{className:"w-20 h-20 text-yellow-400 mb-4"}),(0,a.jsx)("h2",{className:"text-3xl font-bold mb-2",children:"Mr. White a \xe9t\xe9 d\xe9masqu\xe9 !"}),(0,a.jsx)("p",{className:"mb-6",children:"Il a une derni\xe8re chance de gagner en devinant le mot des Civils."}),"MR_WHITE"===A&&H===y?(0,a.jsxs)("div",{className:"flex gap-2 w-full max-w-md",children:[(0,a.jsx)(n.I,{value:T,onChange:e=>M(e.target.value),placeholder:"Devine le mot..."}),(0,a.jsx)(l.z,{onClick:ea,children:"Valider"})]}):(0,a.jsx)("p",{className:"animate-pulse",children:"Mr. White r\xe9fl\xe9chit..."})]}),("results"===z||"game_over"===z)&&(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full animate-in zoom-in",children:["CIVILS"===B&&(0,a.jsx)(h,{className:"w-24 h-24 text-blue-400 mb-4"}),"IMPOSTORS"===B&&(0,a.jsx)(f,{className:"w-24 h-24 text-red-400 mb-4"}),"MR_WHITE"===B&&(0,a.jsx)(m,{className:"w-24 h-24 text-yellow-400 mb-4"}),(0,a.jsxs)("h2",{className:"text-4xl font-black mb-2",children:["CIVILS"===B&&"Les Civils ont gagn\xe9 !","IMPOSTORS"===B&&"Les Imposteurs ont gagn\xe9 !","MR_WHITE"===B&&"Mr. White a gagn\xe9 !"]}),(0,a.jsxs)("div",{className:"bg-white/10 p-6 rounded-xl mt-8 w-full max-w-lg",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4 border-b border-white/10 pb-2",children:[(0,a.jsx)("span",{children:"Mot Civil :"}),(0,a.jsx)("span",{className:"font-bold text-xl",children:Z})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4 border-b border-white/10 pb-2",children:[(0,a.jsx)("span",{children:"Mot Undercover :"}),(0,a.jsx)("span",{className:"font-bold text-xl",children:V})]}),(0,a.jsxs)("div",{className:"space-y-2 mt-4",children:[(0,a.jsx)("h3",{className:"text-sm text-gray-400",children:"R\xf4les :"}),v.map(e=>(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:e.name}),(0,a.jsx)("span",{className:"font-bold ".concat("CIVIL"===D[e.id]?"text-blue-400":"UNDERCOVER"===D[e.id]?"text-red-400":"text-yellow-400"),children:D[e.id]})]},e.id))]})]}),b&&(0,a.jsx)(l.z,{size:"lg",className:"mt-8",onClick:ee,children:J<E.rounds?"Manche Suivante":"Retour au menu"})]})]})})}function b(e){let{params:t,searchParams:s}=e;return(0,a.jsx)(g,{roomCode:t.code,settings:s})}},9313:function(e,t,s){"use strict";s.d(t,{z:function(){return l}});var a=s(7437),r=s(1657);let l=(0,s(2265).forwardRef)((e,t)=>{let{children:s,className:l,variant:n="primary",size:i="md",...o}=e;return(0,a.jsx)("button",{ref:t,className:(0,r.cn)("inline-flex items-center justify-center font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",{primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500 dark:bg-blue-600 dark:text-white dark:hover:bg-blue-700",secondary:"bg-slate-200 text-slate-900 hover:bg-slate-300 focus:ring-slate-500 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600",outline:"border border-slate-300 text-slate-700 hover:bg-slate-50 focus:ring-slate-500 dark:border-slate-600 dark:text-slate-200 dark:hover:bg-slate-800 dark:bg-transparent",ghost:"bg-transparent text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800"}[n],{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[i],l),...o,children:s})});l.displayName="Button"},4203:function(e,t,s){"use strict";s.d(t,{I:function(){return l}});var a=s(7437),r=s(1657);let l=(0,s(2265).forwardRef)((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("input",{ref:t,className:(0,r.cn)("flex h-10 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm","placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent","disabled:cursor-not-allowed disabled:opacity-50","dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100 dark:placeholder:text-slate-400",s),...l})});l.displayName="Input"},8748:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});var a=s(7437);function r(e){let{children:t,className:s,roomCode:r,timer:l,round:n,maxRounds:i,players:o,title:d,onLeave:c}=e;return(0,a.jsxs)("div",{className:"min-h-screen bg-slate-950 text-slate-100 font-sans selection:bg-indigo-500/30",children:[(0,a.jsxs)("div",{className:"fixed inset-0 overflow-hidden pointer-events-none z-0",children:[(0,a.jsx)("div",{className:"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] bg-indigo-600/10 rounded-full blur-[120px] animate-pulse-slow"}),(0,a.jsx)("div",{className:"absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] bg-blue-600/10 rounded-full blur-[120px] animate-pulse-slow delay-1000"})]}),(0,a.jsx)("div",{className:"relative z-10 flex flex-col min-h-screen max-w-7xl mx-auto p-4 sm:p-6",children:t})]})}},62:function(e,t,s){"use strict";s.d(t,{d:function(){return l}});var a=s(2265),r=s(4599);function l(e,t){let[s,l]=(0,a.useState)(null),[n,i]=(0,a.useState)(null),[o,d]=(0,a.useState)(!1),{room:c,session:u,players:m,isConnected:x}=function(e,t){let[s,l]=(0,a.useState)({room:null,session:null,players:[],isConnected:!1}),n=(0,a.useRef)(null),i=(0,a.useCallback)((e,t)=>{n.current&&n.current.send({type:"broadcast",event:e,payload:t}).catch(e=>console.error("Broadcast error:",e))},[]);return(0,a.useEffect)(()=>{if(!e)return;let t=!0;(async()=>{let[s,a,n]=await Promise.all([r.O.from("rooms").select("*").eq("id",e).maybeSingle(),r.O.from("game_sessions").select("*").eq("room_id",e).maybeSingle(),r.O.from("players").select("*").eq("room_id",e)]);t&&l(e=>({...e,room:s.data,session:a.data,players:n.data||[]}))})();let s=r.O.channel("room_sync:".concat(e)).on("postgres_changes",{event:"UPDATE",schema:"public",table:"rooms",filter:"id=eq.".concat(e)},e=>{t&&l(t=>({...t,room:e.new}))}).on("postgres_changes",{event:"*",schema:"public",table:"game_sessions",filter:"room_id=eq.".concat(e)},e=>{t&&e.new&&l(t=>({...t,session:e.new}))}).on("postgres_changes",{event:"*",schema:"public",table:"players",filter:"room_id=eq.".concat(e)},async()=>{let{data:s}=await r.O.from("players").select("*").eq("room_id",e);t&&s&&l(e=>({...e,players:s}))}).on("broadcast",{event:"player_answer"},e=>{let{payload:t}=e;console.log("Player answered:",t)}).subscribe(s=>{t&&(l(e=>({...e,isConnected:"SUBSCRIBED"===s})),"SUBSCRIBED"===s&&console.log("Connected to room ".concat(e)))});return n.current=s,()=>{t=!1,r.O.removeChannel(s)}},[e]),{...s,broadcast:i,refresh:()=>{}}}(s||"",0),h=(null==c?void 0:c.status)||"waiting",f=(0,a.useMemo)(()=>u?{current_round:u.current_round,total_rounds:u.total_rounds,round_data:u.round_data,answers:u.answers,status:u.status,settings:(null==c?void 0:c.settings)||{}}:null,[u,c]);(0,a.useEffect)(()=>{e&&(async()=>{let t;let{data:s,error:a}=await r.O.from("rooms").select("*").eq("code",e).maybeSingle();if(a||!s){console.error("Room not found:",a);return}l(s.id);let n=sessionStorage.getItem("playerId"),o=sessionStorage.getItem("playerName")||"Player-".concat(Math.floor(1e3*Math.random()));if(n){let{data:e}=await r.O.from("players").select("*").eq("id",n).maybeSingle();e&&(t=e)}if(!t){let{data:e}=await r.O.from("players").select("*").eq("room_id",s.id).eq("name",o).maybeSingle();e&&(t=e)}if(!t){let{data:e}=await r.O.from("players").insert({room_id:s.id,name:o,is_host:!s.host_id}).select().maybeSingle();e&&(t=e,sessionStorage.setItem("playerId",e.id),s.host_id||(await r.O.from("rooms").update({host_id:e.id}).eq("id",s.id),await r.O.from("players").update({is_host:!0}).eq("id",e.id),d(!0)))}if(t&&(i(t.id),d(t.is_host),t.is_host&&s.host_id!==t.id&&await r.O.from("rooms").update({host_id:t.id}).eq("id",s.id),t.is_host)){let{data:e}=await r.O.from("game_sessions").select("*").eq("room_id",s.id).maybeSingle();e||await r.O.from("game_sessions").insert({room_id:s.id,status:"waiting"})}})()},[e]),(0,a.useEffect)(()=>{if(!n)return;let e=async()=>{await r.O.from("players").update({last_seen_at:new Date().toISOString()}).eq("id",n)};e();let t=setInterval(e,3e4);return()=>clearInterval(t)},[n]),(0,a.useEffect)(()=>{if(!o||!s)return;let e=setInterval(async()=>{let e=new Date(Date.now()-12e4).toISOString();await r.O.from("players").delete().eq("room_id",s).lt("last_seen_at",e)},6e4);return()=>clearInterval(e)},[o,s]),(0,a.useEffect)(()=>{if(!s||!m.length)return;let e=setInterval(async()=>{let e=m.find(e=>e.is_host);if(e&&e.last_seen_at){let t=new Date(e.last_seen_at).getTime();Date.now()-t>15e4&&"closed"!==h&&await r.O.from("rooms").update({status:"closed"}).eq("id",s)}},3e4);return()=>clearInterval(e)},[s,m,h]);let p=async e=>{if(!s||!o)return;let{error:t}=await r.O.from("rooms").update({settings:e}).eq("id",s);t&&console.error("Error updating settings:",t)},g=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!s||!o)return;let{error:t}=await r.O.from("game_sessions").upsert({room_id:s,status:"round_active",current_round:1,answers:{},round_data:e},{onConflict:"room_id"});t&&console.error("ERREUR SUPABASE (startGame session):",t);let{error:a}=await r.O.from("rooms").update({status:"in_game"}).eq("id",s);a&&console.error("ERREUR SUPABASE (startGame room):",a)},b=async e=>{if(!s||!n||!f)return;let t={...f.answers,[n]:{answer:e,time:Date.now()}};await r.O.from("game_sessions").update({answers:t}).eq("room_id",s)},v=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!s||!o||!f)return;let t=f.current_round+1;t>f.total_rounds?(await r.O.from("rooms").update({status:"finished"}).eq("id",s),await r.O.from("game_sessions").update({status:"game_over"}).eq("room_id",s)):await r.O.from("game_sessions").update({current_round:t,answers:{},status:"round_active",round_data:e}).eq("room_id",s)},y=async e=>{s&&o&&await r.O.from("game_sessions").update({round_data:e}).eq("room_id",s)},w=async e=>{s&&o&&await r.O.from("game_sessions").update({status:e}).eq("room_id",s)},j=async(e,t)=>{s&&o&&await r.O.from("players").update({score:t}).eq("id",e)};return{roomStatus:h,players:m,gameState:f,isHost:o,playerId:n,updateSettings:p,startGame:g,submitAnswer:b,nextRound:v,updateRoundData:y,setGameStatus:w,updatePlayerScore:j}}},4599:function(e,t,s){"use strict";s.d(t,{O:function(){return a}});let a=(0,s(3226).eI)("https://vyatvqwsoqalbnbcmhqm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5YXR2cXdzb3FhbGJuYmNtaHFtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3ODkzMDcsImV4cCI6MjA4NzM2NTMwN30.KoTP3iOZmvbzB8RjHlmWIyvdMVpfqoia3-MQxbdL1sY")},1657:function(e,t,s){"use strict";s.d(t,{cn:function(){return l}});var a=s(7042),r=s(4769);function l(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.m6)((0,a.W)(t))}}},function(e){e.O(0,[61,226,424,971,938,744],function(){return e(e.s=1182)}),_N_E=e.O()}]);