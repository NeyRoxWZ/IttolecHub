(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[383],{3820:function(e,t,s){Promise.resolve().then(s.bind(s,5915))},9313:function(e,t,s){"use strict";s.d(t,{z:function(){return r}});var a=s(7437),l=s(1657);let r=(0,s(2265).forwardRef)((e,t)=>{let{children:s,className:r,variant:n="primary",size:i="md",...c}=e;return(0,a.jsx)("button",{ref:t,className:(0,l.cn)("inline-flex items-center justify-center font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",{primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500 dark:bg-blue-600 dark:text-white dark:hover:bg-blue-700",secondary:"bg-slate-200 text-slate-900 hover:bg-slate-300 focus:ring-slate-500 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600",outline:"border border-slate-300 text-slate-700 hover:bg-slate-50 focus:ring-slate-500 dark:border-slate-600 dark:text-slate-200 dark:hover:bg-slate-800 dark:bg-transparent"}[n],{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[i],r),...c,children:s})});r.displayName="Button"},4203:function(e,t,s){"use strict";s.d(t,{I:function(){return r}});var a=s(7437),l=s(1657);let r=(0,s(2265).forwardRef)((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("input",{ref:t,className:(0,l.cn)("flex h-10 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm","placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent","disabled:cursor-not-allowed disabled:opacity-50","dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100 dark:placeholder:text-slate-400",s),...r})});r.displayName="Input"},5915:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var a=s(7437),l=s(2265),r=s(6691),n=s.n(r),i=s(9313),c=s(4203),o=s(4518),d=s(8748),x=s(2369),m=s(7972),u=s(6141);let p={burger:{label:"Burger",min:400,max:900,exact:650,portion:"1 burger moyen"},pizza:{label:"Pizza",min:500,max:1100,exact:800,portion:"2 parts de pizza"},pasta:{label:"P\xe2tes",min:350,max:900,exact:600,portion:"1 assiette de 250g"},biryani:{label:"Biryani",min:500,max:1100,exact:800,portion:"1 assiette"},dessert:{label:"Dessert",min:250,max:900,exact:550,portion:"1 portion"},dosa:{label:"Dosa",min:250,max:600,exact:400,portion:"1 dosa"},idly:{label:"Idly",min:100,max:350,exact:220,portion:"2 idlis"},rice:{label:"Riz",min:150,max:500,exact:320,portion:"1 bol (180g)"},sandwich:{label:"Sandwich",min:300,max:800,exact:550,portion:"1 sandwich"},steak:{label:"Steak",min:400,max:900,exact:650,portion:"1 steak + accompagnement"},generic:{label:"Plat",min:200,max:900,exact:550,portion:"1 portion"}};function f(e){let{roomCode:t,settings:s}=e,[r,f]=(0,l.useState)(null),[h,b]=(0,l.useState)(""),[g,j]=(0,l.useState)([]),[N,y]=(0,l.useState)([]),[v,w]=(0,l.useState)(!1),[k,I]=(0,l.useState)(!1),[S,z]=(0,l.useState)(0),[C,E]=(0,l.useState)(!1),[M,R]=(0,l.useState)({}),[_,Z]=(0,l.useState)(30),[O,B]=(0,l.useState)(5),[D,F]=(0,l.useState)(30),[J,T]=(0,l.useState)(null),{broadcast:A,messages:P}=(0,o.r)(null!=t?t:"","caloriesguessr"),q="true"===sessionStorage.getItem("isHost"),L=sessionStorage.getItem("playerName")||"Anonyme";(0,l.useEffect)(()=>{if(null==s?void 0:s.rounds){let e=parseInt(s.rounds,10);!Number.isNaN(e)&&e>0&&B(e)}if(null==s?void 0:s.time){let e=parseInt(s.time,10);!Number.isNaN(e)&&e>5&&(F(e),Z(e))}},[s]);let V=(0,l.useMemo)(()=>{let e=Math.floor(_/60),t=_%60;return"".concat(e.toString().padStart(2,"0"),":").concat(t.toString().padStart(2,"0"))},[_]),X=async()=>{var e;let t=await fetch("https://foodish-api.com/api/"),s=(await t.json()).image,a="generic";try{let e=new URL(s).pathname.split("/").filter(Boolean),t=e.findIndex(e=>"images"===e);-1!==t&&e[t+1]&&(a=e[t+1].toLowerCase())}catch(e){a="generic"}let l=null!==(e=p[a])&&void 0!==e?e:p.generic;return{category:a,image:s,profile:l}},Y=async()=>{if(q&&t){if(S>=O){E(!0),A({type:"game_end",data:{players:M}});return}try{let e=await X();f(e),z(e=>e+1),w(!1),b(""),j([]),y([]),Z(D),I(!0),A({type:"round_start",data:{food:e,roundNumber:S+1,roundTime:D,maxRounds:O}})}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration de l’image Foodish:",e)}}},G=()=>{if(!h.trim()||v)return;let e=parseInt(h.trim(),10);Number.isNaN(e)||(A({type:"player_answer",data:{player:L,answer:e}}),y(e=>e.includes(L)?e:[...e,L]))},U=()=>{if(!q||!r)return;let e=r.profile.exact,t=[...g];if(!t.find(e=>e.player===L)){let s=parseInt(h.trim(),10);Number.isNaN(s)||t.push({player:L,answer:s,difference:Math.abs(s-e)})}let s=t.map(t=>({...t,difference:Math.abs(t.answer-e)})).sort((e,t)=>e.difference-t.difference),a={...M};if(s[0]){let e=s[0].player;a[e]=(a[e]||0)+10}R(a),j(s),w(!0),A({type:"round_end",data:{results:s,players:a,correctAnswer:e}})};(0,l.useEffect)(()=>{let e;return k&&!v&&_>0&&(e=setInterval(()=>{Z(e=>e<=1?(q&&!v&&U(),0):e-1)},1e3)),()=>{e&&clearInterval(e)}},[k,v,_,q]),(0,l.useEffect)(()=>{let e=P[P.length-1];if(e)switch(e.type){case"round_start":var t;f(e.data.food),z(e.data.roundNumber),w(!1),b(""),j([]),y([]),Z(null!==(t=e.data.roundTime)&&void 0!==t?t:D),I(!0);break;case"player_answer":j(t=>t.find(t=>t.player===e.data.player)?t:[...t,{player:e.data.player,answer:e.data.answer,difference:0}]),y(t=>t.includes(e.data.player)?t:[...t,e.data.player]);break;case"round_end":j(e.data.results),R(e.data.players),w(!0);break;case"game_end":R(e.data.players),E(!0);break;case"typing":e.data.player!==L&&e.data.isTyping?T(e.data.player):e.data.player===L||e.data.isTyping||T(t=>t===e.data.player?null:t)}},[P,D,L]),(0,l.useEffect)(()=>{if(!J)return;let e=setTimeout(()=>T(null),3e3);return()=>clearTimeout(e)},[J]);let H=e=>{b(e),t&&A({type:"typing",data:{player:L,isTyping:e.trim().length>0}})};if(!t)return(0,a.jsx)("main",{className:"min-h-screen bg-slate-950 text-slate-50 flex items-center justify-center p-4",children:(0,a.jsx)("p",{className:"text-slate-400 text-center",children:"Code de room introuvable. Reviens \xe0 l'accueil pour cr\xe9er une partie."})});let K=Object.entries(M).length?(0,a.jsx)("div",{className:"flex items-center gap-2 overflow-x-auto pb-1",children:Object.entries(M).sort((e,t)=>{let[,s]=e,[,a]=t;return a-s}).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 rounded-full bg-slate-900 border border-slate-800 text-sm shrink-0",children:[(0,a.jsx)("div",{className:"h-7 w-7 rounded-full bg-indigo-600 flex items-center justify-center text-xs font-semibold",children:t.charAt(0).toUpperCase()}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"font-medium text-slate-50 max-w-[120px] truncate",children:t}),(0,a.jsxs)("span",{className:"text-xs text-slate-400",children:[s," pts"]})]})]},t)})}):null;if(C){let e=Object.entries(M).sort((e,t)=>{let[,s]=e,[,a]=t;return a-s});return(0,a.jsx)(d.Z,{header:(0,a.jsxs)("div",{className:"flex justify-between items-center bg-slate-900 p-4 rounded-2xl w-full border border-slate-800",children:[(0,a.jsx)("span",{className:"text-slate-400 font-medium",children:"CaloriesGuessr"}),(0,a.jsxs)("span",{className:"text-xs font-mono text-slate-500",children:["Room • ",t]})]}),main:(0,a.jsxs)("div",{className:"bg-slate-900 rounded-3xl p-6 border border-slate-800 w-full shadow-xl text-center",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center gap-3 mb-4",children:[(0,a.jsx)(x.Z,{className:"h-8 w-8 text-emerald-500"}),(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Partie termin\xe9e"})]}),(0,a.jsx)("div",{className:"flex flex-col gap-3",children:e.map((e,t)=>{let[s,l]=e;return(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 rounded-2xl border ".concat(0===t?"border-emerald-500 bg-emerald-500/10":"border-slate-800 bg-slate-900"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"h-9 w-9 rounded-full bg-slate-800 flex items-center justify-center",children:(0,a.jsx)(m.Z,{className:"h-5 w-5 text-slate-200"})}),(0,a.jsx)("span",{className:"font-semibold text-slate-50",children:s})]}),(0,a.jsxs)("span",{className:"text-lg font-bold text-indigo-400 tabular-nums",children:[l," pts"]})]},s)})})]}),footer:(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsx)(i.z,{onClick:()=>{E(!1),z(0),R({}),f(null),I(!1)},className:"w-full rounded-2xl bg-indigo-600 hover:bg-indigo-500 text-slate-50 py-3 text-base",children:"Rejouer dans cette room"}),(0,a.jsx)(i.z,{onClick:()=>{window.location.href="/"},variant:"outline",className:"w-full rounded-2xl border-slate-700 text-slate-50 py-3 text-base",children:"Retour \xe0 l'accueil"})]}),playersBar:K})}return k?(0,a.jsx)(d.Z,{header:(0,a.jsxs)("div",{className:"flex flex-col gap-3 bg-slate-900 p-4 rounded-2xl w-full border border-slate-800",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("span",{className:"text-slate-400 font-medium text-sm",children:["Manche ",S,"/",O]}),(0,a.jsxs)("span",{className:"text-xs font-mono text-slate-500",children:["Room • ",t]})]}),(0,a.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,a.jsx)("span",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Temps restant"}),(0,a.jsx)("span",{className:"text-2xl font-bold text-indigo-400 tabular-nums",children:V}),(0,a.jsx)("div",{className:"w-full bg-slate-800 rounded-full h-1.5 overflow-hidden mt-1",children:(0,a.jsx)("div",{className:"h-full bg-indigo-600 transition-all duration-1000",style:{width:"".concat(Math.max(0,_/D*100),"%")}})})]})]}),main:(0,a.jsx)("div",{className:"bg-slate-900 rounded-3xl p-6 border border-slate-800 flex flex-col items-center text-center w-full shadow-xl",children:r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"text-xs text-slate-400 mb-1 uppercase tracking-wide",children:"Devine les calories pour"}),(0,a.jsx)("h2",{className:"text-xl font-semibold mb-1",children:r.profile.label}),(0,a.jsx)("p",{className:"text-xs text-slate-500 mb-4",children:r.profile.portion}),(0,a.jsx)("div",{className:"w-full h-64 rounded-xl overflow-hidden mb-4 bg-slate-800",children:(0,a.jsx)(n(),{src:r.image,alt:r.profile.label,width:640,height:360,className:"w-full h-full object-cover"})}),v&&(0,a.jsxs)("div",{className:"w-full rounded-2xl bg-slate-800 px-4 py-3 text-left",children:[(0,a.jsxs)("p",{className:"text-sm text-slate-200 font-semibold",children:["R\xe9ponse officielle :"," ",(0,a.jsxs)("span",{className:"text-indigo-400",children:[r.profile.exact," kcal"]})]}),(0,a.jsxs)("p",{className:"text-xs text-slate-400 mt-1",children:["Fourchette typique : ",r.profile.min,"–",r.profile.max," ","kcal"]})]})]}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-40 gap-3",children:[(0,a.jsx)(u.Z,{className:"h-6 w-6 text-slate-500 animate-spin"}),(0,a.jsx)("p",{className:"text-sm text-slate-400",children:"Chargement d'un nouveau plat..."})]})}),footer:(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[v?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"flex flex-col gap-2",children:g.length>0&&(0,a.jsx)("div",{className:"space-y-2",children:g.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 rounded-2xl border ".concat(0===t?"border-emerald-500 bg-emerald-500/10":"border-slate-800 bg-slate-900"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(m.Z,{className:"h-4 w-4 text-slate-300"}),(0,a.jsx)("span",{className:"text-sm font-medium text-slate-50",children:e.player})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("span",{className:"text-sm text-slate-300 tabular-nums",children:[e.answer," kcal"]}),(0,a.jsxs)("span",{className:"text-xs text-slate-500",children:["(\xb1",e.difference,")"]})]})]},"".concat(e.player,"-").concat(t)))})}),q&&(0,a.jsx)(i.z,{onClick:Y,className:"w-full rounded-2xl bg-indigo-600 hover:bg-indigo-500 text-slate-50 py-3 text-base",children:S>=O?"Voir les scores finaux":"Manche suivante"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.I,{type:"number",inputMode:"numeric",value:h,onChange:e=>H(e.target.value),placeholder:"Entre ton estimation en kcal",className:"p-4 bg-slate-800 border-slate-700 rounded-2xl w-full text-center text-lg text-slate-50 placeholder:text-slate-500 outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),G())}}),(0,a.jsx)(i.z,{onClick:G,className:"w-full rounded-2xl bg-indigo-600 hover:bg-indigo-500 text-slate-50 py-3 text-base",children:"Valider ma r\xe9ponse"})]}),(0,a.jsx)("div",{className:"min-h-[20px] text-xs text-slate-500 text-center",children:J?(0,a.jsxs)("span",{children:[J," est en train d'\xe9crire..."]}):N.length?(0,a.jsxs)("span",{children:[N.length," joueur",N.length>1?"s ont":" a"," d\xe9j\xe0 r\xe9pondu."]}):(0,a.jsx)("span",{children:"En attente des r\xe9ponses des autres joueurs..."})})]}),playersBar:K}):(0,a.jsx)(d.Z,{header:(0,a.jsxs)("div",{className:"flex justify-between items-center bg-slate-900 p-4 rounded-2xl w-full border border-slate-800",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("span",{className:"text-slate-400 font-medium text-sm",children:["Room • ",t]}),(0,a.jsx)("span",{className:"text-slate-50 font-semibold text-base",children:"CaloriesGuessr"})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-xs text-slate-500",children:"Manches"}),(0,a.jsxs)("p",{className:"text-sm font-semibold text-slate-200",children:[O," manches"]})]})]}),main:(0,a.jsxs)("div",{className:"bg-slate-900 rounded-3xl p-6 border border-slate-800 w-full shadow-xl text-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-3",children:"Devine les calories du plat"}),(0,a.jsxs)("p",{className:"text-slate-400 text-sm mb-4",children:[O," manches • 10 points pour le plus proche • ",D," s par manche"]}),q?(0,a.jsx)(i.z,{onClick:Y,className:"w-full rounded-2xl bg-indigo-600 hover:bg-indigo-500 text-slate-50 py-3 text-base",children:"D\xe9marrer la partie"}):(0,a.jsx)("p",{className:"text-slate-500 text-sm",children:"En attente de l'h\xf4te pour lancer la premi\xe8re manche..."})]}),footer:(0,a.jsx)("div",{className:"text-center text-xs text-slate-500",children:"Les scores seront affich\xe9s en bas de l'\xe9cran pendant la partie."}),playersBar:K})}},8748:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var a=s(7437);function l(e){let{header:t,main:s,footer:l,playersBar:r}=e;return(0,a.jsx)("main",{className:"min-h-screen bg-slate-950 text-slate-50 flex flex-col items-center p-4 sm:p-6 md:p-8",children:(0,a.jsxs)("div",{className:"w-full max-w-xl mx-auto flex flex-col gap-6",children:[t,s,(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[l,r]})]})})}},4518:function(e,t,s){"use strict";s.d(t,{r:function(){return r}});var a=s(2265);let l=(0,s(3226).eI)("https://vyatvqwsoqalbnbcmhqm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5YXR2cXdzb3FhbGJuYmNtaHFtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3ODkzMDcsImV4cCI6MjA4NzM2NTMwN30.KoTP3iOZmvbzB8RjHlmWIyvdMVpfqoia3-MQxbdL1sY");function r(e,t){let[s,r]=(0,a.useState)([]),[n,i]=(0,a.useState)([]);return(0,a.useEffect)(()=>{let s=l.channel("room:".concat(e));return s.on("presence",{event:"sync"},()=>{r(Object.values(s.presenceState()).flat())}).on("presence",{event:"join"},e=>{let{key:t,newPresences:s}=e;console.log("Nouveau joueur:",s)}).on("presence",{event:"leave"},e=>{let{key:t,leftPresences:s}=e;console.log("Joueur parti:",s)}).on("broadcast",{event:t},e=>{let{payload:t}=e;i(e=>[...e,t])}).subscribe(async e=>{"SUBSCRIBED"===e&&await s.track({playerName:sessionStorage.getItem("playerName")||"Anonyme",gameType:t,joinedAt:new Date().toISOString()})}),()=>{s.unsubscribe()}},[e,t]),{broadcast:s=>{l.channel("room:".concat(e)).send({type:"broadcast",event:t,payload:s})},presence:s,messages:n}}},1657:function(e,t,s){"use strict";s.d(t,{cn:function(){return r}});var a=s(7042),l=s(4769);function r(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,l.m6)((0,a.W)(t))}}},function(e){e.O(0,[61,293,499,971,938,744],function(){return e(e.s=3820)}),_N_E=e.O()}]);