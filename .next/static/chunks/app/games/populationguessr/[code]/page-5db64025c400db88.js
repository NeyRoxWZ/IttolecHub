(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[371],{8291:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,a(2898).Z)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},8956:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,a(2898).Z)("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]])},1484:function(e,t,a){Promise.resolve().then(a.bind(a,5709))},5709:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var l=a(7437),s=a(2265),n=a(9313),r=a(4203),o=a(5192),i=a(62),d=a(8748),c=a(8956),u=a(8291);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let x=(0,a(2898).Z)("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);var m=a(6691),p=a.n(m);function f(e){var t,a,m,f,h,g,v,b,w;let{roomCode:y}=e,[N,j]=(0,s.useState)(""),[k,_]=(0,s.useState)(30),[M,E]=(0,s.useState)(null),{roomStatus:S,players:z,gameState:C,isHost:T,playerId:I,startGame:Z,submitAnswer:D,nextRound:R,updateRoundData:q,setGameStatus:O,updatePlayerScore:A}=(0,i.d)(null!=y?y:"","populationguessr"),{broadcast:P,messages:F}=(0,o.r)(null!=y?y:"","populationguessr"),H=sessionStorage.getItem("playerName")||"Anonyme",V="in_game"===S,B=(null==C?void 0:C.status)==="round_results"||(null==C?void 0:C.status)==="game_over",G=(null==C?void 0:null===(t=C.round_data)||void 0===t?void 0:t.country)||null,L=(null==C?void 0:C.current_round)||0,J=Number((null==C?void 0:null===(a=C.settings)||void 0===a?void 0:a.rounds)||5),K=Number((null==C?void 0:null===(m=C.settings)||void 0===m?void 0:m.time)||30),Q=(0,s.useMemo)(()=>z.reduce((e,t)=>({...e,[t.name]:t.score}),{}),[z]);(0,s.useEffect)(()=>{var e;if(null==C?void 0:null===(e=C.round_data)||void 0===e?void 0:e.endTime){let e=Math.ceil((C.round_data.endTime-Date.now())/1e3);_(e>0?e:0)}},[null==C?void 0:null===(f=C.round_data)||void 0===f?void 0:f.endTime,V,B]),(0,s.useEffect)(()=>{let e;return V&&!B&&k>0&&(e=setInterval(()=>{_(e=>e<=1?(T&&!B&&et(),0):e-1)},1e3)),()=>clearInterval(e)},[V,B,k,T]);let U=(0,s.useMemo)(()=>{let e=Math.floor(k/60),t=k%60;return"".concat(e.toString().padStart(2,"0"),":").concat(t.toString().padStart(2,"0"))},[k]),$=async()=>{try{let e=await fetch("/api/games/population");if(!e.ok)return[];return await e.json()}catch(e){return console.error("Error fetching countries",e),[]}},W=async()=>{if(T&&y)try{let e=await $();if(0===e.length)return;for(let t=e.length-1;t>0;t--){let a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}let t=e.slice(0,J),a=t[0],l=t.slice(1),s=Date.now()+1e3*K;await Z({country:a,queue:l,endTime:s}),j("")}catch(e){console.error("Erreur lancement:",e)}};(0,s.useEffect)(()=>{var e;T&&(null==C?void 0:null===(e=C.round_data)||void 0===e?void 0:e.phase)==="setup"&&W()},[T,null==C?void 0:null===(h=C.round_data)||void 0===h?void 0:h.phase]);let X=async()=>{if(T&&(null==C?void 0:C.round_data))try{let e=C.round_data.queue||[];if(0===e.length){let e=await $(),t=e[Math.floor(Math.random()*e.length)],a=Date.now()+1e3*K;await R({country:t,queue:[],endTime:a});return}let t=e[0],a=e.slice(1),l=Date.now()+1e3*K;await R({country:t,queue:a,endTime:l}),j("")}catch(e){console.error("Error next round",e)}},Y=()=>{if(!N.trim()||B)return;let e=N.replace(/[\s,]/g,"");!e||isNaN(Number(e))||D(e)},ee=(e,t)=>{let a=Math.abs(e-t)/e*100;return a<=5?1e3:a<=10?500:a<=25?250:a<=50?100:0},et=async()=>{if(!T||!G||!C)return;let e=G.population,t=C.answers||{},a=[];for(let s of z){var l;let n=null===(l=t[s.id])||void 0===l?void 0:l.answer,r=0,o=0;if(n){let t=Number(n);isNaN(t)||(r=ee(e,t),o=Math.abs(e-t))}a.push({player:s.name,answer:n||"-",diff:o,score:r}),r>0&&await A(s.id,s.score+r)}a.sort((e,t)=>t.score!==e.score?t.score-e.score:e.diff-t.diff),await q({...C.round_data,results:a}),await O("round_results")};(0,s.useEffect)(()=>{let e=F[F.length-1];e&&"typing"===e.type&&(e.data.player!==H&&e.data.isTyping?E(e.data.player):e.data.player===H||e.data.isTyping||E(t=>t===e.data.player?null:t))},[F,H]),(0,s.useEffect)(()=>{if(!M)return;let e=setTimeout(()=>E(null),3e3);return()=>clearTimeout(e)},[M]);let ea=e=>new Intl.NumberFormat("fr-FR").format(e);return(0,l.jsx)(d.Z,{gameTitle:"PopulationGuessr",roundCount:L,maxRounds:J,timer:U,players:Q,timeLeft:k,gameStarted:V,children:(0,l.jsx)("div",{className:"flex flex-col items-center justify-center w-full max-w-4xl mx-auto gap-8 animate-in fade-in duration-700",children:V?(0,l.jsxs)("div",{className:"w-full flex flex-col items-center gap-8",children:[G&&(0,l.jsxs)("div",{className:"flex flex-col items-center gap-6 w-full animate-in slide-in-from-bottom-8 duration-700",children:[(0,l.jsxs)("div",{className:"relative w-full max-w-md aspect-video bg-black/40 rounded-2xl overflow-hidden shadow-2xl border border-white/10 group",children:[(0,l.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent z-10"}),(0,l.jsx)(p(),{src:G.flags.svg,alt:"Flag",fill:!0,className:"object-cover transition-transform duration-700 group-hover:scale-105",priority:!0}),(0,l.jsx)("div",{className:"absolute bottom-4 left-4 z-20",children:(0,l.jsx)("span",{className:"bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded mb-1 inline-block",children:G.region})})]}),(0,l.jsx)("h2",{className:"text-4xl md:text-5xl font-black text-center text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400 drop-shadow-sm",children:(null===(v=G.translations)||void 0===v?void 0:null===(g=v.fra)||void 0===g?void 0:g.common)||G.name.common})]}),B?(0,l.jsxs)("div",{className:"w-full max-w-2xl animate-in zoom-in-95 duration-500 flex flex-col gap-6",children:[(0,l.jsxs)("div",{className:"bg-slate-900/80 backdrop-blur-xl rounded-3xl p-8 border border-white/10 text-center shadow-2xl relative overflow-hidden",children:[(0,l.jsx)("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-yellow-500 to-transparent opacity-50"}),(0,l.jsx)("h3",{className:"text-xl font-bold mb-2 text-yellow-400 uppercase tracking-widest text-sm",children:"Population r\xe9elle"}),(0,l.jsx)("p",{className:"text-5xl md:text-6xl font-black mb-2 text-white tabular-nums tracking-tight",children:G?ea(G.population):"-"}),(0,l.jsx)("p",{className:"text-sm text-slate-400",children:"habitants"})]}),(0,l.jsxs)("div",{className:"space-y-3 bg-slate-900/50 p-6 rounded-3xl border border-white/5",children:[(0,l.jsxs)("h4",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-slate-300",children:[(0,l.jsx)(x,{className:"w-5 h-5 text-yellow-500"}),"R\xe9sultats du round"]}),(0,l.jsx)("div",{className:"space-y-2 max-h-[300px] overflow-y-auto pr-2 custom-scrollbar",children:null==C?void 0:null===(w=C.round_data)||void 0===w?void 0:null===(b=w.results)||void 0===b?void 0:b.map((e,t)=>(0,l.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-xl border transition-all ".concat(e.score>0?"bg-emerald-500/10 border-emerald-500/20 hover:bg-emerald-500/20":"bg-rose-500/10 border-rose-500/20 hover:bg-rose-500/20"),children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)("span",{className:"flex items-center justify-center w-8 h-8 rounded-full font-bold text-sm ".concat(0===t?"bg-yellow-500 text-black shadow-lg shadow-yellow-500/20":1===t?"bg-slate-400 text-black":2===t?"bg-amber-700 text-white":"bg-slate-800 text-slate-400"),children:t+1}),(0,l.jsx)("span",{className:"font-bold text-lg",children:e.player})]}),(0,l.jsxs)("div",{className:"flex flex-col items-end",children:[(0,l.jsx)("span",{className:"text-xl font-mono font-bold tabular-nums",children:"-"!==e.answer?ea(Number(e.answer)):"-"}),(0,l.jsxs)("div",{className:"flex items-center gap-2 text-xs font-medium",children:[e.score>0?(0,l.jsxs)("span",{className:"text-emerald-400",children:["+",e.score," pts"]}):(0,l.jsx)("span",{className:"text-rose-400",children:"0 pts"}),"-"!==e.answer&&(0,l.jsxs)("span",{className:"text-slate-500",children:["(Diff: ",ea(Math.abs(((null==G?void 0:G.population)||0)-Number(e.answer))),")"]})]})]})]},t))})]}),T&&(0,l.jsx)("div",{className:"mt-4 flex justify-center",children:(0,l.jsxs)(n.z,{onClick:X,size:"lg",className:"bg-white text-black hover:bg-slate-200 text-lg px-10 py-6 rounded-full shadow-lg shadow-white/10 transition-all hover:scale-105 font-bold",children:[C.current_round>=J?"Terminer la partie":"Round suivant",(0,l.jsx)(u.Z,{className:"w-5 h-5 ml-2"})]})})]}):(0,l.jsxs)("div",{className:"w-full max-w-md flex flex-col gap-6 animate-in fade-in delay-300 duration-700",children:[(0,l.jsxs)("div",{className:"text-center space-y-2",children:[(0,l.jsx)("p",{className:"text-lg text-slate-300 font-medium",children:"Quelle est la population ?"}),M&&(0,l.jsxs)("p",{className:"text-xs text-indigo-400 animate-pulse font-mono",children:[M," est en train d'\xe9crire..."]})]}),(0,l.jsxs)("div",{className:"flex gap-3 relative",children:[(0,l.jsx)(r.I,{type:"text",inputMode:"numeric",value:N,onChange:e=>{let t=e.target.value;/^[\d\s]*$/.test(t)&&(j(t),P({type:"typing",data:{player:H,isTyping:t.length>0}}))},onKeyDown:e=>{"Enter"===e.key&&Y()},placeholder:"Ex: 67 000 000",className:"flex-1 bg-slate-800/50 border-white/10 text-2xl h-16 text-center tracking-widest font-mono shadow-inner focus:ring-2 focus:ring-indigo-500 transition-all rounded-xl",autoFocus:!0}),(0,l.jsx)(n.z,{onClick:Y,className:"h-16 px-8 bg-gradient-to-r from-indigo-600 to-blue-600 hover:from-indigo-500 hover:to-blue-500 rounded-xl shadow-lg shadow-indigo-500/20 transition-all hover:scale-105 active:scale-95",children:(0,l.jsx)(u.Z,{className:"w-8 h-8"})})]}),(0,l.jsx)("p",{className:"text-center text-xs text-slate-500",children:"Appuyez sur Entr\xe9e pour valider"})]})]}):(0,l.jsxs)("div",{className:"flex flex-col items-center gap-6 text-center",children:[(0,l.jsx)(c.Z,{className:"w-24 h-24 text-blue-400 animate-pulse"}),(0,l.jsx)("h2",{className:"text-3xl font-bold text-white",children:"Pr\xeat \xe0 deviner ?"}),(0,l.jsx)("p",{className:"text-slate-400 max-w-md",children:"Estimez la population de diff\xe9rents pays. Plus vous \xeates proche, plus vous gagnez de points !"}),T?(0,l.jsx)(n.z,{onClick:W,size:"lg",className:"mt-4 bg-indigo-600 hover:bg-indigo-500 text-lg px-8 py-6 rounded-xl shadow-lg shadow-indigo-500/20",children:"Lancer la partie"}):(0,l.jsxs)("div",{className:"flex items-center gap-2 text-indigo-400 bg-indigo-950/30 px-4 py-2 rounded-full border border-indigo-500/30 animate-pulse",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-indigo-400 rounded-full"}),"En attente de l'h\xf4te..."]})]})})})}function h(e){let{params:t,searchParams:a}=e;return(0,l.jsx)(f,{roomCode:t.code})}},4203:function(e,t,a){"use strict";a.d(t,{I:function(){return n}});var l=a(7437),s=a(1657);let n=(0,a(2265).forwardRef)((e,t)=>{let{className:a,...n}=e;return(0,l.jsx)("input",{ref:t,className:(0,s.cn)("flex h-10 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm","placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent","disabled:cursor-not-allowed disabled:opacity-50","dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100 dark:placeholder:text-slate-400",a),...n})});n.displayName="Input"},5192:function(e,t,a){"use strict";a.d(t,{r:function(){return n}});var l=a(2265),s=a(4599);function n(e,t){let[a,n]=(0,l.useState)([]),[r,o]=(0,l.useState)([]);return(0,l.useEffect)(()=>{let a=s.O.channel("room:".concat(e));return a.on("presence",{event:"sync"},()=>{n(Object.values(a.presenceState()).flat())}).on("presence",{event:"join"},e=>{let{key:t,newPresences:a}=e;console.log("Nouveau joueur:",a)}).on("presence",{event:"leave"},e=>{let{key:t,leftPresences:a}=e;console.log("Joueur parti:",a)}).on("broadcast",{event:t},e=>{let{payload:t}=e;o(e=>[...e,t])}).subscribe(async e=>{"SUBSCRIBED"===e&&await a.track({playerName:sessionStorage.getItem("playerName")||"Anonyme",gameType:t,joinedAt:new Date().toISOString()})}),()=>{a.unsubscribe()}},[e,t]),{broadcast:a=>{s.O.channel("room:".concat(e)).send({type:"broadcast",event:t,payload:a})},presence:a,messages:r}}}},function(e){e.O(0,[484,226,854,387,971,938,744],function(){return e(e.s=1484)}),_N_E=e.O()}]);