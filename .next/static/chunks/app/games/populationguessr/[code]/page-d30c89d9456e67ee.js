(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[371],{1484:function(e,t,a){Promise.resolve().then(a.bind(a,5026))},5026:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return f}});var s=a(7437),r=a(2265),l=a(4033),n=a(1543),c=a(9313),d=a(4203),o=a(4518),i=a(8957),u=a(8619),x=a(6690),m=a(6027),p=a(1215);function f(){var e,t;let a=(0,l.useParams)(),f=(0,l.useSearchParams)(),h=a.code,y=Math.max(1,parseInt(f.get("rounds")||"5",10)),j=Math.max(5,parseInt(f.get("time")||"20",10)),[g,N]=(0,r.useState)(null),[b,v]=(0,r.useState)(5e7),[k,w]=(0,r.useState)([]),[S,_]=(0,r.useState)([]),[C,E]=(0,r.useState)(!1),[Z,I]=(0,r.useState)(!1),[P,R]=(0,r.useState)(0),[F,L]=(0,r.useState)(j),[M,z]=(0,r.useState)([]),[A,D]=(0,r.useState)(!1),{broadcast:O,messages:V}=(0,o.r)(h,"populationguessr"),G="true"===sessionStorage.getItem("isHost"),H=sessionStorage.getItem("playerName")||"Anonyme",Q=(0,r.useCallback)(async()=>{if(G){if(P>=y){D(!0),O({type:"game_end",data:{players:M}});return}try{let e=await fetch("/api/games/country"),t=await e.json();if(t.error)throw Error(t.error);O({type:"round_start",data:{country:t,roundNumber:P+1}}),N(t),R(e=>e+1),I(!1),w([]),_([]),v(5e7),L(j)}catch(e){console.error(e)}}},[G,P,y,O,M,j]),T=()=>{if(!G||!g||Z)return;let e=g.population,t=S.map(t=>({...t,difference:Math.abs(t.answer-e)}));t.sort((e,t)=>e.difference-t.difference);let a=[...M];t.forEach((e,t)=>{let s=0===t?10:1===t?5:0;if(s>0){let t=a.findIndex(t=>t.name===e.player);t>=0?a[t].score+=s:a.push({name:e.player,score:s})}}),z(a),I(!0),O({type:"round_end",data:{results:t,players:a,correctAnswer:e}})};return((0,r.useEffect)(()=>{let e=V[V.length-1];if(e){if("round_start"===e.type){var t;N(e.data.country),R(null!==(t=e.data.roundNumber)&&void 0!==t?t:P+1),I(!1),w([]),_([]),v(5e7),L(j),E(!0)}else"player_answer"===e.type?(_(t=>[...t,{player:e.data.player,answer:e.data.answer,difference:0}]),w(t=>t.includes(e.data.player)?t:[...t,e.data.player])):"round_end"===e.type?(_(e.data.results||[]),e.data.players&&z(e.data.players),I(!0)):"game_end"===e.type&&(e.data.players&&z(e.data.players),D(!0))}},[V]),(0,r.useEffect)(()=>{let e;return C&&!Z&&F>0&&(e=setInterval(()=>L(e=>e<=1?0:e-1),1e3)),C&&!Z&&F<=0&&G&&T(),()=>clearInterval(e)},[C,Z,F,G]),(0,r.useEffect)(()=>{H&&0===M.length&&z([{name:H,score:0}])},[H]),A)?(0,s.jsx)("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 p-4 sm:p-6 game-layout text-slate-800 dark:text-slate-100",children:(0,s.jsx)(m.Z,{players:M,roomCode:h,onReplay:()=>{D(!1),z([]),R(0),E(!1)}})}):(0,s.jsx)("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 p-4 sm:p-6 game-layout text-slate-800 dark:text-slate-100",children:(0,s.jsxs)("div",{className:"max-w-2xl mx-auto space-y-4",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-center",children:"PopulationGuessr"}),(0,s.jsxs)("p",{className:"text-sm text-slate-600 dark:text-slate-400 text-center",children:["Manche ",P,"/",y," â€¢ Score : ",null!==(t=null===(e=M.find(e=>e.name===H))||void 0===e?void 0:e.score)&&void 0!==t?t:0]}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(p.Z,{roomCode:h,gameType:"populationguessr"})}),!C&&G&&(0,s.jsxs)(n.Z,{className:"p-6 text-center",children:[(0,s.jsx)("p",{className:"mb-4 text-slate-700 dark:text-slate-300",children:"Pr\xeat \xe0 jouer ?"}),(0,s.jsx)(c.z,{onClick:Q,className:"rounded-xl",children:"Commencer"})]}),!C&&!G&&(0,s.jsx)(n.Z,{className:"p-6 text-center",children:(0,s.jsx)("p",{className:"text-slate-600 dark:text-slate-400",children:"En attente de l'h\xf4te..."})}),C&&g&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.Z,{timeLeft:F,totalSeconds:j}),(0,s.jsxs)(n.Z,{className:"p-6 text-center",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-2 text-slate-800 dark:text-slate-100",children:"Quelle est la population de ce pays ?"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100 mb-4",children:g.name.fr}),(0,s.jsx)("img",{src:g.flagUrl,alt:"Drapeau",className:"w-48 h-32 object-contain mx-auto rounded-lg"})]}),!Z&&(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),!g||Z||k.includes(H)||(O({type:"player_answer",data:{player:H,answer:b}}),w(e=>e.includes(H)?e:[...e,H]))},className:"space-y-4",children:[(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("span",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100",children:Number(b).toLocaleString("fr-FR")})}),(0,s.jsx)(d.I,{type:"range",min:1e5,max:15e8,step:1e6,value:b,onChange:e=>v(Number(e.target.value)),className:"w-full"}),(0,s.jsx)(c.z,{type:"submit",className:"w-full rounded-xl",disabled:k.includes(H),children:k.includes(H)?"R\xe9ponse envoy\xe9e":"Valider"})]}),(0,s.jsx)(x.Z,{answeredPlayers:k}),Z&&(0,s.jsxs)(n.Z,{className:"p-6 text-center bg-green-100 dark:bg-green-900/40",children:[(0,s.jsx)(i.Z,{className:"h-10 w-10 text-amber-500 mx-auto mb-2"}),(0,s.jsxs)("p",{className:"font-semibold text-slate-800 dark:text-slate-100",children:["Population : ",(0,s.jsx)("strong",{children:g.population.toLocaleString("fr-FR")})]}),(0,s.jsx)("div",{className:"mt-4 space-y-2 text-left",children:S.slice(0,5).map((e,t)=>(0,s.jsxs)("div",{className:"flex justify-between text-sm text-slate-700 dark:text-slate-300",children:[(0,s.jsx)("span",{children:e.player}),(0,s.jsxs)("span",{children:[e.answer.toLocaleString("fr-FR")," (\xe9cart: ",e.difference.toLocaleString("fr-FR"),")"]})]},t))}),G&&(0,s.jsx)(c.z,{onClick:Q,className:"mt-4 rounded-xl",children:P>=y?"Voir les scores":"Manche suivante"})]})]})]})})}}},function(e){e.O(0,[61,293,902,971,938,744],function(){return e(e.s=1484)}),_N_E=e.O()}]);