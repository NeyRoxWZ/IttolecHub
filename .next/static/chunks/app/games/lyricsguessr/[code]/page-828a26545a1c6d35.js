(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[485],{7187:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(2898).Z)("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]])},1228:function(e,t,a){Promise.resolve().then(a.bind(a,1160))},1160:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return y}});var s=a(7437),r=a(2265),l=a(4033),n=a(1543),c=a(9313),d=a(4203),i=a(4518),u=a(7187),m=a(8957),o=a(8619),x=a(6690),p=a(6027),h=a(1215);function y(){var e,t;let a=(0,l.useParams)(),y=(0,l.useSearchParams)(),f=a.code,g=y.get("artist")||"",j=Math.max(1,parseInt(y.get("rounds")||"5",10)),N=Math.max(5,parseInt(y.get("time")||"45",10)),[b,k]=(0,r.useState)(null),[v,S]=(0,r.useState)(""),[_,w]=(0,r.useState)([]),[C,Z]=(0,r.useState)(!1),[I,E]=(0,r.useState)(!1),[M,P]=(0,r.useState)(0),[z,L]=(0,r.useState)(null),[A,T]=(0,r.useState)(N),[V,q]=(0,r.useState)([]),[O,R]=(0,r.useState)(!1),[D,F]=(0,r.useState)(null),{broadcast:G,messages:H}=(0,i.r)(f,"lyricsguessr"),U="true"===sessionStorage.getItem("isHost"),B=sessionStorage.getItem("playerName")||"Anonyme",J=(0,r.useCallback)(async()=>{if(!U)return;let e=g.trim();if(!e){F("Indiquez un artiste dans les param\xe8tres de la room.");return}if(M>=j){R(!0),G({type:"game_end",data:{players:V}});return}F(null);try{let t=await fetch("/api/games/lyrics?artist=".concat(encodeURIComponent(e))),a=await t.json();if(a.error)throw Error(a.error);G({type:"round_start",data:{...a,roundNumber:M+1}}),k(a),P(e=>e+1),E(!1),L(null),w([]),S(""),T(N),Z(!0)}catch(e){F(e.message||"Erreur API")}},[U,g,M,j,G,V,N]);return((0,r.useEffect)(()=>{let e=H[H.length-1];if(e){if("round_start"===e.type){var t;k(e.data),P(null!==(t=e.data.roundNumber)&&void 0!==t?t:0),E(!1),L(null),w([]),S(""),T(N),Z(!0),F(null)}else"player_guess"===e.type?w(t=>t.includes(e.data.player)?t:[...t,e.data.player]):"round_end"===e.type?(L(e.data.winner),e.data.players&&q(e.data.players),E(!0)):"game_end"===e.type&&(e.data.players&&q(e.data.players),R(!0))}},[H]),(0,r.useEffect)(()=>{let e;return C&&!I&&A>0&&(e=setInterval(()=>T(e=>e<=1?0:e-1),1e3)),C&&!I&&A<=0&&E(!0),()=>clearInterval(e)},[C,I,A]),(0,r.useEffect)(()=>{B&&0===V.length&&q([{name:B,score:0}])},[B]),O)?(0,s.jsx)("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 p-4 sm:p-6 game-layout text-slate-800 dark:text-slate-100",children:(0,s.jsx)(p.Z,{players:V,roomCode:f,onReplay:()=>{R(!1),q([]),P(0),Z(!1)}})}):(0,s.jsx)("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 p-4 sm:p-6 game-layout text-slate-800 dark:text-slate-100",children:(0,s.jsxs)("div",{className:"max-w-2xl mx-auto space-y-4",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-center text-blue-600 dark:text-blue-400",children:"LyricsGuessr"}),(0,s.jsxs)("p",{className:"text-sm text-slate-600 dark:text-slate-400 text-center",children:["Manche ",M,"/",j," • Score : ",null!==(t=null===(e=V.find(e=>e.name===B))||void 0===e?void 0:e.score)&&void 0!==t?t:0]}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(h.Z,{roomCode:f,gameType:"lyricsguessr"})}),!C&&U&&(0,s.jsxs)(n.Z,{className:"p-6 text-center",children:[g?(0,s.jsxs)("p",{className:"mb-4 text-slate-700 dark:text-slate-300",children:["Artiste : ",g]}):(0,s.jsx)("p",{className:"mb-4 text-amber-600 dark:text-amber-400",children:"Configure l'artiste dans la room (param\xe8tres du jeu)."}),D&&(0,s.jsx)("p",{className:"text-red-500 mb-2",children:D}),(0,s.jsx)(c.z,{onClick:J,className:"rounded-xl",disabled:!g.trim(),children:"Commencer"})]}),!C&&!U&&(0,s.jsx)(n.Z,{className:"p-6 text-center",children:(0,s.jsx)("p",{className:"text-slate-600 dark:text-slate-400",children:"En attente de l'h\xf4te..."})}),C&&b&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z,{timeLeft:A,totalSeconds:N}),(0,s.jsxs)(n.Z,{className:"p-6 text-center",children:[(0,s.jsx)(u.Z,{className:"h-8 w-8 text-slate-500 dark:text-slate-400 mx-auto mb-2"}),(0,s.jsxs)("p",{className:"text-xl italic text-slate-800 dark:text-slate-100",children:['"',b.line,'"']})]}),!I&&(0,s.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!v.trim()||!b||I)return;let t=b.title.toLowerCase().trim()===v.toLowerCase().trim();if(G({type:"player_guess",data:{player:B,guess:v.trim()}}),w(e=>e.includes(B)?e:[...e,B]),t&&!z){L(B);let e=[...V],t=e.findIndex(e=>e.name===B);t>=0?e[t].score+=10:e.push({name:B,score:10}),q(e),G({type:"round_end",data:{winner:B,players:e}})}S("")},className:"flex gap-2",children:[(0,s.jsx)(d.I,{type:"text",placeholder:"Titre de la chanson...",value:v,onChange:e=>S(e.target.value),className:"rounded-xl flex-1"}),(0,s.jsx)(c.z,{type:"submit",className:"rounded-xl",disabled:_.includes(B),children:"Valider"})]}),(0,s.jsx)(x.Z,{answeredPlayers:_}),I&&(0,s.jsxs)(n.Z,{className:"p-6 text-center bg-green-100 dark:bg-green-900/40",children:[(0,s.jsx)(m.Z,{className:"h-10 w-10 text-amber-500 mx-auto mb-2"}),(0,s.jsx)("p",{className:"font-semibold text-slate-800 dark:text-slate-100",children:z?"".concat(z," a trouv\xe9 !"):"Temps \xe9coul\xe9"}),(0,s.jsxs)("p",{className:"text-slate-700 dark:text-slate-300 mt-1",children:[b.artist," – ",b.title]}),U&&(0,s.jsx)(c.z,{onClick:J,className:"mt-4 rounded-xl",children:M>=j?"Voir les scores":"Manche suivante"})]})]})]})})}}},function(e){e.O(0,[61,293,902,971,938,744],function(){return e(e.s=1228)}),_N_E=e.O()}]);