(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[531],{4429:function(e,t,s){Promise.resolve().then(s.bind(s,5742))},5742:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return N}});var a=s(7437),r=s(2265),l=s(4033),i=s(1543),n=s(9313),d=s(4203),o=s(2473),c=s(3523),m=s(2442),u=s(1657);let p=o.fC;o.ZA;let f=o.B4,x=r.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsxs)(o.xz,{ref:t,className:(0,u.cn)("flex h-10 w-full items-center justify-between rounded-md border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 ring-offset-white placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-slate-800 dark:bg-slate-950 dark:text-slate-100 dark:ring-offset-slate-950 dark:placeholder:text-slate-400 dark:focus:ring-slate-800",s),...l,children:[r,(0,a.jsx)(o.JO,{asChild:!0,children:(0,a.jsx)(c.Z,{className:"h-4 w-4 opacity-50"})})]})});x.displayName=o.xz.displayName;let h=r.forwardRef((e,t)=>{let{className:s,children:r,position:l="popper",...i}=e;return(0,a.jsx)(o.h_,{children:(0,a.jsx)(o.VY,{ref:t,className:(0,u.cn)("relative z-50 min-w-[8rem] overflow-hidden rounded-md border border-slate-200 bg-white text-slate-950 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-slate-800 dark:bg-slate-950 dark:text-slate-50","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:l,...i,children:(0,a.jsx)(o.l_,{className:(0,u.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r})})})});h.displayName=o.VY.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(o.__,{ref:t,className:(0,u.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...r})}).displayName=o.__.displayName;let b=r.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsxs)(o.ck,{ref:t,className:(0,u.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm text-slate-900 dark:text-slate-100 outline-none focus:bg-slate-100 focus:text-slate-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-slate-800 dark:focus:text-slate-100",s),...l,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(o.wU,{children:(0,a.jsx)(m.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(o.eT,{children:r})]})});b.displayName=o.ck.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(o.Z0,{ref:t,className:(0,u.cn)("-mx-1 my-1 h-px bg-slate-100 dark:bg-slate-800",s),...r})}).displayName=o.Z0.displayName;var g=s(7405),v=s(5750),y=s(6224),j=s(4599);let _=[{id:"pokeguessr",name:"PokeGuessr",description:"Devinez le Pok\xe9mon \xe0 partir de son ombre.",icon:g.Z,settings:[{id:"rounds",label:"Manches",type:"number",default:5},{id:"time",label:"Temps par manche (s)",type:"number",default:30}]},{id:"rhymeguessr",name:"RhymeGuessr",description:"Trouvez le mot qui rime.",icon:g.Z,settings:[{id:"rounds",label:"Manches",type:"number",default:7},{id:"time",label:"Temps par manche (s)",type:"number",default:15}]},{id:"caloriesguessr",name:"CaloriesGuessr",description:"Estimez les calories des aliments.",icon:g.Z,settings:[{id:"rounds",label:"Manches",type:"number",default:5},{id:"time",label:"Temps par manche (s)",type:"number",default:25}]},{id:"flagguessr",name:"FlagGuessr",description:"Identifiez le pays au drapeau.",icon:g.Z,settings:[{id:"rounds",label:"Manches",type:"number",default:10},{id:"time",label:"Temps par manche (s)",type:"number",default:15}]},{id:"populationguessr",name:"PopulationGuessr",description:"Devinez la population du pays.",icon:g.Z,settings:[{id:"rounds",label:"Manches",type:"number",default:10},{id:"time",label:"Temps par manche (s)",type:"number",default:20}]},{id:"lyricsguessr",name:"LyricsGuessr",description:"Devinez la chanson \xe0 partir des paroles.",icon:g.Z,settings:[{id:"rounds",label:"Manches",type:"number",default:5},{id:"time",label:"Temps par manche (s)",type:"number",default:45},{id:"artist",label:"Artiste (ex: Daft Punk)",type:"text",default:""}]},{id:"infiltre",name:"L'Infiltr\xe9",description:"D\xe9duction sociale avec Ma\xeetre du jeu, Infiltr\xe9 et Citoyens.",icon:g.Z,settings:[{id:"time",label:"Temps de questions (s)",type:"number",default:180}]},{id:"undercover",name:"Undercover",description:"Civils, Undercover et Mr. White avec mots proches.",icon:g.Z,settings:[]}];function N(e){let{params:t}=e,s=(0,l.useRouter)(),[o,c]=(0,r.useState)([]),[m,u]=(0,r.useState)(""),[N,k]=(0,r.useState)(!1),[w,I]=(0,r.useState)("__placeholder__"),[S,O]=(0,r.useState)({}),[Z,E]=(0,r.useState)(!0),[z,C]=(0,r.useState)(!1),[T,q]=(0,r.useState)(!1),[R,M]=(0,r.useState)(!1),[D,H]=(0,r.useState)(null),J=(0,r.useRef)(o),P=(0,r.useRef)(N);(0,r.useEffect)(()=>{J.current=o,P.current=N},[o,N]);let U=(0,r.useMemo)(()=>w&&"__placeholder__"!==w?_.find(e=>e.id===w):void 0,[w]);(0,r.useEffect)(()=>{let e=sessionStorage.getItem("playerName");if(!e){s.push("/");return}u(e),(async()=>{try{let{data:s,error:a}=await j.O.from("rooms").select("*").eq("code",t.code).maybeSingle();if(a||!s){M(!0);return}H(s.id),s.game_type&&"__placeholder__"!==s.game_type&&I(s.game_type),s.settings&&O(s.settings);let{data:r}=await j.O.from("players").select("*").eq("room_id",s.id).eq("name",e).maybeSingle(),l=null==r?void 0:r.id,i=(null==r?void 0:r.is_host)||!1;if(r)s.host_id!==r.id&&s.host_id!==r.name||(i=!0,r.is_host||await j.O.from("players").update({is_host:!0}).eq("id",r.id));else{let t=!s.host_id||s.host_id===e,{data:a,error:r}=await j.O.from("players").insert({room_id:s.id,name:e,is_host:t,score:0}).select().single();a&&(l=a.id,i=a.is_host,t&&s.host_id!==a.id&&await j.O.from("rooms").update({host_id:a.id}).eq("id",s.id))}k(i),sessionStorage.setItem("isHost",String(i)),l&&sessionStorage.setItem("playerId",l);let{data:n}=await j.O.from("players").select("*").eq("room_id",s.id);n&&c(n.map(e=>({id:e.id,name:e.name,isHost:e.is_host,score:e.score||0,last_seen_at:e.last_seen_at}))),E(!1)}catch(e){console.error("Erreur init room:",e)}})()},[t.code,s]),(0,r.useEffect)(()=>{if(!D)return;let e=sessionStorage.getItem("playerId"),t=async()=>{e&&await j.O.from("players").update({last_seen_at:new Date().toISOString()}).eq("id",e)};t();let s=setInterval(t,3e4),a=setInterval(async()=>{if(P.current){let e=new Date(Date.now()-12e4).toISOString();await j.O.from("players").delete().eq("room_id",D).lt("last_seen_at",e)}else{let e=J.current.find(e=>e.isHost);if(e&&e.last_seen_at){let t=new Date(e.last_seen_at).getTime();if(Date.now()-t>15e4){console.log("Host inactive, closing room...");let{data:e}=await j.O.from("rooms").select("status").eq("id",D).maybeSingle();e&&"closed"!==e.status&&await j.O.from("rooms").update({status:"closed"}).eq("id",D)}}}},6e4);return()=>{clearInterval(s),clearInterval(a)}},[D]),(0,r.useEffect)(()=>{if(!D)return;let e=j.O.channel("room_".concat(D)).on("postgres_changes",{event:"*",schema:"public",table:"players",filter:"room_id=eq.".concat(D)},async()=>{let{data:e}=await j.O.from("players").select("*").eq("room_id",D);e&&c(e.map(e=>({id:e.id,name:e.name,isHost:e.is_host,score:e.score||0,last_seen_at:e.last_seen_at})))}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"rooms",filter:"id=eq.".concat(D)},e=>{let a=e.new;if(a.game_type&&I(a.game_type),a.settings&&O(a.settings),"closed"===a.status){M(!0),setTimeout(()=>s.push("/"),3e3);return}if("in_game"===a.status||"started"===a.status){let e=new URLSearchParams;a.settings&&Object.entries(a.settings).forEach(t=>{let[s,a]=t;""!==a&&void 0!==a&&e.set(s,String(a))});let r=e.toString();s.push("/games/".concat(a.game_type,"/").concat(t.code).concat(r?"?".concat(r):""))}}).subscribe();return()=>{j.O.removeChannel(e)}},[D,t.code,s]);let G=(0,r.useRef)(!1);(0,r.useEffect)(()=>{if(!N||!D||!w||"__placeholder__"===w)return;let e=setTimeout(async()=>{if(G.current)return;if("string"!=typeof w){console.error("Invalid game_type:",w);return}if("string"!=typeof D||!D){console.error("Invalid roomId:",D);return}G.current=!0,console.log("Updating room settings:",{game_type:w,settings:S});let{error:e}=await j.O.from("rooms").update({game_type:w,settings:S||{}}).eq("id",D);e&&console.error("ERREUR COMPL\xc8TE UPDATE SETTINGS:",e.message,e.details,e.hint),G.current=!1},500);return()=>clearTimeout(e)},[w,S,N,D]),(0,r.useEffect)(()=>{if(U){let e={};U.settings.forEach(t=>{void 0===S[t.id]&&(e[t.id]=t.default)}),Object.keys(e).length>0&&O(t=>({...t,...e}))}},[U]);let L=(e,t)=>{O(s=>({...s,[e]:t}))},A=async()=>{w&&"__placeholder__"!==w&&D&&await j.O.from("rooms").update({status:"in_game",game_type:w,settings:S}).eq("id",D)},F=async()=>{D&&m&&await j.O.from("players").delete().match({room_id:D,name:m}),sessionStorage.removeItem("playerName"),sessionStorage.removeItem("isHost"),sessionStorage.removeItem("playerId"),s.push("/")};return(0,a.jsx)("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100 p-4 sm:p-6 game-layout",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,a.jsx)("div",{className:"flex flex-wrap items-center justify-between gap-4 mb-6 sm:mb-8",children:(0,a.jsx)(n.z,{onClick:F,variant:"outline",className:"rounded-xl",children:"â† Quitter"})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsx)("div",{className:"lg:col-span-2 order-2 lg:order-1",children:(0,a.jsxs)(i.Z,{className:"p-4 sm:p-6 rounded-2xl h-full",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold mb-4 text-slate-800 dark:text-slate-100 flex items-center gap-2",children:[(0,a.jsx)(g.Z,{className:"h-5 w-5"}),N?"Configuration de la partie":"Informations de la partie"]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Jeu s\xe9lectionn\xe9"}),N?(0,a.jsxs)(p,{onValueChange:I,value:w,children:[(0,a.jsx)(x,{className:"w-full rounded-xl text-slate-800 dark:text-slate-100 h-12",children:(0,a.jsx)(f,{placeholder:"S\xe9lectionner un jeu..."})}),(0,a.jsxs)(h,{children:[(0,a.jsx)(b,{value:"__placeholder__",children:"S\xe9lectionner un jeu..."}),_.map(e=>(0,a.jsx)(b,{value:e.id,children:e.name},e.id))]})]}):(0,a.jsx)("div",{className:"flex items-center gap-3 p-3 bg-slate-100 dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700",children:U?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"h-10 w-10 rounded-lg bg-indigo-500/10 flex items-center justify-center text-indigo-500",children:(0,a.jsx)(U.icon,{className:"h-6 w-6"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-bold text-lg",children:U.name}),(0,a.jsx)("div",{className:"text-xs text-slate-500",children:U.description})]})]}):(0,a.jsx)("span",{className:"text-slate-500 italic",children:"En attente de s\xe9lection..."})})]}),U&&(0,a.jsxs)("div",{className:"p-5 rounded-2xl bg-slate-100/50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 transition-all duration-300",children:[N&&(0,a.jsx)("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-6 pb-4 border-b border-slate-200 dark:border-slate-700",children:U.description}),(0,a.jsxs)("h3",{className:"font-semibold mb-4 text-slate-800 dark:text-slate-100 flex items-center gap-2",children:[(0,a.jsx)("span",{children:"Param\xe8tres"}),!N&&(0,a.jsx)("span",{className:"text-xs font-normal text-slate-500 bg-slate-200 dark:bg-slate-700 px-2 py-0.5 rounded-full",children:"Synchronis\xe9"})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:U.settings.map(e=>{var t,s,r,l,i;return(0,a.jsxs)("div",{className:"bg-white dark:bg-slate-900 p-3 rounded-xl border border-slate-200 dark:border-slate-800",children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-slate-500 dark:text-slate-400 mb-1 uppercase tracking-wider",children:e.label}),N?(0,a.jsxs)(a.Fragment,{children:["number"===e.type&&(0,a.jsx)(d.I,{type:"number",value:String(null!==(s=S[e.id])&&void 0!==s?s:e.default),onChange:t=>L(e.id,""===t.target.value?e.default:Number(t.target.value)),className:"rounded-lg h-9"}),"text"===e.type&&(0,a.jsx)(d.I,{type:"text",value:String(null!==(r=S[e.id])&&void 0!==r?r:e.default),onChange:t=>L(e.id,t.target.value),className:"rounded-lg h-9",placeholder:e.label}),"select"===e.type&&e.options&&(0,a.jsxs)(p,{value:String(null!==(l=S[e.id])&&void 0!==l?l:e.default),onValueChange:t=>L(e.id,t),children:[(0,a.jsx)(x,{className:"rounded-lg h-9",children:(0,a.jsx)(f,{})}),(0,a.jsx)(h,{children:e.options.map(e=>(0,a.jsx)(b,{value:e.value,children:e.label},e.value))})]})]}):(0,a.jsx)("div",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:"select"===e.type&&e.options?null===(t=e.options.find(t=>{var s;return t.value===String(null!==(s=S[e.id])&&void 0!==s?s:e.default)}))||void 0===t?void 0:t.label:null!==(i=S[e.id])&&void 0!==i?i:e.default})]},e.id)})})]}),(0,a.jsx)("div",{className:"mt-6 pt-6 border-t border-slate-200 dark:border-slate-800",children:N?(0,a.jsx)(n.z,{onClick:A,disabled:!w||"__placeholder__"===w,className:"w-full rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white h-12 text-lg font-bold shadow-lg shadow-blue-500/20 transition-all hover:scale-[1.02]",children:"Lancer la partie"}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-4 text-center space-y-2 animate-pulse",children:[(0,a.jsxs)("div",{className:"text-indigo-500 font-medium",children:["En attente de ",(()=>{let e=o.find(e=>e.isHost);return e?e.name:"l'h\xf4te"})(),"..."]}),(0,a.jsx)("div",{className:"text-sm text-slate-500",children:"La partie va bient\xf4t commencer !"})]})})]})]})}),(0,a.jsx)("div",{className:"lg:col-span-1 order-1 lg:order-2",children:(0,a.jsxs)(i.Z,{className:"p-4 sm:p-6 rounded-2xl h-full border-slate-200 dark:border-slate-800",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-slate-800 dark:text-slate-100",children:[(0,a.jsx)(v.Z,{className:"h-5 w-5"}),"Joueurs (",o.length,")"]}),(0,a.jsx)("div",{className:"space-y-3 max-h-[calc(100vh-300px)] overflow-y-auto pr-2 custom-scrollbar",children:o.map(e=>(0,a.jsx)("div",{className:"flex items-center justify-between p-3 rounded-xl bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 transition-transform hover:scale-[1.02]",children:(0,a.jsxs)("div",{className:"flex items-center gap-3 overflow-hidden",children:[(0,a.jsx)("div",{className:"h-8 w-8 rounded-full flex items-center justify-center text-sm font-bold ".concat(e.isHost?"bg-blue-100 text-blue-600 dark:bg-blue-900/50 dark:text-blue-400":"bg-slate-200 text-slate-600 dark:bg-slate-700 dark:text-slate-300"),children:e.name.charAt(0).toUpperCase()}),(0,a.jsxs)("div",{className:"flex flex-col truncate",children:[(0,a.jsx)("span",{className:"font-medium text-slate-800 dark:text-slate-100 truncate",children:e.name}),e.isHost&&(0,a.jsx)("span",{className:"text-[10px] uppercase tracking-wider text-blue-500 font-bold",children:"Host"})]})]})},e.id))}),(0,a.jsxs)("div",{className:"mt-6 pt-4 border-t border-slate-200 dark:border-slate-800",children:[(0,a.jsx)("p",{className:"text-xs text-center text-slate-500 mb-2",children:"Invite tes amis avec ce code"}),(0,a.jsxs)("div",{className:"bg-slate-100 dark:bg-slate-900 p-3 rounded-xl flex items-center justify-center gap-2 cursor-pointer hover:bg-slate-200 dark:hover:bg-slate-800 transition-colors group",onClick:()=>{navigator.clipboard.writeText(t.code),q(!0),setTimeout(()=>q(!1),2e3)},children:[(0,a.jsx)("span",{className:"font-mono text-xl font-bold tracking-widest",children:t.code}),(0,a.jsx)(y.Z,{className:"h-4 w-4 text-slate-400 group-hover:text-slate-600 dark:group-hover:text-slate-300"})]})]})]})})]})]})})}},9313:function(e,t,s){"use strict";s.d(t,{z:function(){return l}});var a=s(7437),r=s(1657);let l=(0,s(2265).forwardRef)((e,t)=>{let{children:s,className:l,variant:i="primary",size:n="md",...d}=e;return(0,a.jsx)("button",{ref:t,className:(0,r.cn)("inline-flex items-center justify-center font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",{primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500 dark:bg-blue-600 dark:text-white dark:hover:bg-blue-700",secondary:"bg-slate-200 text-slate-900 hover:bg-slate-300 focus:ring-slate-500 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600",outline:"border border-slate-300 text-slate-700 hover:bg-slate-50 focus:ring-slate-500 dark:border-slate-600 dark:text-slate-200 dark:hover:bg-slate-800 dark:bg-transparent",ghost:"bg-transparent text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800"}[i],{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[n],l),...d,children:s})});l.displayName="Button"},1543:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var a=s(7437),r=s(1657);function l(e){let{children:t,className:s}=e;return(0,a.jsx)("div",{className:(0,r.cn)("bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700","text-slate-800 dark:text-slate-100 shadow-sm hover:shadow-md transition-shadow duration-200","rounded-2xl",s),children:t})}},4203:function(e,t,s){"use strict";s.d(t,{I:function(){return l}});var a=s(7437),r=s(1657);let l=(0,s(2265).forwardRef)((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("input",{ref:t,className:(0,r.cn)("flex h-10 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm","placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent","disabled:cursor-not-allowed disabled:opacity-50","dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100 dark:placeholder:text-slate-400",s),...l})});l.displayName="Input"},4599:function(e,t,s){"use strict";s.d(t,{O:function(){return a}});let a=(0,s(3226).eI)("https://vyatvqwsoqalbnbcmhqm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5YXR2cXdzb3FhbGJuYmNtaHFtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3ODkzMDcsImV4cCI6MjA4NzM2NTMwN30.KoTP3iOZmvbzB8RjHlmWIyvdMVpfqoia3-MQxbdL1sY")},1657:function(e,t,s){"use strict";s.d(t,{cn:function(){return l}});var a=s(7042),r=s(4769);function l(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.m6)((0,a.W)(t))}}},function(e){e.O(0,[61,226,431,971,938,744],function(){return e(e.s=4429)}),_N_E=e.O()}]);