"use strict";exports.id=915,exports.ids=[915],exports.modules={5282:(e,t,a)=>{a.d(t,{I:()=>r});var s=a(5344),l=a(1626);let r=(0,a(3729).forwardRef)(({className:e,...t},a)=>s.jsx("input",{ref:a,className:(0,l.cn)("flex h-10 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm","placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent","disabled:cursor-not-allowed disabled:opacity-50","dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100 dark:placeholder:text-slate-400",e),...t}));r.displayName="Input"},5915:(e,t,a)=>{a.d(t,{Z:()=>h});var s=a(5344),l=a(3729),r=a(3511),n=a(5282),i=a(9889),c=a(1973),o=a(6824),d=a(7060),m=a(3229),u=a(1223),x=a.n(u),f=a(4755);function h({roomCode:e,settings:t}){let[a,u]=(0,l.useState)(""),[h,p]=(0,l.useState)(30),[g,y]=(0,l.useState)(5),[b,w]=(0,l.useState)(30),[j,v]=(0,l.useState)(null),[N,k]=(0,l.useState)(!1),[S,C]=(0,l.useState)([1]),[_,z]=(0,l.useState)("normal"),{roomStatus:T,players:E,gameState:D,isHost:I,playerId:O,updateSettings:M,startGame:Z,submitAnswer:R,nextRound:$,updateRoundData:A,setGameStatus:P,updatePlayerScore:G}=(0,c.d)(e??"","pokeguessr"),{broadcast:J,messages:q}=(0,i.r)(e??"","pokeguessr"),F="Anonyme",L="in_game"===T,B=D?.status==="round_results"||D?.status==="game_over",U=D?.round_data?.pokemon||null,V=D?.current_round||0,H=(0,l.useMemo)(()=>E.reduce((e,t)=>({...e,[t.name]:t.score}),{}),[E]);(0,l.useEffect)(()=>{D?.settings&&(D.settings.rounds&&y(Number(D.settings.rounds)),D.settings.time&&w(Number(D.settings.time)),D.settings.difficulty&&z(D.settings.difficulty),D.settings.gens&&Array.isArray(D.settings.gens)&&JSON.stringify(D.settings.gens)!==JSON.stringify(S)&&C(D.settings.gens))},[D?.settings]),(0,l.useEffect)(()=>{if(I){let e={rounds:g,time:b,gens:S,difficulty:_};JSON.stringify(e)!==JSON.stringify(D?.settings)&&M(e)}},[g,b,S,_,I,D?.settings,M]),(0,l.useEffect)(()=>{if(D?.round_data?.endTime){let e=Math.ceil((D.round_data.endTime-Date.now())/1e3);p(e>0?e:0)}},[D?.round_data?.endTime]),(0,l.useEffect)(()=>{let e;return L&&!B&&h>0&&(e=setInterval(()=>{p(e=>e<=1?(I&&!B&&ea(),0):e-1)},1e3)),()=>clearInterval(e)},[L,B,h,I]);let K=(0,l.useMemo)(()=>{let e=Math.floor(h/60),t=h%60;return`${e.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`},[h]),Q=async e=>{try{let t=await fetch(`/api/games/pokemon?id=${e}`);if(!t.ok)return null;return await t.json()}catch(e){return console.error("Error fetching pokemon",e),null}},X=async(e,t)=>{let a={1:{min:1,max:151},2:{min:152,max:251},3:{min:252,max:386},4:{min:387,max:493},5:{min:494,max:649},6:{min:650,max:721},7:{min:722,max:809},8:{min:810,max:905},9:{min:906,max:1025}},s=[];(e&&0!==e.length?e:[1]).forEach(e=>{let t=a[e];if(t)for(let e=t.min;e<=t.max;e++)s.push(e)});for(let e=s.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[s[e],s[t]]=[s[t],s[e]]}return s.slice(0,t)},W=async()=>{if(I&&e)try{let e=await X(S,g);if(0===e.length)return;let t=e[0],a=await Q(t),s=e.slice(1),l=Date.now()+1e3*b;await Z({pokemon:a,queue:s,endTime:l,startTime:Date.now()}),k(!1),u("")}catch(e){console.error("Erreur lancement:",e)}},Y=async()=>{if(I&&D?.round_data)try{let e;let t=D.round_data.queue||[],a=[];0===t.length?e=(await X(S,1))[0]:(e=t[0],a=t.slice(1));let s=await Q(e),l=Date.now()+1e3*b;await $({pokemon:s,queue:a,endTime:l,startTime:Date.now()}),k(!1),u("")}catch(e){console.error("Error next round",e)}},ee=()=>{!a.trim()||B||N||(R({answer:a.trim(),timestamp:Date.now()}),k(!0),f.Am.success("R\xe9ponse envoy\xe9e !"))},et=e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]/g,""),ea=async()=>{if(!I||!U||!D)return;let e=Object.values(U.names).map(e=>et(e)),t=D.round_data.startTime||D.round_data.endTime-1e3*b,a=D.answers||{},s=[],l=[];for(let r of E){let n=a[r.id],i=0,c=!1,o="-";if(n){o=n.answer;let a=(n.timestamp-t)/1e3,s=et(o);if(e.includes(s)){c=!0;let e=b/2;i=a<5?1e3:a<e?700:400}}s.push({player:r.name,answer:o,isCorrect:c,score:i,timeBonus:0}),i>0&&l.push({playerId:r.id,score:r.score+i})}for(let e of(s.sort((e,t)=>t.score-e.score),l))await G(e.playerId,e.score);await A({...D.round_data,results:s}),await P("round_results")};return(0,l.useEffect)(()=>{if(!a)return;J({type:"typing",data:{player:F,isTyping:!0}});let e=setTimeout(()=>{J({type:"typing",data:{player:F,isTyping:!1}})},1e3);return()=>clearTimeout(e)},[a,J,F]),s.jsx(o.Z,{players:H,roundCount:V,maxRounds:g,timer:K,gameCode:e??"",gameTitle:"Pok\xe9Guessr",isHost:I,gameStarted:L,onStartGame:W,timeLeft:h,typingPlayer:j,children:s.jsx("div",{className:"flex flex-col items-center justify-center w-full max-w-4xl mx-auto gap-8",children:L?!B&&U?(0,s.jsxs)("div",{className:"w-full max-w-2xl flex flex-col items-center gap-6 animate-in fade-in duration-500",children:[s.jsx("div",{className:"relative w-64 h-64 flex items-center justify-center",children:s.jsx(x(),{src:U.imageUrl,alt:"Pokemon",width:256,height:256,className:"object-contain transition-all duration-500",style:(()=>{if(B)return{};switch(_){case"easy":return{filter:"blur(10px)"};case"hard":return{filter:"brightness(0) rotate(180deg)"};default:return{filter:"brightness(0)"}}})()})}),(0,s.jsxs)("div",{className:"w-full max-w-md space-y-4",children:[s.jsx(n.I,{type:"text",placeholder:"Quel est ce Pok\xe9mon ?",value:a,onChange:e=>u(e.target.value),className:"text-center text-xl py-6",disabled:N,onKeyDown:e=>{"Enter"===e.key&&ee()},autoFocus:!0}),s.jsx(r.z,{size:"lg",className:"w-full",onClick:ee,disabled:N||!a,children:N?"R\xe9ponse envoy\xe9e !":"Valider"})]})]}):B&&U?(0,s.jsxs)("div",{className:"w-full max-w-2xl flex flex-col items-center gap-6 animate-in zoom-in duration-300",children:[s.jsx("h2",{className:"text-3xl font-bold text-yellow-400",children:"R\xe9sultats"}),(0,s.jsxs)("div",{className:"flex flex-col items-center gap-2 mb-4",children:[s.jsx("div",{className:"relative w-40 h-40 mb-2",children:s.jsx(x(),{src:U.imageUrl,alt:"Pokemon",width:160,height:160,className:"object-contain"})}),s.jsx("h3",{className:"text-2xl font-bold capitalize",children:U.names.fr||Object.values(U.names)[0]})]}),s.jsx("div",{className:"w-full space-y-3",children:D.round_data.results?.map((e,t)=>s.jsxs("div",{className:`flex items-center justify-between p-4 rounded-lg border ${0===t?"bg-yellow-500/20 border-yellow-500":"bg-white/5 border-white/10"}`,children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("span",{className:"font-bold text-lg w-6",children:[t+1,"."]}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"font-bold",children:e.player}),s.jsx("span",{className:"text-xs text-gray-400",children:e.answer})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[e.isCorrect?s.jsx(d.Z,{className:"text-green-400 w-6 h-6"}):s.jsx(m.Z,{className:"text-red-400 w-6 h-6"}),s.jsxs("span",{className:"font-bold text-xl",children:["+",e.score," pts"]})]})]},t))}),I&&s.jsx(r.z,{size:"lg",className:"mt-6",onClick:Y,children:V<g?"Manche suivante":"Terminer la partie"})]}):null:(0,s.jsxs)("div",{className:"text-center space-y-6 w-full max-w-md",children:[s.jsx("h2",{className:"text-2xl font-bold",children:"Pok\xe9Guessr"}),I?(0,s.jsxs)("div",{className:"p-6 bg-white/10 rounded-lg backdrop-blur-sm space-y-4",children:[s.jsx("p",{className:"mb-4",children:"Configurez la partie :"}),(0,s.jsxs)("div",{className:"space-y-4 text-left",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm text-gray-400 mb-1",children:["Nombre de manches (",g,")"]}),s.jsx("input",{type:"range",min:"1",max:"20",value:g,onChange:e=>y(parseInt(e.target.value)),className:"w-full"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm text-gray-400 mb-1",children:["Temps par manche (",b,"s)"]}),s.jsx("input",{type:"range",min:"10",max:"60",value:b,onChange:e=>w(parseInt(e.target.value)),className:"w-full"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Difficult\xe9"}),(0,s.jsxs)("select",{value:_,onChange:e=>z(e.target.value),className:"w-full bg-black/20 border border-white/20 rounded p-2",children:[s.jsx("option",{value:"easy",children:"Facile (Flou)"}),s.jsx("option",{value:"normal",children:"Normal (Silhouette)"}),s.jsx("option",{value:"hard",children:"Difficile (Renvers\xe9)"})]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"G\xe9n\xe9rations"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:[1,2,3,4,5,6,7,8,9].map(e=>(0,s.jsxs)("button",{onClick:()=>{S.includes(e)?S.length>1&&C(S.filter(t=>t!==e)):C([...S,e])},className:`px-2 py-1 rounded text-xs border ${S.includes(e)?"bg-white text-black border-white":"bg-transparent border-white/40"}`,children:["Gen ",e]},e))})]})]}),s.jsx(r.z,{size:"lg",className:"w-full mt-4",onClick:W,children:"Lancer la partie"})]}):(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white"}),s.jsx("p",{children:"En attente de l'h\xf4te..."})]})]})})})}},9889:(e,t,a)=>{a.d(t,{r:()=>r});var s=a(3729),l=a(6234);function r(e,t){let[a,r]=(0,s.useState)([]),[n,i]=(0,s.useState)([]);return(0,s.useEffect)(()=>{let a=l.O.channel(`room:${e}`);return a.on("presence",{event:"sync"},()=>{r(Object.values(a.presenceState()).flat())}).on("presence",{event:"join"},({key:e,newPresences:t})=>{console.log("Nouveau joueur:",t)}).on("presence",{event:"leave"},({key:e,leftPresences:t})=>{console.log("Joueur parti:",t)}).on("broadcast",{event:t},({payload:e})=>{i(t=>[...t,e])}).subscribe(async e=>{"SUBSCRIBED"===e&&await a.track({playerName:sessionStorage.getItem("playerName")||"Anonyme",gameType:t,joinedAt:new Date().toISOString()})}),()=>{a.unsubscribe()}},[e,t]),{broadcast:a=>{l.O.channel(`room:${e}`).send({type:"broadcast",event:t,payload:a})},presence:a,messages:n}}},7060:(e,t,a)=>{a.d(t,{Z:()=>s});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(9224).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},3229:(e,t,a)=>{a.d(t,{Z:()=>s});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(9224).Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])}};